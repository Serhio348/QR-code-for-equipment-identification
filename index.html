<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QR-код для идентификации оборудования</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#667eea" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Оборудование" />
    <meta name="description" content="Система для управления оборудованием и журналом обслуживания" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png" />
    <link rel="apple-touch-icon" sizes="128x128" href="/icons/icon-128x128.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <!-- Eruda - консоль разработчика для мобильных устройств -->
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>
      // Инициализируем Eruda в development режиме или если есть параметр ?debug
      // Проверяем по hostname (localhost) или параметру debug
      const isDevelopment = window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1' ||
                           window.location.search.includes('debug=true');
      
      if (isDevelopment) {
        eruda.init();
        
        // Защита от переполнения консоли - ограничиваем количество логов
        let logCount = 0;
        const maxLogs = 1000;
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const originalConsoleError = console.error;
        
        console.log = function(...args) {
          if (logCount++ < maxLogs) {
            originalConsoleLog.apply(console, args);
          } else if (logCount === maxLogs) {
            originalConsoleWarn.apply(console, ['[Console] Достигнут лимит логов. Дальнейшие логи будут игнорироваться.']);
          }
        };
        
        console.warn = function(...args) {
          if (logCount++ < maxLogs) {
            originalConsoleWarn.apply(console, args);
          }
        };
        
        console.error = function(...args) {
          // Игнорируем ошибки расширений браузера
          const errorMessage = args[0]?.toString() || '';
          if (errorMessage.includes('runtime.lastError') || 
              errorMessage.includes('Could not establish connection') ||
              errorMessage.includes('Receiving end does not exist')) {
            // Игнорируем ошибки расширений браузера
            return;
          }
          
          // Ошибки всегда логируем, но ограничиваем их количество
          if (logCount++ < maxLogs * 2) {
            originalConsoleError.apply(console, args);
          }
        };
      }
      
      // Глобальный обработчик необработанных ошибок
      window.addEventListener('error', (event) => {
        // Игнорируем ошибки расширений браузера
        const errorMessage = event.message || '';
        if (errorMessage.includes('runtime.lastError') || 
            errorMessage.includes('Could not establish connection') ||
            errorMessage.includes('Receiving end does not exist')) {
          event.preventDefault();
          return false;
        }
      });
      
      // Обработчик необработанных промисов
      window.addEventListener('unhandledrejection', (event) => {
        // Игнорируем ошибки расширений браузера
        const errorMessage = event.reason?.toString() || '';
        if (errorMessage.includes('runtime.lastError') || 
            errorMessage.includes('Could not establish connection') ||
            errorMessage.includes('Receiving end does not exist')) {
          event.preventDefault();
          return false;
        }
      });
    </script>
  </body>
</html>

