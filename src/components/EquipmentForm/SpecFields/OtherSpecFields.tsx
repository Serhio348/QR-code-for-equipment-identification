/**
 * OtherSpecFields.tsx
 * 
 * НАЗНАЧЕНИЕ:
 * Компонент для отображения полей спецификаций типа оборудования "Другое".
 * Предоставляет JSON редактор для ввода произвольных характеристик в формате JSON.
 * 
 * ОСОБЕННОСТИ:
 * - Не использует общие поля (NameField, InventoryNumberField) - они уже в основной форме
 * - Использует textarea вместо отдельных input полей
 * - Позволяет вводить любые характеристики в формате JSON
 * - Использует onSpecsChange вместо onSpecChange (работает со всем объектом сразу)
 * 
 * ИСПОЛЬЗОВАНИЕ:
 * Подходит для оборудования с нестандартными характеристиками, которые
 * не укладываются в структурированные поля других типов.
 * 
 * ПРИМЕР JSON:
 * {
 *   "модель": "XYZ-123",
 *   "год_выпуска": "2020",
 *   "производитель": "Компания А",
 *   "особенности": "Специальная модификация"
 * }
 */

import React from 'react';
import { EquipmentSpecs } from '../../../types/equipment';

/**
 * Интерфейс пропсов OtherSpecFields
 * 
 * ОТЛИЧИЕ ОТ ДРУГИХ КОМПОНЕНТОВ:
 * Использует onSpecChange с типом (specs: EquipmentSpecs) => void
 * вместо (key: string, value: string) => void
 * Это позволяет обновлять весь объект specs сразу, а не по одному полю.
 */
interface OtherSpecFieldsProps {
  specs: EquipmentSpecs;                              // Все характеристики (весь объект)
  onSpecChange: (specs: EquipmentSpecs) => void;     // Функция обновления всего объекта
}

/**
 * Компонент OtherSpecFields
 * 
 * ЛОГИКА РАБОТЫ:
 * 1. Отображает textarea с JSON представлением specs
 * 2. При изменении текста пытается распарсить JSON
 * 3. Если парсинг успешен - обновляет весь объект specs
 * 4. Если парсинг не удался - игнорирует (пользователь еще вводит)
 * 
 * ПРЕИМУЩЕСТВА:
 * - Гибкость: можно добавить любые поля
 * - Удобно для нестандартного оборудования
 * - Визуальное представление структуры данных
 * 
 * НЕДОСТАТКИ:
 * - Требует знания JSON синтаксиса
 * - Нет валидации полей
 * - Сложнее для пользователей без технических знаний
 */
export const OtherSpecFields: React.FC<OtherSpecFieldsProps> = ({ specs, onSpecChange }) => {
  return (
    <div className="form-group">
      {/* Метка с указанием формата */}
      <label>Дополнительные характеристики (JSON):</label>
      
      {/* 
        Textarea для редактирования JSON:
        - value: JSON.stringify преобразует объект specs в строку JSON с отступами
        - onChange: при изменении пытаемся распарсить JSON и обновить specs
        - placeholder: пример формата
        - rows: высота текстового поля
      */}
      <textarea
        value={JSON.stringify(specs, null, 2)}  // Преобразуем объект в JSON с отступами (2 пробела)
        onChange={(e) => {
          try {
            // Пытаемся распарсить введенный текст как JSON
            const parsed = JSON.parse(e.target.value);
            // Если успешно - обновляем весь объект specs
            onSpecChange(parsed);
          } catch {
            // Если парсинг не удался (невалидный JSON) - игнорируем
            // Это нормально, так как пользователь может быть в процессе ввода
            // Например, введен только { без закрывающей скобки
          }
        }}
        placeholder='{"ключ": "значение"}'
        rows={5}  // Высота текстового поля (5 строк)
      />
    </div>
  );
};

