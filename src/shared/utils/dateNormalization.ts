/**
 * Утилиты для нормализации дат
 * 
 * ВАЖНО: Не используем new Date() для парсинга, чтобы избежать проблем с часовыми поясами
 * Нормализуем напрямую из компонентов строки
 */

/**
 * Нормализует дату в формат YYYY-MM-DD для input type="date"
 * 
 * Убирает время из строки даты и возвращает только дату в формате YYYY-MM-DD
 * 
 * @param {string} dateString - Дата в любом формате (ISO, с временем и т.д.)
 * @returns {string} Дата в формате YYYY-MM-DD или пустая строка если невалидна
 * 
 * @example
 * normalizeDate('2024-01-15T00:00:00.000Z') // "2024-01-15"
 * normalizeDate('2024-01-15 12:00:00') // "2024-01-15"
 * normalizeDate('2024-01-15') // "2024-01-15"
 */
export function normalizeDate(dateString?: string): string {
  if (!dateString) return '';
  
  // Убираем возможное время из строки даты
  // Например: "2024-01-15T00:00:00.000Z" -> "2024-01-15"
  // Или: "2024-01-15 12:00:00" -> "2024-01-15"
  const dateOnly = dateString.split('T')[0].split(' ')[0].trim();
  
  // Проверяем, что это формат YYYY-MM-DD
  if (/^\d{4}-\d{2}-\d{2}$/.test(dateOnly)) {
    // Просто возвращаем как есть, без использования new Date()
    return dateOnly;
  }
  
  // Если формат не YYYY-MM-DD, пытаемся извлечь дату другим способом
  // Но НЕ используем new Date(), чтобы избежать смещения из-за часовых поясов
  const match = dateOnly.match(/(\d{4})-(\d{2})-(\d{2})/);
  if (match) {
    return match[0]; // Возвращаем YYYY-MM-DD
  }
  
  // Если не удалось распарсить, возвращаем пустую строку
  console.warn('⚠️ Не удалось нормализовать дату:', dateString);
  return '';
}
