# –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã Supabase

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Supabase —Å–æ–∑–¥–∞–Ω–∞
2. ‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã: `profiles`, `user_app_access`, `login_history`, `beliot_device_overrides`
3. ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
4. ‚úÖ –§—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã: `is_admin()`, `get_user_role()`, `handle_new_user()`, `log_login()`
5. ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

---

## üîç –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Supabase

### 1.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ SQL Editor

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase Dashboard ‚Üí SQL Editor:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü
SELECT table_name FROM information_schema.tables 
WHERE table_schema = 'public' 
  AND table_name IN ('profiles', 'user_app_access', 'login_history', 'beliot_device_overrides');

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π
SELECT proname FROM pg_proc 
WHERE pronamespace = (SELECT oid FROM pg_namespace WHERE nspname = 'public')
  AND proname IN ('is_admin', 'get_user_role', 'handle_new_user', 'log_login');

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
SELECT trigger_name, event_object_table FROM information_schema.triggers
WHERE trigger_schema = 'public';
```

### 1.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
import { supabase, testSupabaseConnection } from './src/config/supabase';

await testSupabaseConnection();

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const { data: { user } } = await supabase.auth.getUser();
console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', user);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏
const { data: { session } } = await supabase.auth.getSession();
console.log('–°–µ—Å—Å–∏—è:', session ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
```

---

## üöÄ –®–∞–≥ 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –≤—Ö–æ–¥–∞

### 2.1. –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Supabase Dashboard

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard** ‚Üí **Authentication** ‚Üí **Users**
2. –ù–∞–∂–º–∏—Ç–µ **Add user** ‚Üí **Create new user**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - Email: `test@example.com`
   - Password: `test123456`
   - Auto Confirm User: ‚úÖ (—á—Ç–æ–±—ã –Ω–µ —Ç—Ä–µ–±–æ–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email)
4. –ù–∞–∂–º–∏—Ç–µ **Create user**

### 2.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
SELECT * FROM public.profiles WHERE email = 'test@example.com';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
SELECT * FROM public.user_app_access 
WHERE user_id = (SELECT id FROM public.profiles WHERE email = 'test@example.com');
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã:
- ‚úÖ –ó–∞–ø–∏—Å—å –≤ `profiles` —Å —Ä–æ–ª—å—é `user`
- ‚úÖ –ó–∞–ø–∏—Å—å –≤ `user_app_access` —Å `equipment=false`, `water=false`

### 2.3. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

```sql
-- –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
UPDATE public.profiles 
SET role = 'admin' 
WHERE email = 'your-email@example.com';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ–ª—å
SELECT email, role FROM public.profiles WHERE email = 'your-email@example.com';
```

---

## üìù –®–∞–≥ 3: –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç A: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–û—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–π API** (`authApi.ts`) –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π API** (`supabaseAuthApi.ts`) –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –Ω–∞ Supabase –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ

### –í–∞—Ä–∏–∞–Ω—Ç B: –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

1. **–°–æ–∑–¥–∞—Ç—å `supabaseAuthApi.ts`** —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –≤—Ö–æ–¥–∞, –≤—ã—Ö–æ–¥–∞
2. **–û–±–Ω–æ–≤–∏—Ç—å `AuthContext.tsx`** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ API
3. **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –≤ Supabase

---

## üîß –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ API –¥–ª—è Supabase (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –≤–∞—Ä–∏–∞–Ω—Ç B)

### 4.1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `src/services/api/supabaseAuthApi.ts`

–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- `register()` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `supabase.auth.signUp()`
- `login()` - –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ `supabase.auth.signInWithPassword()`
- `logout()` - –≤—ã—Ö–æ–¥ —á–µ—Ä–µ–∑ `supabase.auth.signOut()`
- `getCurrentUser()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `checkSession()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏
- `verifyAdmin()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### 4.2. –û–±–Ω–æ–≤–∏—Ç—å `AuthContext.tsx`

–ó–∞–º–µ–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã:
```typescript
// –ë—ã–ª–æ:
import { login, logout, register } from '../services/api/authApi';

// –°—Ç–∞–ª–æ:
import { login, logout, register } from '../services/api/supabaseAuthApi';
```

### 4.3. –£–±—Ä–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `sessionStorage`

Supabase —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–µ—Å—Å–∏–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `supabase.auth.getSession()`.

---

## üß™ –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 5.1. –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Supabase Dashboard:
   - ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –≤ `auth.users`
   - ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞–Ω –≤ `profiles`
   - ‚úÖ –î–æ—Å—Ç—É–ø —Å–æ–∑–¥–∞–Ω –≤ `user_app_access`

### 5.2. –¢–µ—Å—Ç –≤—Ö–æ–¥–∞

1. –í–æ–π–¥–∏—Ç–µ –ø–æ–¥ —Å–æ–∑–¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - ‚úÖ –°–µ—Å—Å–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
   - ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω
   - ‚úÖ –†–æ–ª—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### 5.3. –¢–µ—Å—Ç —Ä–æ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

1. –ù–∞–∑–Ω–∞—á—å—Ç–µ —Ä–æ–ª—å `admin` —á–µ—Ä–µ–∑ SQL
2. –í—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - ‚úÖ –í –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞"
   - ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–æ—Å—Ç—É–ø–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] –°—Ö–µ–º–∞ Supabase –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã
- [ ] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –§—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –¢—Ä–∏–≥–≥–µ—Ä—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] –¢–µ—Å—Ç–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –†–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) API –¥–ª—è Supabase —Å–æ–∑–¥–∞–Ω
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) AuthContext –æ–±–Ω–æ–≤–ª–µ–Ω

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –≤ Supabase Dashboard ‚Üí **Logs**
2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π SQL** –∏–∑ `docs/CHECK_SUPABASE.sql`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏** - –≤–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –∞–∫—Ç–∏–≤–Ω—ã

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- `docs/SUPABASE_SETUP.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- `docs/SUPABASE_CODE_EXAMPLES.md` - –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
- `docs/TEST_SUPABASE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- `docs/CHECK_SUPABASE.sql` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π SQL —Å–∫—Ä–∏–ø—Ç

