# Диагностика отсутствия данных за вчера

## Возможные причины:

### 1. Проблема с часовыми поясами

**Проблема:** Данные записываются в UTC, но фильтрация может использовать локальное время.

**Проверка:**
- Выполните SQL запрос из `docs/queries/check-yesterday-data.sql`
- Проверьте, есть ли данные за вчера в базе

### 2. Проблема с диапазоном дат

**Текущая логика:**
- `archiveStartDate` = первое число текущего месяца (например, "2026-01-01")
- `archiveEndDate` = сегодня (например, "2026-01-10")
- `start_date` = "2026-01-01T00:00:00.000Z"
- `end_date` = "2026-01-10T23:59:59.999Z"

**Проблема:** Если сегодня 10 января, то `end_date` = "2026-01-10T23:59:59.999Z" (UTC)
- Это должно включать все данные за 10 января в UTC
- Но если данные записаны в другом часовом поясе, могут быть проблемы

### 3. Проблема со скриптом сбора данных

**Проверка:**
- Проверьте логи GitHub Actions за вчера
- Убедитесь, что скрипт запустился и записал данные

## Решение:

### Вариант 1: Расширить диапазон end_date

Изменить `end_date` чтобы включить следующий день (на всякий случай):

```typescript
end_date: archiveEndDate ? `${archiveEndDate}T23:59:59.999Z` : undefined
// Станет:
end_date: archiveEndDate ? `${archiveEndDate}T23:59:59.999Z` : undefined
// Или добавить 1 день:
const endDate = new Date(archiveEndDate);
endDate.setDate(endDate.getDate() + 1);
end_date: endDate.toISOString().split('T')[0] + 'T00:00:00.000Z'
```

### Вариант 2: Использовать локальное время для end_date

```typescript
const endDate = new Date(archiveEndDate);
endDate.setHours(23, 59, 59, 999);
end_date: endDate.toISOString(); // Будет в UTC, но с учетом локального времени
```

### Вариант 3: Проверить данные в Supabase

Выполните SQL запросы из `docs/queries/check-yesterday-data.sql` чтобы убедиться, что данные есть в базе.

## SQL запросы для проверки:

См. файл `docs/queries/check-yesterday-data.sql`

## Следующие шаги:

1. Выполните SQL запросы для проверки наличия данных за вчера
2. Проверьте логи GitHub Actions за вчера
3. Если данные есть в базе, но не отображаются - проблема в фильтрации
4. Если данных нет в базе - проблема в скрипте сбора данных

