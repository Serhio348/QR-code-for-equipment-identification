# –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –≤—Å–µ —Å—á–µ—Ç—á–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –¥–∞–Ω–Ω—ã–µ

## –ü—Ä–æ–±–ª–µ–º–∞:

–ü–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–º —Å—á–µ—Ç—á–∏–∫–∞–º –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å, —Ö–æ—Ç—è –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–±–∏—Ä–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å.

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

### 1. API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**–ü—Ä–∏—á–∏–Ω–∞:** Beliot API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–∏—è –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ cron job
- –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏: `‚ö†Ô∏è –¢–µ–∫—É—â–µ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ {deviceId}`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ API –¥–ª—è —ç—Ç–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω–æ –≤ Beliot —Å–∏—Å—Ç–µ–º–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Beliot API
- –í–æ–∑–º–æ–∂–Ω–æ, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∏–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 2. –ü–æ–∫–∞–∑–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –æ—Ç–≤–µ—Ç–∞ API

**–ü—Ä–∏—á–∏–Ω–∞:** API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –Ω–æ –≤ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚ö†Ô∏è –ü–æ–∫–∞–∑–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ {deviceId}`
- –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤)

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ API
- –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `last_message_type` —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ

### 3. –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞–Ω–∏–π

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è `NaN` –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ {deviceId}: {value}`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤–∞–ª–∏–¥–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ API
- –í–æ–∑–º–æ–∂–Ω–æ, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–¥–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

### 4. –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ Supabase

**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ `insert_beliot_reading`.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚ùå –û—à–∏–±–∫–∞ RPC –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ {deviceId}`
- –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `insert_beliot_reading` –≤ Supabase
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (Service Role Key)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö

### 5. –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏

**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚ùå –û—à–∏–±–∫–∞ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ {deviceId}: {error.message}`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫ –æ—à–∏–±–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫—É –≤ –∫–æ–¥–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API –∏ Supabase

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ cron job

**Railway:**
- –û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞ cron job
- –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å `‚ö†Ô∏è` –∏–ª–∏ `‚ùå`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Ç–æ–≥–∏: `üìä –ò—Ç–æ–≥–∏ —Å–±–æ—Ä–∞:`

**GitHub Actions:**
- –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É "Actions"
- –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ Supabase

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ –∏–º–µ—é—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ —Å–µ–≥–æ–¥–Ω—è
SELECT 
  d.device_id,
  d.name,
  COUNT(r.id) as readings_count,
  MAX(r.reading_date) as last_reading
FROM (
  SELECT DISTINCT device_id, name 
  FROM beliot_device_overrides
) d
LEFT JOIN beliot_device_readings r 
  ON r.device_id = d.device_id 
  AND r.reading_date >= CURRENT_DATE
GROUP BY d.device_id, d.name
ORDER BY readings_count ASC;
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
SELECT 
  reading_date,
  reading_value,
  created_at,
  updated_at
FROM beliot_device_readings
WHERE device_id = 'YOUR_DEVICE_ID'
  AND reading_date >= CURRENT_DATE
ORDER BY reading_date DESC;
```

## –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É–µ—Ç:

1. **–î–ª—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:**
   ```
   ‚ö†Ô∏è –¢–µ–∫—É—â–µ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ {deviceId} ({name})
   üîç –ü—Ä–æ–≤–µ—Ä–∫–∞: readings.current = undefined, readings.previous = –Ω–µ—Ç
   ‚ö†Ô∏è –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ - –¥–∞–Ω–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è
   ```

2. **–î–ª—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:**
   ```
   ‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ {deviceId} ({name}): {value}
   üîç –ü—Ä–æ–≤–µ—Ä–∫–∞: readingValue = {value}, isNaN = {true/false}, < 0 = {true/false}
   ‚ö†Ô∏è –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ - –¥–∞–Ω–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è
   ```

3. **–ò—Ç–æ–≥–∏ —Å–±–æ—Ä–∞:**
   ```
   üìä –ò—Ç–æ–≥–∏ —Å–±–æ—Ä–∞:
   ‚úÖ –£—Å–ø–µ—à–Ω–æ: {count}
   ‚ö†Ô∏è –î—É–±–ª–∏–∫–∞—Ç—ã: {count}
   ‚ö†Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ: {count} (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
   ‚ùå –û—à–∏–±–æ–∫: {count}
   üìã –í—Å–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤: {total}
   üìà –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞: {percentage}%
   
   ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: {count} —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø—Ä–æ–ø—É—â–µ–Ω–æ!
   –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
   - API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
   - –ü–æ–∫–∞–∑–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –æ—Ç–≤–µ—Ç–∞ API
   - –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞–Ω–∏–π –Ω–µ–≤–∞–ª–∏–¥–Ω—ã (NaN –∏–ª–∏ < 0)
   ```

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ cron job** - –Ω–∞–π–¥–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–ø—É—â–µ–Ω—ã
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ Supabase** - –∫–∞–∫–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ –∏–º–µ—é—Ç –¥–∞–Ω–Ω—ã—Ö
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ API** - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏ Beliot API –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞** - –≤–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–∞—Ä—Å–∏–Ω–≥–∞

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö:
- –ï—Å–ª–∏ API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ Beliot —Å–∏—Å—Ç–µ–º–µ
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ - –æ–±–Ω–æ–≤–∏—Ç–µ –ª–æ–≥–∏–∫—É –ø–∞—Ä—Å–∏–Ω–≥–∞
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –≤ Supabase
- –ï—Å–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ API

