# AI –í–µ–±-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º

## –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç, –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –¥–ª—è –ø–æ–º–æ—â–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –≤ —Ä–∞–±–æ—Ç–µ —Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º. –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ó–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ
- –ò—Å–∫–∞—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- –î–æ–±–∞–≤–ª—è—Ç—å –∑–∞–ø–∏—Å–∏ –≤ –∂—É—Ä–Ω–∞–ª –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –≥–æ–ª–æ—Å–æ–º –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–º
- **–ü—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å —Ñ–æ—Ç–æ –∫ –∑–∞–ø–∏—Å—è–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è** (—Å –∫–∞–º–µ—Ä—ã –∏–ª–∏ –≥–∞–ª–µ—Ä–µ–∏)
- –ß–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ PDF –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- –ü–æ–ª—É—á–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é

**–ö–ª—é—á–µ–≤–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–¥ Telegram –±–æ—Ç–æ–º:** –†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä—è–º–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞, –≥–ª—É–±–æ–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä?

**–ü—Ä–æ–±–ª–µ–º–∞:** Anthropic API (Claude) –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç—Ä–∞–Ω (–ë–µ–ª–∞—Ä—É—Å—å, –†–æ—Å—Å–∏—è –∏ –¥—Ä.).

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—ë–º Backend API –Ω–∞ Railway, –∫–æ—Ç–æ—Ä—ã–π:
1. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
2. –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∏—Ö –∫ Claude API
3. Railway —Å–µ—Ä–≤–µ—Ä—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –°–®–ê/–ï–≤—Ä–æ–ø–µ ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–µ—Ç

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ë—Ä–∞—É–∑–µ—Ä       ‚îÇ  HTTPS  ‚îÇ   Railway        ‚îÇ  HTTPS  ‚îÇ   Anthropic     ‚îÇ
‚îÇ   (–ë–µ–ª–∞—Ä—É—Å—å)    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Proxy API      ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Claude API    ‚îÇ
‚îÇ                 ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   (–°–®–ê/–ï–≤—Ä–æ–ø–∞)   ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚îÇ
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚ñº            ‚ñº            ‚ñº
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ  Supabase ‚îÇ ‚îÇ  GAS API  ‚îÇ ‚îÇ  Google   ‚îÇ
                 ‚îÇ  (Auth)   ‚îÇ ‚îÇ(Equipment)‚îÇ ‚îÇ  Drive    ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ |
|-----------|------------|--------------|
| –ß–∞—Ç-–≤–∏–¥–∂–µ—Ç | React + TypeScript | Frontend (—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ) |
| Proxy API | Node.js + Express | Railway (–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å) |
| AI | Anthropic Claude API | –ß–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ |
| Speech-to-Text | Web Speech API | –ë—Ä–∞—É–∑–µ—Ä (–±–µ—Å–ø–ª–∞—Ç–Ω–æ) |
| –ß—Ç–µ–Ω–∏–µ PDF | GAS + Drive API | –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π MCP-—Å–µ—Ä–≤–µ—Ä |
| **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ** | GAS + Drive API | Google Drive (–ø–∞–ø–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è) |
| –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è | Supabase | –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π |

---

## –ß–∞—Å—Ç—å 1: Backend Proxy API

### –®–∞–≥ 1.1: –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞

–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø–∞–ø–∫—É –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```
ai-consultant-api/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.ts           # API –¥–ª—è —á–∞—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ upload.ts         # API –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ health.ts         # Health check
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ anthropic.ts      # –ö–ª–∏–µ–Ω—Ç Claude API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gasClient.ts      # –ö–ª–∏–µ–Ω—Ç GAS API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ toolExecutor.ts   # –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å tools
‚îÇ   ‚îú‚îÄ‚îÄ tools/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts          # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è tools
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ equipmentTools.ts # Tools –¥–ª—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ photoTools.ts     # Tools –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ç–æ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ driveTools.ts     # Tools –¥–ª—è —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts           # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ Supabase
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cors.ts           # CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rateLimit.ts      # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ env.ts            # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ types/
‚îÇ       ‚îî‚îÄ‚îÄ index.ts          # TypeScript —Ç–∏–ø—ã
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ railway.toml
```

### –®–∞–≥ 1.2: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç

```bash
mkdir ai-consultant-api
cd ai-consultant-api
npm init -y
```

### –®–∞–≥ 1.3: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
npm install express cors helmet @anthropic-ai/sdk @supabase/supabase-js dotenv
npm install -D typescript @types/express @types/cors @types/node tsx
```

### –®–∞–≥ 1.4: –°–æ–∑–¥–∞—Ç—å package.json

```json
{
  "name": "ai-consultant-api",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "tsx watch src/index.ts",
    "build": "tsc",
    "start": "node dist/index.js"
  },
  "dependencies": {
    "@anthropic-ai/sdk": "^0.71.2",
    "@supabase/supabase-js": "^2.89.0",
    "cors": "^2.8.5",
    "dotenv": "^16.4.5",
    "express": "^4.21.0",
    "helmet": "^7.1.0"
  },
  "devDependencies": {
    "@types/cors": "^2.8.17",
    "@types/express": "^4.17.21",
    "@types/node": "^22.0.0",
    "tsx": "^4.7.0",
    "typescript": "^5.6.0"
  }
}
```

### –®–∞–≥ 1.5: –°–æ–∑–¥–∞—Ç—å tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "lib": ["ES2022"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "declaration": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

### –®–∞–≥ 1.6: –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–§–∞–π–ª: `src/config/env.ts`**

```typescript
import dotenv from 'dotenv';

dotenv.config();

export const config = {
  // –°–µ—Ä–≤–µ—Ä
  port: parseInt(process.env.PORT || '3001', 10),
  nodeEnv: process.env.NODE_ENV || 'development',

  // Anthropic Claude API
  anthropicApiKey: process.env.ANTHROPIC_API_KEY || '',
  claudeModel: process.env.CLAUDE_MODEL || 'claude-sonnet-4-20250514',

  // Supabase (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤)
  supabaseUrl: process.env.SUPABASE_URL || '',
  supabaseServiceKey: process.env.SUPABASE_SERVICE_KEY || '',

  // GAS API (–¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º)
  gasApiUrl: process.env.GAS_API_URL || '',

  // CORS
  allowedOrigins: (process.env.ALLOWED_ORIGINS || 'http://localhost:5173').split(','),

  // Rate limiting
  rateLimitWindowMs: 60 * 1000, // 1 –º–∏–Ω—É—Ç–∞
  rateLimitMaxRequests: 30, // 30 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
};

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
export function validateConfig(): void {
  const required = [
    'anthropicApiKey',
    'supabaseUrl',
    'supabaseServiceKey',
    'gasApiUrl',
  ];

  const missing = required.filter(key => !config[key as keyof typeof config]);

  if (missing.length > 0) {
    throw new Error(`Missing required environment variables: ${missing.join(', ')}`);
  }
}
```

### –®–∞–≥ 1.7: –°–æ–∑–¥–∞—Ç—å middleware –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–§–∞–π–ª: `src/middleware/auth.ts`**

```typescript
import { Request, Response, NextFunction } from 'express';
import { createClient } from '@supabase/supabase-js';
import { config } from '../config/env.js';

// Supabase –∫–ª–∏–µ–Ω—Ç —Å service key –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤
const supabase = createClient(config.supabaseUrl, config.supabaseServiceKey);

export interface AuthenticatedRequest extends Request {
  user?: {
    id: string;
    email: string;
  };
}

/**
 * Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Supabase JWT
 */
export async function authMiddleware(
  req: AuthenticatedRequest,
  res: Response,
  next: NextFunction
): Promise<void> {
  try {
    // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization
    const authHeader = req.headers.authorization;

    if (!authHeader || !authHeader.startsWith('Bearer ')) {
      res.status(401).json({ error: '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏' });
      return;
    }

    const token = authHeader.substring(7);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ Supabase
    const { data: { user }, error } = await supabase.auth.getUser(token);

    if (error || !user) {
      res.status(401).json({ error: '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω' });
      return;
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ request
    req.user = {
      id: user.id,
      email: user.email || '',
    };

    next();

  } catch (error) {
    console.error('Auth middleware error:', error);
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏' });
  }
}
```

### –®–∞–≥ 1.8: –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è Claude API

**–§–∞–π–ª: `src/services/anthropic.ts`**

```typescript
import Anthropic from '@anthropic-ai/sdk';
import { config } from '../config/env.js';
import { tools, executeToolCall } from '../tools/index.js';

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ Anthropic
const anthropic = new Anthropic({
  apiKey: config.anthropicApiKey,
});

// –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
const SYSTEM_PROMPT = `–¢—ã ‚Äî AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–º–æ–≥–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º.

–¢—ã –º–æ–∂–µ—à—å:
1. –ò—Å–∫–∞—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º
2. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏ (—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –¥–∞—Ç—É –≤–≤–æ–¥–∞, –ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ)
3. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∂—É—Ä–Ω–∞–ª –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
4. –î–æ–±–∞–≤–ª—è—Ç—å –∑–∞–ø–∏—Å–∏ –≤ –∂—É—Ä–Ω–∞–ª –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
5. –ß–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π (PDF —Ñ–∞–π–ª—ã)
6. –ò—Å–∫–∞—Ç—å —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–∞—Ö –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –Ω–∞ Google Drive

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–µ–π –≤ –∂—É—Ä–Ω–∞–ª:
- –í—Å–µ–≥–¥–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- –£—Ç–æ—á–Ω—è–π –¥–µ—Ç–∞–ª–∏, –µ—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ–ø–æ–ª–Ω–∞—è
- –§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã: YYYY-MM-DD

–û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É. –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏.
–Ø–∑—ã–∫ –æ–±—â–µ–Ω–∏—è: —Ä—É—Å—Å–∫–∏–π.

–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞: ${new Date().toISOString().split('T')[0]}`;

// –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π
export interface ChatMessage {
  role: 'user' | 'assistant';
  content: string;
}

export interface ChatRequest {
  messages: ChatMessage[];
  userId: string;
}

export interface ChatResponse {
  message: string;
  toolsUsed?: string[];
}

/**
 * –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞ —á–µ—Ä–µ–∑ Claude API
 */
export async function processChatMessage(request: ChatRequest): Promise<ChatResponse> {
  try {
    const toolsUsed: string[] = [];

    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç Anthropic
    const messages: Anthropic.MessageParam[] = request.messages.map(msg => ({
      role: msg.role,
      content: msg.content,
    }));

    // –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ Claude
    let response = await anthropic.messages.create({
      model: config.claudeModel,
      max_tokens: 4096,
      system: SYSTEM_PROMPT,
      tools: tools,
      messages: messages,
    });

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º tool_use –≤ —Ü–∏–∫–ª–µ
    while (response.stop_reason === 'tool_use') {
      const toolUseBlocks = response.content.filter(
        (block): block is Anthropic.ToolUseBlock => block.type === 'tool_use'
      );

      // –í—ã–ø–æ–ª–Ω—è–µ–º –≤—Å–µ –≤—ã–∑–æ–≤—ã tools
      const toolResults: Anthropic.ToolResultBlockParam[] = [];

      for (const toolUse of toolUseBlocks) {
        console.log(`Executing tool: ${toolUse.name}`);
        toolsUsed.push(toolUse.name);

        try {
          const result = await executeToolCall(toolUse.name, toolUse.input as Record<string, unknown>);
          toolResults.push({
            type: 'tool_result',
            tool_use_id: toolUse.id,
            content: JSON.stringify(result),
          });
        } catch (error) {
          toolResults.push({
            type: 'tool_result',
            tool_use_id: toolUse.id,
            content: `–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${error instanceof Error ? error.message : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`,
            is_error: true,
          });
        }
      }

      // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã tools –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –¥–∏–∞–ª–æ–≥
      messages.push({
        role: 'assistant',
        content: response.content,
      });

      messages.push({
        role: 'user',
        content: toolResults,
      });

      // –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ Claude —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ tools
      response = await anthropic.messages.create({
        model: config.claudeModel,
        max_tokens: 4096,
        system: SYSTEM_PROMPT,
        tools: tools,
        messages: messages,
      });
    }

    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
    const textBlock = response.content.find(
      (block): block is Anthropic.TextBlock => block.type === 'text'
    );

    return {
      message: textBlock?.text || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç',
      toolsUsed: toolsUsed.length > 0 ? toolsUsed : undefined,
    };

  } catch (error) {
    console.error('Claude API error:', error);

    if (error instanceof Anthropic.APIError) {
      if (error.status === 429) {
        throw new Error('–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ.');
      }
      if (error.status === 401) {
        throw new Error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Claude API');
      }
    }

    throw error;
  }
}
```

### –®–∞–≥ 1.9: –°–æ–∑–¥–∞—Ç—å Tools –¥–ª—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è

**–§–∞–π–ª: `src/tools/equipmentTools.ts`**

```typescript
import Anthropic from '@anthropic-ai/sdk';
import { gasClient } from '../services/gasClient.js';

/**
 * Tool definitions –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º
 */
export const equipmentTools: Anthropic.Tool[] = [
  {
    name: 'get_all_equipment',
    description: '–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è. –ú–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ —Ç–∏–ø—É, —Å—Ç–∞—Ç—É—Å—É –∏–ª–∏ –∏—Å–∫–∞—Ç—å –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é.',
    input_schema: {
      type: 'object' as const,
      properties: {
        search: {
          type: 'string',
          description: '–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
        },
        type: {
          type: 'string',
          description: '–¢–∏–ø –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (filter, pump, tank, valve –∏ —Ç.–¥.)',
        },
        status: {
          type: 'string',
          enum: ['active', 'inactive', 'archived'],
          description: '–°—Ç–∞—Ç—É—Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
        },
      },
      required: [],
    },
  },
  {
    name: 'get_equipment_details',
    description: '–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–¥–Ω–æ–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏ –ø–æ –µ–≥–æ ID. –í–∫–ª—é—á–∞–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –¥–∞—Ç—ã, —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.',
    input_schema: {
      type: 'object' as const,
      properties: {
        equipment_id: {
          type: 'string',
          description: 'ID –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (UUID)',
        },
      },
      required: ['equipment_id'],
    },
  },
  {
    name: 'get_maintenance_log',
    description: '–ü–æ–ª—É—á–∏—Ç—å –∂—É—Ä–Ω–∞–ª –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö —Ä–∞–±–æ—Ç.',
    input_schema: {
      type: 'object' as const,
      properties: {
        equipment_id: {
          type: 'string',
          description: 'ID –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
        },
        status: {
          type: 'string',
          enum: ['completed', 'planned', 'in_progress', 'cancelled'],
          description: '–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –∑–∞–ø–∏—Å–∏',
        },
        limit: {
          type: 'number',
          description: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)',
        },
      },
      required: ['equipment_id'],
    },
  },
  {
    name: 'add_maintenance_entry',
    description: '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è. –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º —ç—Ç–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø–æ–∫–∞–∂–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–µ–≤—å—é –∑–∞–ø–∏—Å–∏ –∏ –∑–∞–ø—Ä–æ—Å–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.',
    input_schema: {
      type: 'object' as const,
      properties: {
        equipment_id: {
          type: 'string',
          description: 'ID –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
        },
        date: {
          type: 'string',
          description: '–î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD',
        },
        type: {
          type: 'string',
          description: '–¢–∏–ø —Ä–∞–±–æ—Ç (–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ, –†–µ–º–æ–Ω—Ç, –û—Å–º–æ—Ç—Ä, –ó–∞–º–µ–Ω–∞ –∏ —Ç.–¥.)',
        },
        description: {
          type: 'string',
          description: '–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç',
        },
        performed_by: {
          type: 'string',
          description: '–§–ò–û –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è',
        },
        status: {
          type: 'string',
          enum: ['completed', 'planned', 'in_progress'],
          description: '–°—Ç–∞—Ç—É—Å –∑–∞–ø–∏—Å–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é completed)',
        },
      },
      required: ['equipment_id', 'date', 'type', 'description', 'performed_by'],
    },
  },
];

/**
 * –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ tools –¥–ª—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
 */
export async function executeEquipmentTool(
  name: string,
  input: Record<string, unknown>
): Promise<unknown> {
  switch (name) {
    case 'get_all_equipment':
      return await gasClient.get('getAll', {
        search: input.search as string | undefined,
        type: input.type as string | undefined,
        status: input.status as string | undefined,
      });

    case 'get_equipment_details':
      return await gasClient.get('getById', {
        id: input.equipment_id as string,
      });

    case 'get_maintenance_log':
      return await gasClient.get('getMaintenanceLog', {
        equipmentId: input.equipment_id as string,
        status: input.status as string | undefined,
        limit: input.limit ? String(input.limit) : undefined,
      });

    case 'add_maintenance_entry':
      return await gasClient.post('addMaintenanceEntry', {
        equipmentId: input.equipment_id,
        date: input.date,
        type: input.type,
        description: input.description,
        performedBy: input.performed_by,
        status: input.status || 'completed',
      });

    default:
      throw new Error(`Unknown equipment tool: ${name}`);
  }
}
```

### –®–∞–≥ 1.10: –°–æ–∑–¥–∞—Ç—å Tools –¥–ª—è Google Drive

**–§–∞–π–ª: `src/tools/driveTools.ts`**

```typescript
import Anthropic from '@anthropic-ai/sdk';
import { gasClient } from '../services/gasClient.js';

/**
 * Tool definitions –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Google Drive
 */
export const driveTools: Anthropic.Tool[] = [
  {
    name: 'search_files_in_folder',
    description: '–ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –Ω–∞ Google Drive. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –∏ —Å—Å—ã–ª–∫–∞–º–∏.',
    input_schema: {
      type: 'object' as const,
      properties: {
        folder_url: {
          type: 'string',
          description: 'URL –ø–∞–ø–∫–∏ Google Drive –∏–ª–∏ ID –ø–∞–ø–∫–∏',
        },
        query: {
          type: 'string',
          description: '–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–∞',
        },
        mime_type: {
          type: 'string',
          description: '–§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É —Ñ–∞–π–ª–∞ (application/pdf, image/jpeg –∏ —Ç.–¥.)',
        },
      },
      required: ['folder_url'],
    },
  },
  {
    name: 'read_file_content',
    description: '–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∏–∑ Google Drive. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç PDF (—Å OCR), Google Docs, —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è —á—Ç–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ –ø–∞—Å–ø–æ—Ä—Ç–æ–≤ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.',
    input_schema: {
      type: 'object' as const,
      properties: {
        file_url: {
          type: 'string',
          description: 'URL —Ñ–∞–π–ª–∞ –Ω–∞ Google Drive –∏–ª–∏ –µ–≥–æ ID',
        },
        max_length: {
          type: 'number',
          description: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ –≤ —Å–∏–º–≤–æ–ª–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30000)',
        },
      },
      required: ['file_url'],
    },
  },
];

/**
 * –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ tools –¥–ª—è Google Drive
 */
export async function executeDriveTool(
  name: string,
  input: Record<string, unknown>
): Promise<unknown> {
  switch (name) {
    case 'search_files_in_folder':
      return await gasClient.get('getFolderFiles', {
        folderId: extractDriveId(input.folder_url as string),
        query: input.query as string | undefined,
        mimeType: input.mime_type as string | undefined,
      });

    case 'read_file_content':
      return await gasClient.get('getFileContent', {
        fileId: extractDriveId(input.file_url as string),
        maxLength: input.max_length ? String(input.max_length) : '30000',
      });

    default:
      throw new Error(`Unknown drive tool: ${name}`);
  }
}

/**
 * –ò–∑–≤–ª–µ—á—å ID –∏–∑ URL Google Drive
 */
function extractDriveId(urlOrId: string): string {
  if (!urlOrId) return '';

  // URL —Ñ–æ—Ä–º–∞—Ç–∞ /folders/ID
  const foldersMatch = urlOrId.match(/\/folders\/([a-zA-Z0-9_-]+)/);
  if (foldersMatch) return foldersMatch[1];

  // URL —Ñ–æ—Ä–º–∞—Ç–∞ /file/d/ID
  const fileMatch = urlOrId.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
  if (fileMatch) return fileMatch[1];

  // URL —Ñ–æ—Ä–º–∞—Ç–∞ ?id=ID
  const idMatch = urlOrId.match(/[?&]id=([a-zA-Z0-9_-]+)/);
  if (idMatch) return idMatch[1];

  // –ü—Ä—è–º–æ–π ID
  if (/^[a-zA-Z0-9_-]{20,}$/.test(urlOrId)) {
    return urlOrId;
  }

  return urlOrId;
}
```

### –®–∞–≥ 1.11: –°–æ–∑–¥–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤—Å–µ—Ö Tools

**–§–∞–π–ª: `src/tools/index.ts`**

```typescript
import Anthropic from '@anthropic-ai/sdk';
import { equipmentTools, executeEquipmentTool } from './equipmentTools.js';
import { driveTools, executeDriveTool } from './driveTools.js';

// –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ tools
export const tools: Anthropic.Tool[] = [
  ...equipmentTools,
  ...driveTools,
];

// –ú–∞–ø–ø–∏–Ω–≥ tools –∫ –∏—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º
const toolExecutors: Record<string, (name: string, input: Record<string, unknown>) => Promise<unknown>> = {
  // Equipment tools
  'get_all_equipment': executeEquipmentTool,
  'get_equipment_details': executeEquipmentTool,
  'get_maintenance_log': executeEquipmentTool,
  'add_maintenance_entry': executeEquipmentTool,

  // Drive tools
  'search_files_in_folder': executeDriveTool,
  'read_file_content': executeDriveTool,
};

/**
 * –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—ã–∑–æ–≤ tool –ø–æ –∏–º–µ–Ω–∏
 */
export async function executeToolCall(
  name: string,
  input: Record<string, unknown>
): Promise<unknown> {
  const executor = toolExecutors[name];

  if (!executor) {
    throw new Error(`Unknown tool: ${name}`);
  }

  return await executor(name, input);
}
```

### –®–∞–≥ 1.12: –°–æ–∑–¥–∞—Ç—å GAS –∫–ª–∏–µ–Ω—Ç

**–§–∞–π–ª: `src/services/gasClient.ts`**

```typescript
import { config } from '../config/env.js';

interface GasResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
}

/**
 * –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Google Apps Script API
 */
class GasClient {
  private baseUrl: string;

  constructor() {
    this.baseUrl = config.gasApiUrl;
  }

  /**
   * GET –∑–∞–ø—Ä–æ—Å –∫ GAS API
   */
  async get<T>(action: string, params?: Record<string, string | undefined>): Promise<T> {
    const url = new URL(this.baseUrl);
    url.searchParams.append('action', action);

    if (params) {
      Object.entries(params).forEach(([key, value]) => {
        if (value !== undefined) {
          url.searchParams.append(key, value);
        }
      });
    }

    const response = await fetch(url.toString(), {
      method: 'GET',
      headers: {
        'Accept': 'application/json',
      },
    });

    if (!response.ok) {
      throw new Error(`GAS API error: ${response.status} ${response.statusText}`);
    }

    const json = await response.json() as GasResponse<T>;

    if (!json.success) {
      throw new Error(json.error || 'Unknown GAS API error');
    }

    return json.data as T;
  }

  /**
   * POST –∑–∞–ø—Ä–æ—Å –∫ GAS API
   */
  async post<T>(action: string, data: Record<string, unknown>): Promise<T> {
    const response = await fetch(this.baseUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json',
      },
      body: JSON.stringify({ action, ...data }),
    });

    if (!response.ok) {
      throw new Error(`GAS API error: ${response.status} ${response.statusText}`);
    }

    const json = await response.json() as GasResponse<T>;

    if (!json.success) {
      throw new Error(json.error || 'Unknown GAS API error');
    }

    return json.data as T;
  }
}

export const gasClient = new GasClient();
```

### –®–∞–≥ 1.13: –°–æ–∑–¥–∞—Ç—å —Ä–æ—É—Ç –¥–ª—è —á–∞—Ç–∞

**–§–∞–π–ª: `src/routes/chat.ts`**

```typescript
import { Router, Response } from 'express';
import { processChatMessage, ChatMessage } from '../services/anthropic.js';
import { authMiddleware, AuthenticatedRequest } from '../middleware/auth.js';

const router = Router();

interface ChatRequestBody {
  messages: ChatMessage[];
}

/**
 * POST /api/chat
 * –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞
 */
router.post('/', authMiddleware, async (req: AuthenticatedRequest, res: Response) => {
  try {
    const { messages } = req.body as ChatRequestBody;

    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!messages || !Array.isArray(messages) || messages.length === 0) {
      res.status(400).json({ error: 'Messages array is required' });
      return;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
    for (const msg of messages) {
      if (!msg.role || !msg.content) {
        res.status(400).json({ error: 'Invalid message format' });
        return;
      }
      if (msg.role !== 'user' && msg.role !== 'assistant') {
        res.status(400).json({ error: 'Invalid message role' });
        return;
      }
    }

    console.log(`Chat request from user ${req.user?.email}, messages: ${messages.length}`);

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Claude
    const response = await processChatMessage({
      messages,
      userId: req.user?.id || '',
    });

    res.json({
      success: true,
      data: response,
    });

  } catch (error) {
    console.error('Chat error:', error);

    const message = error instanceof Error ? error.message : 'Unknown error';
    res.status(500).json({
      success: false,
      error: message,
    });
  }
});

export default router;
```

### –®–∞–≥ 1.14: –°–æ–∑–¥–∞—Ç—å —Ä–æ—É—Ç health check

**–§–∞–π–ª: `src/routes/health.ts`**

```typescript
import { Router, Request, Response } from 'express';

const router = Router();

/**
 * GET /health
 * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞
 */
router.get('/', (_req: Request, res: Response) => {
  res.json({
    status: 'ok',
    timestamp: new Date().toISOString(),
    version: process.env.npm_package_version || '1.0.0',
  });
});

export default router;
```

### –®–∞–≥ 1.15: –°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞

**–§–∞–π–ª: `src/index.ts`**

```typescript
import express from 'express';
import cors from 'cors';
import helmet from 'helmet';
import { config, validateConfig } from './config/env.js';
import chatRouter from './routes/chat.js';
import healthRouter from './routes/health.js';

// –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
validateConfig();

// –°–æ–∑–¥–∞—ë–º Express –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
const app = express();

// Middleware –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
app.use(helmet());

// CORS
app.use(cors({
  origin: config.allowedOrigins,
  credentials: true,
}));

// –ü–∞—Ä—Å–∏–Ω–≥ JSON
app.use(express.json({ limit: '1mb' }));

// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
app.use((req, res, next) => {
  console.log(`${new Date().toISOString()} ${req.method} ${req.path}`);
  next();
});

// –†–æ—É—Ç—ã
app.use('/health', healthRouter);
app.use('/api/chat', chatRouter);

// –û–±—Ä–∞–±–æ—Ç–∫–∞ 404
app.use((_req, res) => {
  res.status(404).json({ error: 'Not found' });
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
app.use((err: Error, _req: express.Request, res: express.Response, _next: express.NextFunction) => {
  console.error('Unhandled error:', err);
  res.status(500).json({ error: 'Internal server error' });
});

// –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
app.listen(config.port, () => {
  console.log(`
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë   AI Consultant API Server                   ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë   Port: ${config.port.toString().padEnd(37)}‚ïë
‚ïë   Environment: ${config.nodeEnv.padEnd(30)}‚ïë
‚ïë   Allowed origins: ${config.allowedOrigins.length.toString().padEnd(25)}‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
  `);
});
```

### –®–∞–≥ 1.16: –°–æ–∑–¥–∞—Ç—å Dockerfile

**–§–∞–π–ª: `Dockerfile`**

```dockerfile
FROM node:20-alpine

WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º package files
COPY package*.json ./

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN npm ci --only=production

# –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
COPY . .

# –°–æ–±–∏—Ä–∞–µ–º TypeScript
RUN npm run build

# –ü–æ—Ä—Ç
EXPOSE 3001

# –ó–∞–ø—É—Å–∫
CMD ["npm", "start"]
```

### –®–∞–≥ 1.17: –°–æ–∑–¥–∞—Ç—å railway.toml

**–§–∞–π–ª: `railway.toml`**

```toml
[build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

[deploy]
startCommand = "npm start"
healthcheckPath = "/health"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
```

### –®–∞–≥ 1.18: –°–æ–∑–¥–∞—Ç—å .env.example

**–§–∞–π–ª: `.env.example`**

```env
# Server
PORT=3001
NODE_ENV=development

# Anthropic Claude API
ANTHROPIC_API_KEY=sk-ant-api03-xxxxx

# Claude Model (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è claude-sonnet-4-20250514)
CLAUDE_MODEL=claude-sonnet-4-20250514

# Supabase
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.xxxxx

# GAS API URL
GAS_API_URL=https://script.google.com/macros/s/xxxxx/exec

# CORS (—Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã–µ –∑–∞–ø—è—Ç–æ–π origins)
ALLOWED_ORIGINS=https://your-app.railway.app,http://localhost:5173
```

---

## –ß–∞—Å—Ç—å 2: –î–µ–ø–ª–æ–π –Ω–∞ Railway

### –®–∞–≥ 2.1: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –Ω–∞ Railway

1. –í–æ–π—Ç–∏ –≤ [Railway](https://railway.app)
2. –û—Ç–∫—Ä—ã—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–µ–∫—Ç —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
3. –ù–∞–∂–∞—Ç—å **"+ New"** ‚Üí **"GitHub Repo"**
4. –í—ã–±—Ä–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–µ—Å–ª–∏ API –≤ —Ç–æ–º –∂–µ —Ä–µ–ø–æ ‚Äî –≤—ã–±—Ä–∞—Ç—å –µ–≥–æ)
5. –£–∫–∞–∑–∞—Ç—å –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ: `ai-consultant-api`

### –®–∞–≥ 2.2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ Railway –¥–æ–±–∞–≤–∏—Ç—å:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------------|----------|
| `PORT` | `3001` |
| `NODE_ENV` | `production` |
| `ANTHROPIC_API_KEY` | `sk-ant-api03-...` (–ø–æ–ª—É—á–∏—Ç—å –Ω–∞ [console.anthropic.com](https://console.anthropic.com)) |
| `CLAUDE_MODEL` | `claude-sonnet-4-20250514` |
| `SUPABASE_URL` | URL –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Supabase |
| `SUPABASE_SERVICE_KEY` | Service Role Key –∏–∑ Supabase |
| `GAS_API_URL` | URL –≤–∞—à–µ–≥–æ GAS Web App |
| `ALLOWED_ORIGINS` | `https://your-app.railway.app` |

### –®–∞–≥ 2.3: –ü–æ–ª—É—á–∏—Ç—å URL —Å–µ—Ä–≤–∏—Å–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è Railway –≤—ã–¥–∞—Å—Ç URL –≤–∏–¥–∞:
```
https://ai-consultant-api-production-xxxx.up.railway.app
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç URL ‚Äî –æ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.

### –®–∞–≥ 2.4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É API

```bash
curl https://ai-consultant-api-production-xxxx.up.railway.app/health
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{"status":"ok","timestamp":"2024-01-15T10:30:00.000Z","version":"1.0.0"}
```

---

## –ß–∞—Å—Ç—å 3: Frontend ‚Äî –ß–∞—Ç-–≤–∏–¥–∂–µ—Ç

### –®–∞–≥ 3.1: –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

–°–æ–∑–¥–∞—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:

```
src/features/ai-consultant/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ChatWidget.tsx        # –û—Å–Ω–æ–≤–Ω–æ–π –≤–∏–¥–∂–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ ChatWidget.css        # –°—Ç–∏–ª–∏ –≤–∏–¥–∂–µ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ ChatMessage.tsx       # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ ChatInput.tsx         # –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º
‚îÇ   ‚îî‚îÄ‚îÄ VoiceButton.tsx       # –ö–Ω–æ–ø–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useChat.ts            # –•—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —á–∞—Ç–æ–º
‚îÇ   ‚îî‚îÄ‚îÄ useSpeechRecognition.ts # –•—É–∫ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ consultantApi.ts      # API –∫–ª–∏–µ–Ω—Ç
‚îî‚îÄ‚îÄ types/
    ‚îî‚îÄ‚îÄ index.ts              # TypeScript —Ç–∏–ø—ã
```

### –®–∞–≥ 3.2: –°–æ–∑–¥–∞—Ç—å API –∫–ª–∏–µ–Ω—Ç

**–§–∞–π–ª: `src/features/ai-consultant/services/consultantApi.ts`**

```typescript
import { supabase } from '../../auth/supabase';

// URL API (–∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è)
const API_URL = import.meta.env.VITE_AI_CONSULTANT_API_URL || '';

export interface ChatMessage {
  role: 'user' | 'assistant';
  content: string;
}

export interface ChatResponse {
  success: boolean;
  data?: {
    message: string;
    toolsUsed?: string[];
  };
  error?: string;
}

/**
 * –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç
 */
export async function sendChatMessage(messages: ChatMessage[]): Promise<ChatResponse> {
  // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ç–æ–∫–µ–Ω —Å–µ—Å—Å–∏–∏
  const { data: { session } } = await supabase.auth.getSession();

  if (!session?.access_token) {
    throw new Error('–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
  }

  const response = await fetch(`${API_URL}/api/chat`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${session.access_token}`,
    },
    body: JSON.stringify({ messages }),
  });

  if (!response.ok) {
    const errorData = await response.json().catch(() => ({}));
    throw new Error(errorData.error || `HTTP ${response.status}`);
  }

  return await response.json();
}
```

### –®–∞–≥ 3.3: –°–æ–∑–¥–∞—Ç—å —Ö—É–∫ –¥–ª—è —á–∞—Ç–∞

**–§–∞–π–ª: `src/features/ai-consultant/hooks/useChat.ts`**

```typescript
import { useState, useCallback } from 'react';
import { ChatMessage, sendChatMessage } from '../services/consultantApi';

export interface UseChatReturn {
  messages: ChatMessage[];
  isLoading: boolean;
  error: string | null;
  sendMessage: (text: string) => Promise<void>;
  clearMessages: () => void;
}

export function useChat(): UseChatReturn {
  const [messages, setMessages] = useState<ChatMessage[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const sendMessage = useCallback(async (text: string) => {
    if (!text.trim() || isLoading) return;

    setError(null);
    setIsLoading(true);

    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const userMessage: ChatMessage = { role: 'user', content: text };
    const newMessages = [...messages, userMessage];
    setMessages(newMessages);

    try {
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      const response = await sendChatMessage(newMessages);

      if (response.success && response.data) {
        // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
        const assistantMessage: ChatMessage = {
          role: 'assistant',
          content: response.data.message,
        };
        setMessages([...newMessages, assistantMessage]);
      } else {
        setError(response.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
      }

    } catch (err) {
      setError(err instanceof Error ? err.message : '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
      // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
      setMessages(messages);
    } finally {
      setIsLoading(false);
    }
  }, [messages, isLoading]);

  const clearMessages = useCallback(() => {
    setMessages([]);
    setError(null);
  }, []);

  return {
    messages,
    isLoading,
    error,
    sendMessage,
    clearMessages,
  };
}
```

### –®–∞–≥ 3.4: –°–æ–∑–¥–∞—Ç—å —Ö—É–∫ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞

**–§–∞–π–ª: `src/features/ai-consultant/hooks/useSpeechRecognition.ts`**

```typescript
import { useState, useCallback, useRef, useEffect } from 'react';

// –¢–∏–ø—ã –¥–ª—è Web Speech API
interface SpeechRecognitionEvent {
  results: SpeechRecognitionResultList;
  resultIndex: number;
}

interface SpeechRecognitionError {
  error: string;
  message?: string;
}

interface SpeechRecognition extends EventTarget {
  continuous: boolean;
  interimResults: boolean;
  lang: string;
  start: () => void;
  stop: () => void;
  abort: () => void;
  onresult: ((event: SpeechRecognitionEvent) => void) | null;
  onerror: ((event: SpeechRecognitionError) => void) | null;
  onend: (() => void) | null;
}

declare global {
  interface Window {
    SpeechRecognition?: new () => SpeechRecognition;
    webkitSpeechRecognition?: new () => SpeechRecognition;
  }
}

export interface UseSpeechRecognitionReturn {
  isSupported: boolean;
  isListening: boolean;
  transcript: string;
  error: string | null;
  startListening: () => void;
  stopListening: () => void;
  resetTranscript: () => void;
}

export function useSpeechRecognition(): UseSpeechRecognitionReturn {
  const [isListening, setIsListening] = useState(false);
  const [transcript, setTranscript] = useState('');
  const [error, setError] = useState<string | null>(null);

  const recognitionRef = useRef<SpeechRecognition | null>(null);

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É
  const isSupported = typeof window !== 'undefined' &&
    !!(window.SpeechRecognition || window.webkitSpeechRecognition);

  useEffect(() => {
    if (!isSupported) return;

    const SpeechRecognitionAPI = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognitionAPI) return;

    const recognition = new SpeechRecognitionAPI();
    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.lang = 'ru-RU';

    recognition.onresult = (event: SpeechRecognitionEvent) => {
      let finalTranscript = '';

      for (let i = event.resultIndex; i < event.results.length; i++) {
        const result = event.results[i];
        if (result.isFinal) {
          finalTranscript += result[0].transcript;
        }
      }

      if (finalTranscript) {
        setTranscript(prev => prev + finalTranscript);
      }
    };

    recognition.onerror = (event: SpeechRecognitionError) => {
      console.error('Speech recognition error:', event.error);

      switch (event.error) {
        case 'no-speech':
          setError('–†–µ—á—å –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
          break;
        case 'audio-capture':
          setError('–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.');
          break;
        case 'not-allowed':
          setError('–î–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –∑–∞–ø—Ä–µ—â—ë–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.');
          break;
        default:
          setError(`–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è: ${event.error}`);
      }

      setIsListening(false);
    };

    recognition.onend = () => {
      setIsListening(false);
    };

    recognitionRef.current = recognition;

    return () => {
      recognition.abort();
    };
  }, [isSupported]);

  const startListening = useCallback(() => {
    if (!recognitionRef.current || isListening) return;

    setError(null);
    setTranscript('');

    try {
      recognitionRef.current.start();
      setIsListening(true);
    } catch (err) {
      console.error('Failed to start recognition:', err);
      setError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ');
    }
  }, [isListening]);

  const stopListening = useCallback(() => {
    if (!recognitionRef.current || !isListening) return;

    recognitionRef.current.stop();
    setIsListening(false);
  }, [isListening]);

  const resetTranscript = useCallback(() => {
    setTranscript('');
    setError(null);
  }, []);

  return {
    isSupported,
    isListening,
    transcript,
    error,
    startListening,
    stopListening,
    resetTranscript,
  };
}
```

### –®–∞–≥ 3.5: –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

**–§–∞–π–ª: `src/features/ai-consultant/components/ChatMessage.tsx`**

```tsx
import React from 'react';
import './ChatWidget.css';

interface ChatMessageProps {
  role: 'user' | 'assistant';
  content: string;
}

export const ChatMessage: React.FC<ChatMessageProps> = ({ role, content }) => {
  return (
    <div className={`ai-chat-message ai-chat-message--${role}`}>
      <div className="ai-chat-message__avatar">
        {role === 'user' ? 'üë§' : 'ü§ñ'}
      </div>
      <div className="ai-chat-message__content">
        <div className="ai-chat-message__text">
          {content.split('\n').map((line, index) => (
            <React.Fragment key={index}>
              {line}
              {index < content.split('\n').length - 1 && <br />}
            </React.Fragment>
          ))}
        </div>
      </div>
    </div>
  );
};
```

### –®–∞–≥ 3.6: –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–ª—è –≤–≤–æ–¥–∞

**–§–∞–π–ª: `src/features/ai-consultant/components/ChatInput.tsx`**

```tsx
import React, { useState, useRef, useEffect } from 'react';
import { VoiceButton } from './VoiceButton';
import './ChatWidget.css';

interface ChatInputProps {
  onSend: (text: string) => void;
  isLoading: boolean;
  voiceTranscript?: string;
  onVoiceTranscriptUsed?: () => void;
}

export const ChatInput: React.FC<ChatInputProps> = ({
  onSend,
  isLoading,
  voiceTranscript,
  onVoiceTranscriptUsed,
}) => {
  const [text, setText] = useState('');
  const textareaRef = useRef<HTMLTextAreaElement>(null);

  // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞
  useEffect(() => {
    if (voiceTranscript) {
      setText(prev => prev + (prev ? ' ' : '') + voiceTranscript);
      onVoiceTranscriptUsed?.();
    }
  }, [voiceTranscript, onVoiceTranscriptUsed]);

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã textarea
  useEffect(() => {
    if (textareaRef.current) {
      textareaRef.current.style.height = 'auto';
      textareaRef.current.style.height = `${Math.min(textareaRef.current.scrollHeight, 120)}px`;
    }
  }, [text]);

  const handleSubmit = (e?: React.FormEvent) => {
    e?.preventDefault();

    if (text.trim() && !isLoading) {
      onSend(text.trim());
      setText('');
    }
  };

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSubmit();
    }
  };

  return (
    <form className="ai-chat-input" onSubmit={handleSubmit}>
      <textarea
        ref={textareaRef}
        value={text}
        onChange={(e) => setText(e.target.value)}
        onKeyDown={handleKeyDown}
        placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –æ–± –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏..."
        disabled={isLoading}
        rows={1}
        className="ai-chat-input__textarea"
      />

      <VoiceButton disabled={isLoading} />

      <button
        type="submit"
        disabled={!text.trim() || isLoading}
        className="ai-chat-input__send"
        title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
      >
        {isLoading ? '‚è≥' : '‚û§'}
      </button>
    </form>
  );
};
```

### –®–∞–≥ 3.7: –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–Ω–æ–ø–∫–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞

**–§–∞–π–ª: `src/features/ai-consultant/components/VoiceButton.tsx`**

```tsx
import React from 'react';
import { useSpeechRecognition } from '../hooks/useSpeechRecognition';
import './ChatWidget.css';

interface VoiceButtonProps {
  disabled?: boolean;
  onTranscript?: (text: string) => void;
}

export const VoiceButton: React.FC<VoiceButtonProps> = ({ disabled, onTranscript }) => {
  const {
    isSupported,
    isListening,
    transcript,
    error,
    startListening,
    stopListening,
    resetTranscript,
  } = useSpeechRecognition();

  // –í—ã–∑—ã–≤–∞–µ–º callback –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
  React.useEffect(() => {
    if (transcript && onTranscript) {
      onTranscript(transcript);
      resetTranscript();
    }
  }, [transcript, onTranscript, resetTranscript]);

  if (!isSupported) {
    return null; // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É, –µ—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç
  }

  const handleClick = () => {
    if (isListening) {
      stopListening();
    } else {
      startListening();
    }
  };

  return (
    <button
      type="button"
      onClick={handleClick}
      disabled={disabled}
      className={`ai-chat-voice-btn ${isListening ? 'ai-chat-voice-btn--listening' : ''}`}
      title={isListening ? '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å' : '–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥'}
    >
      {isListening ? 'üî¥' : 'üé§'}
      {error && <span className="ai-chat-voice-error">{error}</span>}
    </button>
  );
};
```

### –®–∞–≥ 3.8: –°–æ–∑–¥–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –≤–∏–¥–∂–µ—Ç —á–∞—Ç–∞

**–§–∞–π–ª: `src/features/ai-consultant/components/ChatWidget.tsx`**

```tsx
import React, { useState, useRef, useEffect } from 'react';
import { useChat } from '../hooks/useChat';
import { useSpeechRecognition } from '../hooks/useSpeechRecognition';
import { ChatMessage } from './ChatMessage';
import { ChatInput } from './ChatInput';
import './ChatWidget.css';

interface ChatWidgetProps {
  initialOpen?: boolean;
}

export const ChatWidget: React.FC<ChatWidgetProps> = ({ initialOpen = false }) => {
  const [isOpen, setIsOpen] = useState(initialOpen);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  const { messages, isLoading, error, sendMessage, clearMessages } = useChat();
  const { transcript, resetTranscript } = useSpeechRecognition();

  // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  const toggleOpen = () => {
    setIsOpen(!isOpen);
  };

  const handleVoiceTranscriptUsed = () => {
    resetTranscript();
  };

  return (
    <div className={`ai-chat-widget ${isOpen ? 'ai-chat-widget--open' : ''}`}>
      {/* –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è */}
      <button
        className="ai-chat-widget__toggle"
        onClick={toggleOpen}
        title={isOpen ? '–ó–∞–∫—Ä—ã—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞' : 'AI –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç'}
      >
        {isOpen ? '‚úï' : 'üí¨'}
      </button>

      {/* –û–∫–Ω–æ —á–∞—Ç–∞ */}
      {isOpen && (
        <div className="ai-chat-widget__window">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="ai-chat-widget__header">
            <span className="ai-chat-widget__title">
              ü§ñ AI –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç
            </span>
            <button
              className="ai-chat-widget__clear"
              onClick={clearMessages}
              title="–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é"
            >
              üóëÔ∏è
            </button>
          </div>

          {/* –°–æ–æ–±—â–µ–Ω–∏—è */}
          <div className="ai-chat-widget__messages">
            {messages.length === 0 && (
              <div className="ai-chat-widget__welcome">
                <p>üëã –ü—Ä–∏–≤–µ—Ç! –Ø AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—é.</p>
                <p>–í—ã –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å –º–µ–Ω—è:</p>
                <ul>
                  <li>¬´–ü–æ–∫–∞–∂–∏ —Å–ø–∏—Å–æ–∫ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è¬ª</li>
                  <li>¬´–ù–∞–π–¥–∏ —Ñ–∏–ª—å—Ç—Ä –æ–±–µ–∑–∂–µ–ª–µ–∑–∏–≤–∞–Ω–∏—è¬ª</li>
                  <li>¬´–ü–æ–∫–∞–∂–∏ –∂—É—Ä–Ω–∞–ª –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∫–æ—Ç–ª–∞¬ª</li>
                  <li>¬´–î–æ–±–∞–≤—å –∑–∞–ø–∏—Å—å –æ —Ä–µ–º–æ–Ω—Ç–µ¬ª</li>
                  <li>¬´–ü—Ä–æ—á–∏—Ç–∞–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∫ –Ω–∞—Å–æ—Å—É¬ª</li>
                </ul>
              </div>
            )}

            {messages.map((msg, index) => (
              <ChatMessage key={index} role={msg.role} content={msg.content} />
            ))}

            {isLoading && (
              <div className="ai-chat-widget__loading">
                <span className="ai-chat-widget__loading-dots">
                  <span>.</span><span>.</span><span>.</span>
                </span>
                –î—É–º–∞—é...
              </div>
            )}

            {error && (
              <div className="ai-chat-widget__error">
                ‚ùå {error}
              </div>
            )}

            <div ref={messagesEndRef} />
          </div>

          {/* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */}
          <ChatInput
            onSend={sendMessage}
            isLoading={isLoading}
            voiceTranscript={transcript}
            onVoiceTranscriptUsed={handleVoiceTranscriptUsed}
          />
        </div>
      )}
    </div>
  );
};
```

### –®–∞–≥ 3.9: –°–æ–∑–¥–∞—Ç—å —Å—Ç–∏–ª–∏ –≤–∏–¥–∂–µ—Ç–∞

**–§–∞–π–ª: `src/features/ai-consultant/components/ChatWidget.css`**

```css
/* ==========================================
   AI Chat Widget Styles
   ========================================== */

/* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ */
:root {
  --ai-chat-primary: #2563eb;
  --ai-chat-primary-hover: #1d4ed8;
  --ai-chat-bg: #ffffff;
  --ai-chat-border: #e5e7eb;
  --ai-chat-text: #1f2937;
  --ai-chat-text-muted: #6b7280;
  --ai-chat-user-bg: #2563eb;
  --ai-chat-user-text: #ffffff;
  --ai-chat-assistant-bg: #f3f4f6;
  --ai-chat-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
  --ai-chat-radius: 16px;
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.ai-chat-widget {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 9999;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

/* –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è */
.ai-chat-widget__toggle {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: none;
  background: var(--ai-chat-primary);
  color: white;
  font-size: 24px;
  cursor: pointer;
  box-shadow: var(--ai-chat-shadow);
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.ai-chat-widget__toggle:hover {
  background: var(--ai-chat-primary-hover);
  transform: scale(1.05);
}

.ai-chat-widget--open .ai-chat-widget__toggle {
  position: absolute;
  bottom: 0;
  right: 0;
  width: 40px;
  height: 40px;
  font-size: 18px;
  z-index: 10;
}

/* –û–∫–Ω–æ —á–∞—Ç–∞ */
.ai-chat-widget__window {
  position: absolute;
  bottom: 70px;
  right: 0;
  width: 380px;
  max-width: calc(100vw - 40px);
  height: 550px;
  max-height: calc(100vh - 100px);
  background: var(--ai-chat-bg);
  border-radius: var(--ai-chat-radius);
  box-shadow: var(--ai-chat-shadow);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  animation: ai-chat-slide-up 0.3s ease;
}

@keyframes ai-chat-slide-up {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
.ai-chat-widget__header {
  padding: 16px 20px;
  background: var(--ai-chat-primary);
  color: white;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.ai-chat-widget__title {
  font-weight: 600;
  font-size: 16px;
}

.ai-chat-widget__clear {
  background: transparent;
  border: none;
  color: white;
  font-size: 16px;
  cursor: pointer;
  opacity: 0.8;
  transition: opacity 0.2s;
}

.ai-chat-widget__clear:hover {
  opacity: 1;
}

/* –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π */
.ai-chat-widget__messages {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ */
.ai-chat-widget__welcome {
  background: var(--ai-chat-assistant-bg);
  padding: 16px;
  border-radius: 12px;
  font-size: 14px;
  color: var(--ai-chat-text);
}

.ai-chat-widget__welcome p {
  margin: 0 0 8px;
}

.ai-chat-widget__welcome ul {
  margin: 8px 0 0;
  padding-left: 20px;
}

.ai-chat-widget__welcome li {
  margin: 4px 0;
  color: var(--ai-chat-text-muted);
}

/* –°–æ–æ–±—â–µ–Ω–∏–µ */
.ai-chat-message {
  display: flex;
  gap: 10px;
  max-width: 90%;
}

.ai-chat-message--user {
  align-self: flex-end;
  flex-direction: row-reverse;
}

.ai-chat-message--assistant {
  align-self: flex-start;
}

.ai-chat-message__avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--ai-chat-border);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
}

.ai-chat-message--user .ai-chat-message__avatar {
  background: var(--ai-chat-user-bg);
}

.ai-chat-message__content {
  flex: 1;
}

.ai-chat-message__text {
  padding: 10px 14px;
  border-radius: 16px;
  font-size: 14px;
  line-height: 1.5;
  word-wrap: break-word;
}

.ai-chat-message--user .ai-chat-message__text {
  background: var(--ai-chat-user-bg);
  color: var(--ai-chat-user-text);
  border-bottom-right-radius: 4px;
}

.ai-chat-message--assistant .ai-chat-message__text {
  background: var(--ai-chat-assistant-bg);
  color: var(--ai-chat-text);
  border-bottom-left-radius: 4px;
}

/* –ó–∞–≥—Ä—É–∑–∫–∞ */
.ai-chat-widget__loading {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--ai-chat-text-muted);
  font-size: 14px;
  padding: 10px;
}

.ai-chat-widget__loading-dots span {
  animation: ai-chat-dots 1.4s infinite;
  animation-fill-mode: both;
}

.ai-chat-widget__loading-dots span:nth-child(2) {
  animation-delay: 0.2s;
}

.ai-chat-widget__loading-dots span:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes ai-chat-dots {
  0%, 80%, 100% { opacity: 0; }
  40% { opacity: 1; }
}

/* –û—à–∏–±–∫–∞ */
.ai-chat-widget__error {
  background: #fef2f2;
  color: #dc2626;
  padding: 10px 14px;
  border-radius: 8px;
  font-size: 13px;
}

/* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
.ai-chat-input {
  display: flex;
  align-items: flex-end;
  gap: 8px;
  padding: 12px 16px;
  border-top: 1px solid var(--ai-chat-border);
  background: var(--ai-chat-bg);
}

.ai-chat-input__textarea {
  flex: 1;
  border: 1px solid var(--ai-chat-border);
  border-radius: 20px;
  padding: 10px 16px;
  font-size: 14px;
  resize: none;
  max-height: 120px;
  font-family: inherit;
  outline: none;
  transition: border-color 0.2s;
}

.ai-chat-input__textarea:focus {
  border-color: var(--ai-chat-primary);
}

.ai-chat-input__textarea:disabled {
  background: #f9fafb;
}

.ai-chat-input__send {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: none;
  background: var(--ai-chat-primary);
  color: white;
  font-size: 18px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.ai-chat-input__send:hover:not(:disabled) {
  background: var(--ai-chat-primary-hover);
}

.ai-chat-input__send:disabled {
  background: var(--ai-chat-border);
  cursor: not-allowed;
}

/* –ö–Ω–æ–ø–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ */
.ai-chat-voice-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 1px solid var(--ai-chat-border);
  background: white;
  font-size: 18px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.ai-chat-voice-btn:hover:not(:disabled) {
  background: #f9fafb;
}

.ai-chat-voice-btn--listening {
  background: #fef2f2;
  border-color: #dc2626;
  animation: ai-chat-pulse 1.5s infinite;
}

@keyframes ai-chat-pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.ai-chat-voice-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
@media (max-width: 480px) {
  .ai-chat-widget__window {
    width: 100%;
    height: calc(100vh - 80px);
    max-height: none;
    bottom: 0;
    right: 0;
    border-radius: var(--ai-chat-radius) var(--ai-chat-radius) 0 0;
  }

  .ai-chat-widget--open .ai-chat-widget__toggle {
    top: 10px;
    right: 10px;
    bottom: auto;
  }
}
```

### –®–∞–≥ 3.10: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–§–∞–π–ª: `src/App.tsx` (–¥–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)**

```tsx
// –í –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ –¥–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç
import { ChatWidget } from './features/ai-consultant/components/ChatWidget';

// –í –∫–æ–Ω–µ—Ü JSX (–ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º —Ç–µ–≥–æ–º) –¥–æ–±–∞–≤–∏—Ç—å
<ChatWidget />
```

### –®–∞–≥ 3.11: –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

**–§–∞–π–ª: `.env` (–ª–æ–∫–∞–ª—å–Ω–æ)**

```env
VITE_AI_CONSULTANT_API_URL=http://localhost:3001
```

**–ù–∞ Railway** –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-—Å–µ—Ä–≤–∏—Å–∞:

```
VITE_AI_CONSULTANT_API_URL=https://ai-consultant-api-production-xxxx.up.railway.app
```

---

## –ß–∞—Å—Ç—å 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —á—Ç–µ–Ω–∏–µ–º PDF

### –®–∞–≥ 4.1: –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é getFileContent –≤ GAS

–ï—Å–ª–∏ –≤—ã —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∏–∑ `PDF_READING_IMPLEMENTATION.md`, —Ç–æ tools –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ —É–∂–µ –≥–æ—Ç–æ–≤—ã.

–ï—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ —Ñ–∞–π–ª–µ `docs/PDF_READING_IMPLEMENTATION.md`.

### –®–∞–≥ 4.2: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ Code.gs

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `Code.gs` –µ—Å—Ç—å case –¥–ª—è `getFileContent`:

```javascript
case 'getFileContent':
  return handleGetFileContent(params);
```

---

## –ß–∞—Å—Ç—å 5: –†–∞–±–æ—Ç–∞ —Å —Ñ–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è

–≠—Ç–∞ —á–∞—Å—Ç—å –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∫ –∑–∞–ø–∏—Å—è–º –∂—É—Ä–Ω–∞–ª–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ç–æ

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ë—Ä–∞—É–∑–µ—Ä       ‚îÇ     ‚îÇ   Railway API    ‚îÇ     ‚îÇ   Google Apps   ‚îÇ
‚îÇ   (–ö–∞–º–µ—Ä–∞/      ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   (Base64)       ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Script        ‚îÇ
‚îÇ   –ì–∞–ª–µ—Ä–µ—è)      ‚îÇ     ‚îÇ                  ‚îÇ     ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                          ‚îÇ
                                                          ‚ñº
                                               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                               ‚îÇ   Google Drive      ‚îÇ
                                               ‚îÇ   üìÅ –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ/  ‚îÇ
                                               ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ –§–∏–ª—å—Ç—Ä ‚Ññ1/ ‚îÇ
                                               ‚îÇ       ‚îî‚îÄ‚îÄ üìÅ –§–æ—Ç–æ   ‚îÇ
                                               ‚îÇ           –æ–±—Å–ª—É–∂./  ‚îÇ
                                               ‚îÇ           ‚îî‚îÄ‚îÄ üì∑    ‚îÇ
                                               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –Ω–∞ Google Drive

```
üìÅ –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ/
‚îú‚îÄ‚îÄ üìÅ –§–∏–ª—å—Ç—Ä –æ–±–µ–∑–∂–µ–ª–µ–∑–∏–≤–∞–Ω–∏—è ‚Ññ1/
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ –ü–∞—Å–ø–æ—Ä—Ç.pdf
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ –ñ—É—Ä–Ω–∞–ª –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è (Google Sheet)
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ –§–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è/           ‚Üê –°–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
‚îÇ       ‚îú‚îÄ‚îÄ üì∑ 2024-01-15_–¢–û_–∑–∞–º–µ–Ω–∞_—Ñ–∏–ª—å—Ç—Ä–∞.jpg
‚îÇ       ‚îú‚îÄ‚îÄ üì∑ 2024-01-20_–û—Å–º–æ—Ç—Ä.jpg
‚îÇ       ‚îî‚îÄ‚îÄ üì∑ 2024-02-01_–†–µ–º–æ–Ω—Ç_–∫–æ—Ä–ø—É—Å–∞.jpg
```

### –®–∞–≥ 5.1: –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ç–æ –≤ GAS

**–§–∞–π–ª: `DriveOperations.gs` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü:**

```javascript
// ============================================================================
// –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° –§–û–¢–û –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø
// ============================================================================

/**
 * –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –≤ –ø–∞–ø–∫—É –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
 *
 * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –ø–æ–¥–ø–∞–ø–∫—É "–§–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è" –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç.
 * –ò–º—è —Ñ–∞–π–ª–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∏–∑ –¥–∞—Ç—ã –∏ –æ–ø–∏—Å–∞–Ω–∏—è.
 *
 * @param {Object} params - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏
 * @param {string} params.equipmentFolderId - ID –ø–∞–ø–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –≤ Google Drive
 * @param {string} params.photoBase64 - –§–æ—Ç–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Base64
 * @param {string} params.mimeType - MIME —Ç–∏–ø (image/jpeg, image/png)
 * @param {string} params.description - –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ç–æ (–¥–ª—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞)
 * @param {string} params.date - –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD
 * @param {string} params.maintenanceType - –¢–∏–ø —Ä–∞–±–æ—Ç (–¢–û, –†–µ–º–æ–Ω—Ç, –û—Å–º–æ—Ç—Ä)
 * @returns {Object} {success, fileId, fileUrl, fileName, error}
 */
function uploadMaintenancePhoto(params) {
  try {
    Logger.log('üì∑ uploadMaintenancePhoto: –Ω–∞—á–∞–ª–æ');
    Logger.log('  - equipmentFolderId: ' + params.equipmentFolderId);
    Logger.log('  - mimeType: ' + params.mimeType);
    Logger.log('  - description: ' + params.description);
    Logger.log('  - date: ' + params.date);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if (!params.equipmentFolderId) {
      return { success: false, error: 'ID –ø–∞–ø–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω' };
    }
    if (!params.photoBase64) {
      return { success: false, error: '–§–æ—Ç–æ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ' };
    }

    // –ü–æ–ª—É—á–∞–µ–º –ø–∞–ø–∫—É –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
    const equipmentFolder = DriveApp.getFolderById(params.equipmentFolderId);
    Logger.log('  - –ü–∞–ø–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è: ' + equipmentFolder.getName());

    // –ò—â–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞—ë–º –ø–æ–¥–ø–∞–ø–∫—É "–§–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è"
    const photoFolderName = '–§–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è';
    let photoFolder;

    const folders = equipmentFolder.getFoldersByName(photoFolderName);
    if (folders.hasNext()) {
      photoFolder = folders.next();
      Logger.log('  - –ü–∞–ø–∫–∞ "–§–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è" –Ω–∞–π–¥–µ–Ω–∞');
    } else {
      photoFolder = equipmentFolder.createFolder(photoFolderName);
      Logger.log('  - –ü–∞–ø–∫–∞ "–§–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è" —Å–æ–∑–¥–∞–Ω–∞');

      // –ù–∞—Å–ª–µ–¥—É–µ–º –¥–æ—Å—Ç—É–ø –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –ø–∞–ø–∫–∏
      try {
        const usersWithAccess = getUsersWithEquipmentAccess();
        for (let i = 0; i < usersWithAccess.length; i++) {
          try {
            photoFolder.addViewer(usersWithAccess[i]);
          } catch (e) {
            Logger.log('  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å viewer: ' + usersWithAccess[i]);
          }
        }
      } catch (accessError) {
        Logger.log('  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞: ' + accessError);
      }
    }

    // –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞
    const date = params.date || new Date().toISOString().split('T')[0];
    const maintenanceType = params.maintenanceType || '–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ';
    const description = params.description || '';

    // –û—á–∏—â–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
    const cleanDescription = description
      .replace(/[/\\:*?"<>|]/g, '_')
      .substring(0, 50)
      .trim();

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ MIME —Ç–∏–ø—É
    const mimeType = params.mimeType || 'image/jpeg';
    const extension = mimeType === 'image/png' ? 'png' : 'jpg';

    // –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º—è: 2024-01-15_–¢–û_–æ–ø–∏—Å–∞–Ω–∏–µ.jpg
    let fileName = date + '_' + maintenanceType;
    if (cleanDescription) {
      fileName += '_' + cleanDescription;
    }
    fileName += '.' + extension;

    Logger.log('  - –ò–º—è —Ñ–∞–π–ª–∞: ' + fileName);

    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º Base64
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å data:image/...;base64, –µ—Å–ª–∏ –µ—Å—Ç—å
    let base64Data = params.photoBase64;
    if (base64Data.includes(',')) {
      base64Data = base64Data.split(',')[1];
    }

    const blob = Utilities.newBlob(
      Utilities.base64Decode(base64Data),
      mimeType,
      fileName
    );

    // –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ
    const file = photoFolder.createFile(blob);

    Logger.log('‚úÖ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ' + file.getUrl());

    return {
      success: true,
      fileId: file.getId(),
      fileUrl: file.getUrl(),
      fileName: fileName,
      folderUrl: photoFolder.getUrl()
    };

  } catch (error) {
    Logger.log('‚ùå uploadMaintenancePhoto –æ—à–∏–±–∫–∞: ' + error.toString());
    Logger.log('  - Stack: ' + (error.stack || '–Ω–µ—Ç —Å—Ç–µ–∫–∞'));

    return {
      success: false,
      error: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ: ' + error.toString()
    };
  }
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –¥–ª—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
 *
 * @param {string} equipmentFolderId - ID –ø–∞–ø–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
 * @returns {Object} {success, photos: Array, error}
 */
function getMaintenancePhotos(equipmentFolderId) {
  try {
    Logger.log('üì∑ getMaintenancePhotos: ' + equipmentFolderId);

    if (!equipmentFolderId) {
      return { success: false, error: 'ID –ø–∞–ø–∫–∏ –Ω–µ —É–∫–∞–∑–∞–Ω', photos: [] };
    }

    const equipmentFolder = DriveApp.getFolderById(equipmentFolderId);

    // –ò—â–µ–º –ø–∞–ø–∫—É "–§–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è"
    const folders = equipmentFolder.getFoldersByName('–§–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è');

    if (!folders.hasNext()) {
      Logger.log('  - –ü–∞–ø–∫–∞ "–§–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
      return { success: true, photos: [], message: '–§–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç' };
    }

    const photoFolder = folders.next();
    const files = photoFolder.getFiles();
    const photos = [];

    while (files.hasNext()) {
      const file = files.next();
      const mimeType = file.getMimeType();

      // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      if (mimeType.startsWith('image/')) {
        photos.push({
          id: file.getId(),
          name: file.getName(),
          url: file.getUrl(),
          thumbnailUrl: 'https://drive.google.com/thumbnail?id=' + file.getId() + '&sz=w200',
          size: file.getSize(),
          mimeType: mimeType,
          createdTime: file.getDateCreated().toISOString(),
          modifiedTime: file.getLastUpdated().toISOString()
        });
      }
    }

    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)
    photos.sort((a, b) => new Date(b.createdTime) - new Date(a.createdTime));

    Logger.log('  - –ù–∞–π–¥–µ–Ω–æ —Ñ–æ—Ç–æ: ' + photos.length);

    return {
      success: true,
      photos: photos,
      folderUrl: photoFolder.getUrl()
    };

  } catch (error) {
    Logger.log('‚ùå getMaintenancePhotos –æ—à–∏–±–∫–∞: ' + error.toString());

    return {
      success: false,
      error: '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–æ—Ç–æ: ' + error.toString(),
      photos: []
    };
  }
}

/**
 * –ò–∑–≤–ª–µ—á—å ID –ø–∞–ø–∫–∏ –∏–∑ URL Google Drive
 * (–≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
 */
function extractFolderIdFromUrl(folderUrl) {
  if (!folderUrl) return null;

  const match = folderUrl.match(/\/folders\/([a-zA-Z0-9_-]+)/);
  if (match) return match[1];

  // –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ ID
  if (/^[a-zA-Z0-9_-]{20,}$/.test(folderUrl)) {
    return folderUrl;
  }

  return null;
}
```

### –®–∞–≥ 5.2: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ Code.gs

**–§–∞–π–ª: `Code.gs` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å cases:**

```javascript
case 'uploadMaintenancePhoto':
  return handleUploadMaintenancePhoto(data);

case 'getMaintenancePhotos':
  return handleGetMaintenancePhotos(params);
```

**–î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:**

```javascript
/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
 */
function handleUploadMaintenancePhoto(data) {
  try {
    Logger.log('üì∑ handleUploadMaintenancePhoto');

    // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω equipmentId –≤–º–µ—Å—Ç–æ folderId, –ø–æ–ª—É—á–∞–µ–º folderId –∏–∑ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
    let folderId = data.equipmentFolderId;

    if (!folderId && data.equipmentId) {
      // –ü–æ–ª—É—á–∞–µ–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –ø–æ ID
      const equipment = getEquipmentById(data.equipmentId);
      if (equipment && equipment.googleDriveUrl) {
        folderId = extractFolderIdFromUrl(equipment.googleDriveUrl);
      }
    }

    if (!folderId) {
      return createErrorResponse('–ù–µ —É–∫–∞–∑–∞–Ω ID –ø–∞–ø–∫–∏ –∏–ª–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è');
    }

    const result = uploadMaintenancePhoto({
      equipmentFolderId: folderId,
      photoBase64: data.photoBase64,
      mimeType: data.mimeType || 'image/jpeg',
      description: data.description || '',
      date: data.date || new Date().toISOString().split('T')[0],
      maintenanceType: data.maintenanceType || '–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ'
    });

    if (result.success) {
      return createJsonResponse(result);
    } else {
      return createErrorResponse(result.error);
    }

  } catch (error) {
    Logger.log('‚ùå handleUploadMaintenancePhoto –æ—à–∏–±–∫–∞: ' + error.toString());
    return createErrorResponse('–û—à–∏–±–∫–∞: ' + error.toString());
  }
}

/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ñ–æ—Ç–æ
 */
function handleGetMaintenancePhotos(params) {
  try {
    Logger.log('üì∑ handleGetMaintenancePhotos');

    let folderId = params.folderId;

    // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω equipmentId, –ø–æ–ª—É—á–∞–µ–º folderId
    if (!folderId && params.equipmentId) {
      const equipment = getEquipmentById(params.equipmentId);
      if (equipment && equipment.googleDriveUrl) {
        folderId = extractFolderIdFromUrl(equipment.googleDriveUrl);
      }
    }

    if (!folderId) {
      return createErrorResponse('–ù–µ —É–∫–∞–∑–∞–Ω ID –ø–∞–ø–∫–∏ –∏–ª–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è');
    }

    const result = getMaintenancePhotos(folderId);
    return createJsonResponse(result);

  } catch (error) {
    Logger.log('‚ùå handleGetMaintenancePhotos –æ—à–∏–±–∫–∞: ' + error.toString());
    return createErrorResponse('–û—à–∏–±–∫–∞: ' + error.toString());
  }
}
```

### –®–∞–≥ 5.3: –î–æ–±–∞–≤–∏—Ç—å Tools –¥–ª—è —Ñ–æ—Ç–æ –≤ Backend API

**–§–∞–π–ª: `ai-consultant-api/src/tools/photoTools.ts`**

```typescript
import Anthropic from '@anthropic-ai/sdk';
import { gasClient } from '../services/gasClient.js';

/**
 * Tool definitions –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ç–æ
 */
export const photoTools: Anthropic.Tool[] = [
  {
    name: 'upload_maintenance_photo',
    description: '–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –≤ –ø–∞–ø–∫—É –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –Ω–∞ Google Drive. ' +
      '–°–æ–∑–¥–∞—ë—Ç –ø–æ–¥–ø–∞–ø–∫—É "–§–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è" –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç. ' +
      '–í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –ø–æ–∫–∞–∂–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–µ–≤—å—é –∏ –∑–∞–ø—Ä–æ—Å–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.',
    input_schema: {
      type: 'object' as const,
      properties: {
        equipment_id: {
          type: 'string',
          description: 'ID –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
        },
        photo_base64: {
          type: 'string',
          description: '–§–æ—Ç–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Base64 (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ data:image/...)',
        },
        mime_type: {
          type: 'string',
          enum: ['image/jpeg', 'image/png'],
          description: 'MIME —Ç–∏–ø –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',
        },
        description: {
          type: 'string',
          description: '–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ç–æ (–¥–ª—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞)',
        },
        date: {
          type: 'string',
          description: '–î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD',
        },
        maintenance_type: {
          type: 'string',
          description: '–¢–∏–ø —Ä–∞–±–æ—Ç (–¢–û, –†–µ–º–æ–Ω—Ç, –û—Å–º–æ—Ç—Ä, –ó–∞–º–µ–Ω–∞ –∏ —Ç.–¥.)',
        },
      },
      required: ['equipment_id', 'photo_base64'],
    },
  },
  {
    name: 'get_maintenance_photos',
    description: '–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –¥–ª—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.',
    input_schema: {
      type: 'object' as const,
      properties: {
        equipment_id: {
          type: 'string',
          description: 'ID –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
        },
      },
      required: ['equipment_id'],
    },
  },
];

/**
 * –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ tools –¥–ª—è —Ñ–æ—Ç–æ
 */
export async function executePhotoTool(
  name: string,
  input: Record<string, unknown>
): Promise<unknown> {
  switch (name) {
    case 'upload_maintenance_photo':
      return await gasClient.post('uploadMaintenancePhoto', {
        equipmentId: input.equipment_id,
        photoBase64: input.photo_base64,
        mimeType: input.mime_type || 'image/jpeg',
        description: input.description || '',
        date: input.date,
        maintenanceType: input.maintenance_type || '–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
      });

    case 'get_maintenance_photos':
      return await gasClient.get('getMaintenancePhotos', {
        equipmentId: input.equipment_id as string,
      });

    default:
      throw new Error(`Unknown photo tool: ${name}`);
  }
}
```

### –®–∞–≥ 5.4: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å photo tools

**–§–∞–π–ª: `ai-consultant-api/src/tools/index.ts` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å:**

```typescript
import Anthropic from '@anthropic-ai/sdk';
import { equipmentTools, executeEquipmentTool } from './equipmentTools.js';
import { driveTools, executeDriveTool } from './driveTools.js';
import { photoTools, executePhotoTool } from './photoTools.js';

// –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ tools
export const tools: Anthropic.Tool[] = [
  ...equipmentTools,
  ...driveTools,
  ...photoTools,
];

// –ú–∞–ø–ø–∏–Ω–≥ tools –∫ –∏—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º
const toolExecutors: Record<string, (name: string, input: Record<string, unknown>) => Promise<unknown>> = {
  // Equipment tools
  'get_all_equipment': executeEquipmentTool,
  'get_equipment_details': executeEquipmentTool,
  'get_maintenance_log': executeEquipmentTool,
  'add_maintenance_entry': executeEquipmentTool,

  // Drive tools
  'search_files_in_folder': executeDriveTool,
  'read_file_content': executeDriveTool,

  // Photo tools
  'upload_maintenance_photo': executePhotoTool,
  'get_maintenance_photos': executePhotoTool,
};

// ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

### –®–∞–≥ 5.5: –î–æ–±–∞–≤–∏—Ç—å endpoint –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –≤ Backend API

**–§–∞–π–ª: `ai-consultant-api/src/routes/upload.ts`**

```typescript
import { Router, Response } from 'express';
import { authMiddleware, AuthenticatedRequest } from '../middleware/auth.js';
import { gasClient } from '../services/gasClient.js';

const router = Router();

// –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–æ—Ç–æ: 10MB
const MAX_PHOTO_SIZE = 10 * 1024 * 1024;

interface UploadRequestBody {
  equipmentId: string;
  photoBase64: string;
  mimeType?: string;
  description?: string;
  date?: string;
  maintenanceType?: string;
}

/**
 * POST /api/upload/photo
 * –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
 */
router.post('/photo', authMiddleware, async (req: AuthenticatedRequest, res: Response) => {
  try {
    const body = req.body as UploadRequestBody;

    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!body.equipmentId) {
      res.status(400).json({ error: 'equipmentId is required' });
      return;
    }

    if (!body.photoBase64) {
      res.status(400).json({ error: 'photoBase64 is required' });
      return;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä
    const base64Size = body.photoBase64.length * 0.75; // –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö
    if (base64Size > MAX_PHOTO_SIZE) {
      res.status(400).json({ error: 'Photo is too large. Maximum size is 10MB' });
      return;
    }

    console.log(`Photo upload from user ${req.user?.email}, equipment: ${body.equipmentId}`);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —á–µ—Ä–µ–∑ GAS API
    const result = await gasClient.post('uploadMaintenancePhoto', {
      equipmentId: body.equipmentId,
      photoBase64: body.photoBase64,
      mimeType: body.mimeType || 'image/jpeg',
      description: body.description || '',
      date: body.date || new Date().toISOString().split('T')[0],
      maintenanceType: body.maintenanceType || '–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
    });

    res.json({
      success: true,
      data: result,
    });

  } catch (error) {
    console.error('Upload error:', error);

    const message = error instanceof Error ? error.message : 'Unknown error';
    res.status(500).json({
      success: false,
      error: message,
    });
  }
});

/**
 * GET /api/upload/photos/:equipmentId
 * –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–æ—Ç–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
 */
router.get('/photos/:equipmentId', authMiddleware, async (req: AuthenticatedRequest, res: Response) => {
  try {
    const { equipmentId } = req.params;

    const result = await gasClient.get('getMaintenancePhotos', {
      equipmentId,
    });

    res.json({
      success: true,
      data: result,
    });

  } catch (error) {
    console.error('Get photos error:', error);

    const message = error instanceof Error ? error.message : 'Unknown error';
    res.status(500).json({
      success: false,
      error: message,
    });
  }
});

export default router;
```

### –®–∞–≥ 5.6: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—É—Ç –≤ index.ts

**–§–∞–π–ª: `ai-consultant-api/src/index.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å:**

```typescript
import uploadRouter from './routes/upload.js';

// ... –ø–æ—Å–ª–µ –¥—Ä—É–≥–∏—Ö —Ä–æ—É—Ç–æ–≤
app.use('/api/upload', uploadRouter);
```

### –®–∞–≥ 5.7: –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Ñ–æ—Ç–æ –≤ Frontend

**–§–∞–π–ª: `src/features/ai-consultant/components/PhotoButton.tsx`**

```tsx
import React, { useRef, useState } from 'react';
import './ChatWidget.css';

interface PhotoButtonProps {
  disabled?: boolean;
  onPhotoSelected: (photo: { base64: string; mimeType: string }) => void;
}

export const PhotoButton: React.FC<PhotoButtonProps> = ({ disabled, onPhotoSelected }) => {
  const [isLoading, setIsLoading] = useState(false);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const handleClick = () => {
    fileInputRef.current?.click();
  };

  const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞
    if (!file.type.startsWith('image/')) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
      return;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä (max 10MB)
    if (file.size > 10 * 1024 * 1024) {
      alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB');
      return;
    }

    setIsLoading(true);

    try {
      // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ Base64
      const base64 = await fileToBase64(file);

      onPhotoSelected({
        base64,
        mimeType: file.type,
      });

    } catch (error) {
      console.error('Error reading file:', error);
      alert('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞');
    } finally {
      setIsLoading(false);
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º input –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–∞ —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞
      if (fileInputRef.current) {
        fileInputRef.current.value = '';
      }
    }
  };

  return (
    <>
      <input
        ref={fileInputRef}
        type="file"
        accept="image/*"
        capture="environment" // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞–º–µ—Ä—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        onChange={handleFileChange}
        style={{ display: 'none' }}
      />
      <button
        type="button"
        onClick={handleClick}
        disabled={disabled || isLoading}
        className="ai-chat-photo-btn"
        title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ"
      >
        {isLoading ? '‚è≥' : 'üì∑'}
      </button>
    </>
  );
};

/**
 * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –≤ Base64
 */
function fileToBase64(file: File): Promise<string> {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();

    reader.onload = () => {
      const result = reader.result as string;
      // –£–¥–∞–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å data:image/...;base64,
      const base64 = result.split(',')[1];
      resolve(base64);
    };

    reader.onerror = () => {
      reject(new Error('Failed to read file'));
    };

    reader.readAsDataURL(file);
  });
}
```

### –®–∞–≥ 5.8: –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Ñ–æ—Ç–æ

**–§–∞–π–ª: `src/features/ai-consultant/components/ChatWidget.css` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å:**

```css
/* –ö–Ω–æ–ø–∫–∞ —Ñ–æ—Ç–æ */
.ai-chat-photo-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 1px solid var(--ai-chat-border);
  background: white;
  font-size: 18px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.ai-chat-photo-btn:hover:not(:disabled) {
  background: #f0f9ff;
  border-color: var(--ai-chat-primary);
}

.ai-chat-photo-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* –ü—Ä–µ–≤—å—é —Ñ–æ—Ç–æ –≤ —á–∞—Ç–µ */
.ai-chat-photo-preview {
  max-width: 200px;
  max-height: 150px;
  border-radius: 8px;
  margin: 8px 0;
  cursor: pointer;
}

.ai-chat-photo-preview:hover {
  opacity: 0.9;
}
```

### –®–∞–≥ 5.9: –û–±–Ω–æ–≤–∏—Ç—å ChatInput –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ñ–æ—Ç–æ

**–§–∞–π–ª: `src/features/ai-consultant/components/ChatInput.tsx` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å:**

```tsx
import React, { useState, useRef, useEffect } from 'react';
import { VoiceButton } from './VoiceButton';
import { PhotoButton } from './PhotoButton';
import './ChatWidget.css';

interface ChatInputProps {
  onSend: (text: string, photo?: { base64: string; mimeType: string }) => void;
  isLoading: boolean;
  voiceTranscript?: string;
  onVoiceTranscriptUsed?: () => void;
}

export const ChatInput: React.FC<ChatInputProps> = ({
  onSend,
  isLoading,
  voiceTranscript,
  onVoiceTranscriptUsed,
}) => {
  const [text, setText] = useState('');
  const [pendingPhoto, setPendingPhoto] = useState<{ base64: string; mimeType: string } | null>(null);
  const textareaRef = useRef<HTMLTextAreaElement>(null);

  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥

  const handleSubmit = (e?: React.FormEvent) => {
    e?.preventDefault();

    if ((text.trim() || pendingPhoto) && !isLoading) {
      onSend(text.trim(), pendingPhoto || undefined);
      setText('');
      setPendingPhoto(null);
    }
  };

  const handlePhotoSelected = (photo: { base64: string; mimeType: string }) => {
    setPendingPhoto(photo);
    // –§–æ–∫—É—Å–∏—Ä—É–µ–º –Ω–∞ textarea –¥–ª—è –≤–≤–æ–¥–∞ –æ–ø–∏—Å–∞–Ω–∏—è
    textareaRef.current?.focus();
  };

  const handleRemovePhoto = () => {
    setPendingPhoto(null);
  };

  return (
    <form className="ai-chat-input" onSubmit={handleSubmit}>
      {/* –ü—Ä–µ–≤—å—é –ø—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω–Ω–æ–≥–æ —Ñ–æ—Ç–æ */}
      {pendingPhoto && (
        <div className="ai-chat-input__photo-preview">
          <img
            src={`data:${pendingPhoto.mimeType};base64,${pendingPhoto.base64}`}
            alt="Preview"
            className="ai-chat-photo-preview"
          />
          <button
            type="button"
            onClick={handleRemovePhoto}
            className="ai-chat-input__remove-photo"
            title="–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ"
          >
            ‚úï
          </button>
        </div>
      )}

      <div className="ai-chat-input__row">
        <textarea
          ref={textareaRef}
          value={text}
          onChange={(e) => setText(e.target.value)}
          onKeyDown={handleKeyDown}
          placeholder={pendingPhoto ? "–î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫ —Ñ–æ—Ç–æ..." : "–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å..."}
          disabled={isLoading}
          rows={1}
          className="ai-chat-input__textarea"
        />

        <PhotoButton
          disabled={isLoading}
          onPhotoSelected={handlePhotoSelected}
        />

        <VoiceButton disabled={isLoading} />

        <button
          type="submit"
          disabled={(!text.trim() && !pendingPhoto) || isLoading}
          className="ai-chat-input__send"
          title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
        >
          {isLoading ? '‚è≥' : '‚û§'}
        </button>
      </div>
    </form>
  );
};
```

### –®–∞–≥ 5.10: –û–±–Ω–æ–≤–∏—Ç—å useChat –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ñ–æ—Ç–æ

**–§–∞–π–ª: `src/features/ai-consultant/hooks/useChat.ts` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å sendMessage:**

```typescript
const sendMessage = useCallback(async (
  text: string,
  photo?: { base64: string; mimeType: string }
) => {
  if ((!text.trim() && !photo) || isLoading) return;

  setError(null);
  setIsLoading(true);

  // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  let userContent = text;
  if (photo) {
    userContent = text
      ? `[–§–æ—Ç–æ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ]\n${text}`
      : '[–§–æ—Ç–æ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ]';
  }

  const userMessage: ChatMessage = { role: 'user', content: userContent };
  const newMessages = [...messages, userMessage];
  setMessages(newMessages);

  try {
    // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–æ—Ç–æ, —Å–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ
    // (–∏–ª–∏ –ø–µ—Ä–µ–¥–∞—ë–º –≤ API –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ Claude)
    const response = await sendChatMessage(newMessages, photo);

    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
  } catch (err) {
    // ...
  }
}, [messages, isLoading]);
```

---

## –ß–∞—Å—Ç—å 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ Backend API

```bash
# Health check
curl https://your-api.railway.app/health

# –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–Ω—É–∂–µ–Ω —Ç–æ–∫–µ–Ω)
curl -X POST https://your-api.railway.app/api/chat \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_SUPABASE_TOKEN" \
  -d '{"messages":[{"role":"user","content":"–ü—Ä–∏–≤–µ—Ç"}]}'
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ù–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É —á–∞—Ç–∞ (üí¨ –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É)
3. –ù–∞–ø–∏—Å–∞—Ç—å "–ü–æ–∫–∞–∂–∏ —Å–ø–∏—Å–æ–∫ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è"
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞

1. –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç
2. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ (üé§)
3. –†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
4. –°–∫–∞–∑–∞—Ç—å "–ù–∞–π–¥–∏ —Ñ–∏–ª—å—Ç—Ä –æ–±–µ–∑–∂–µ–ª–µ–∑–∏–≤–∞–Ω–∏—è"
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç–µ–∫—Å—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–ª—Å—è –∏ –ø–æ—è–≤–∏–ª—Å—è –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞

### –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–µ–Ω–∏—è PDF

1. –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç
2. –ù–∞–ø–∏—Å–∞—Ç—å "–ü—Ä–æ—á–∏—Ç–∞–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –Ω–∞ —Ñ–∏–ª—å—Ç—Ä –æ–±–µ–∑–∂–µ–ª–µ–∑–∏–≤–∞–Ω–∏—è ‚Ññ2"
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –Ω–∞—à—ë–ª —Ñ–∞–π–ª –∏ –ø–æ–∫–∞–∑–∞–ª —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

### –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ

1. –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç
2. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É –∫–∞–º–µ—Ä—ã (üì∑)
3. –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –∏–∑ –≥–∞–ª–µ—Ä–µ–∏
4. –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ: "–ó–∞–º–µ–Ω–∏–ª —Ñ–∏–ª—å—Ç—Ä—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞ —Ñ–∏–ª—å—Ç—Ä–µ ‚Ññ1"
5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ:
   - –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–ª –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
   - –ü—Ä–µ–¥–ª–æ–∂–∏–ª —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª–µ
   - –§–æ—Ç–æ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å –≤ –ø–∞–ø–∫—É "–§–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è"
7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ Google Drive, —á—Ç–æ —Å–æ–∑–¥–∞–ª–∞—Å—å –ø–∞–ø–∫–∞ –∏ —Ñ–∞–π–ª

### –¢–µ—Å—Ç 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ñ–æ—Ç–æ

1. –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç
2. –ù–∞–ø–∏—Å–∞—Ç—å "–ü–æ–∫–∞–∂–∏ —Ñ–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ ‚Ññ1"
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ–∫–∞–∑–∞–ª —Å–ø–∏—Å–æ–∫ —Ñ–æ—Ç–æ —Å —Å—Å—ã–ª–∫–∞–º–∏

---

## –ß–∞—Å—Ç—å 7: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```
project/
‚îú‚îÄ‚îÄ ai-consultant-api/           # NEW: Backend Proxy API
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ upload.ts        # NEW: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ health.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ anthropic.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ gasClient.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tools/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ equipmentTools.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ driveTools.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ photoTools.ts    # NEW: Tools –¥–ª—è —Ñ–æ—Ç–æ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ railway.toml
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai-consultant/       # NEW: Frontend Chat Widget
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatWidget.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatWidget.css
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatMessage.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatInput.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VoiceButton.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PhotoButton.tsx  # NEW: –ö–Ω–æ–ø–∫–∞ —Ñ–æ—Ç–æ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useChat.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useSpeechRecognition.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ consultantApi.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ... (existing features)
‚îÇ   ‚îî‚îÄ‚îÄ App.tsx                  # MODIFIED: –¥–æ–±–∞–≤–ª–µ–Ω ChatWidget
‚îÇ
‚îú‚îÄ‚îÄ backend/equipment-db/        # EXISTING: Google Apps Script
‚îÇ   ‚îú‚îÄ‚îÄ DriveOperations.gs       # MODIFIED: +getFileContent, +uploadMaintenancePhoto
‚îÇ   ‚îî‚îÄ‚îÄ Code.gs                  # MODIFIED: +handleGetFileContent, +handleUploadPhoto
‚îÇ
‚îî‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ WEB_AI_CONSULTANT_PLAN.md    # NEW: –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
    ‚îú‚îÄ‚îÄ PDF_READING_IMPLEMENTATION.md # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —á—Ç–µ–Ω–∏—é PDF
    ‚îî‚îÄ‚îÄ TELEGRAM_BOT_PLAN.md         # –ü–ª–∞–Ω Telegram –±–æ—Ç–∞
```

---

## –ß–∞—Å—Ç—å 8: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Telegram –±–æ—Ç–æ–º

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Web –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç | Telegram –ë–æ—Ç |
|----------|-----------------|--------------|
| **–£—Å—Ç–∞–Ω–æ–≤–∫–∞** | –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è | –¢—Ä–µ–±—É–µ—Ç—Å—è Telegram |
| **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è (Supabase) | –ß–µ—Ä–µ–∑ email |
| **–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥** | Web Speech API (–±—Ä–∞—É–∑–µ—Ä) | Whisper (—Å–µ—Ä–≤–µ—Ä) |
| **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UI** | –ì–ª—É–±–æ–∫–∞—è (–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏) | –û—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| **Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω—ã | –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ |
| **–†–∞–±–æ—Ç–∞ –æ—Ñ–ª–∞–π–Ω** | –ù–µ—Ç | –ù–µ—Ç |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | ~$5-15/–º–µ—Å | ~$5-15/–º–µ—Å |
| **–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** | 8-12 –¥–Ω–µ–π | 12-18 –¥–Ω–µ–π |
| **–ú–æ–±–∏–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø** | PWA | –ù–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**Web –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ª—É—á—à–µ –µ—Å–ª–∏:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- –í–∞–∂–Ω–∞ –≥–ª—É–±–æ–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
- –ù–µ –Ω—É–∂–Ω—ã push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**Telegram –ë–æ—Ç –ª—É—á—à–µ –µ—Å–ª–∏:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Telegram
- –í–∞–∂–Ω—ã push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¢–û
- –ù—É–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –±–µ–∑ –æ—Ç–∫—Ä—ã—Ç–∏—è –±—Ä–∞—É–∑–µ—Ä–∞

---

## –ß–∞—Å—Ç—å 9: –°—Ç–æ–∏–º–æ—Å—Ç—å —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–æ–∏–º–æ—Å—Ç—å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|-----------|------------|
| Railway (Proxy API) | ~$5/–º–µ—Å | Hobby plan –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ |
| Anthropic Claude | ~$0.01-0.03/–∑–∞–ø—Ä–æ—Å | Sonnet –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö |
| Web Speech API | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | –†–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ |
| Supabase | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | Free tier |
| Google Drive | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç |

**–ò—Ç–æ–≥–æ: ~$5-15/–º–µ—Å—è—Ü**

---

## –ü—Ä–∏–º–µ—Ä—ã –¥–∏–∞–ª–æ–≥–æ–≤ —Å —Ñ–æ—Ç–æ

### –ü—Ä–∏–º–µ—Ä 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ä–∞–±–æ—Ç

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [üì∑ –§–æ—Ç–æ] + "–ó–∞–º–µ–Ω–∏–ª —Ñ–∏–ª—å—Ç—Ä—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞ —Ñ–∏–ª—å—Ç—Ä–µ ‚Ññ2"

–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç: üì∑ –§–æ—Ç–æ –ø–æ–ª—É—á–µ–Ω–æ!

–Ø –æ–ø—Ä–µ–¥–µ–ª–∏–ª:
- üîß –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ: –§–∏–ª—å—Ç—Ä –æ–±–µ–∑–∂–µ–ª–µ–∑–∏–≤–∞–Ω–∏—è –§–û-0,8-1,5 ‚Ññ2
- üìÖ –î–∞—Ç–∞: 2024-02-02
- üìã –¢–∏–ø —Ä–∞–±–æ—Ç: –ó–∞–º–µ–Ω–∞
- üìù –û–ø–∏—Å–∞–Ω–∏–µ: –ó–∞–º–µ–Ω–∏–ª —Ñ–∏–ª—å—Ç—Ä—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç

–°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è —Å —ç—Ç–∏–º —Ñ–æ—Ç–æ?

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –î–∞, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ü–µ—Ç—Ä–æ–≤

–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç: ‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∂—É—Ä–Ω–∞–ª –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è!
üì∑ –§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: https://drive.google.com/file/d/xxx/view

–ü–∞–ø–∫–∞: –§–∏–ª—å—Ç—Ä –æ–±–µ–∑–∂–µ–ª–µ–∑–∏–≤–∞–Ω–∏—è ‚Ññ2 / –§–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
```

### –ü—Ä–∏–º–µ—Ä 2: –ó–∞–ø—Ä–æ—Å —Ñ–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ü–æ–∫–∞–∂–∏ –≤—Å–µ —Ñ–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∫–æ—Ç–ª–∞ Clayton

–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç: üì∑ –§–æ—Ç–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –ø–∞—Ä–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ Clayton SEG-60-1:

1. üì∏ 2024-01-15_–¢–û_–æ—á–∏—Å—Ç–∫–∞_–∑–º–µ–µ–≤–∏–∫–∞.jpg
   üîó [–û—Ç–∫—Ä—ã—Ç—å](https://drive.google.com/file/d/xxx/view)

2. üì∏ 2024-01-10_–û—Å–º–æ—Ç—Ä_–¥–µ–∞—Ä–∞—Ç–æ—Ä.jpg
   üîó [–û—Ç–∫—Ä—ã—Ç—å](https://drive.google.com/file/d/yyy/view)

3. üì∏ 2023-12-20_–†–µ–º–æ–Ω—Ç_–∫–ª–∞–ø–∞–Ω—ã.jpg
   üîó [–û—Ç–∫—Ä—ã—Ç—å](https://drive.google.com/file/d/zzz/view)

üìÅ [–û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É](https://drive.google.com/drive/folders/xxx)
```

### –ü—Ä–∏–º–µ—Ä 3: –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ + —Ñ–æ—Ç–æ

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [üì∑ –§–æ—Ç–æ] + üé§ "–°–µ–≥–æ–¥–Ω—è –ø—Ä–æ–≤–µ–ª–∏ –æ—Å–º–æ—Ç—Ä –Ω–∞—Å–æ—Å–∞, –æ–±–Ω–∞—Ä—É–∂–∏–ª —Ç–µ—á—å —Å–∞–ª—å–Ω–∏–∫–∞"

–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç: üé§ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "–°–µ–≥–æ–¥–Ω—è –ø—Ä–æ–≤–µ–ª–∏ –æ—Å–º–æ—Ç—Ä –Ω–∞—Å–æ—Å–∞, –æ–±–Ω–∞—Ä—É–∂–∏–ª —Ç–µ—á—å —Å–∞–ª—å–Ω–∏–∫–∞"
üì∑ –§–æ—Ç–æ –ø–æ–ª—É—á–µ–Ω–æ!

–°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –æ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏?

- üîß –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ: (—É—Ç–æ—á–Ω–∏—Ç–µ –∫–∞–∫–æ–π –Ω–∞—Å–æ—Å)
- üìÖ –î–∞—Ç–∞: 2024-02-02
- üìã –¢–∏–ø: –û—Å–º–æ—Ç—Ä
- ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ: –¢–µ—á—å —Å–∞–ª—å–Ω–∏–∫–∞
- üì∑ –§–æ—Ç–æ: –ø—Ä–∏–ª–æ–∂–µ–Ω–æ

–£–∫–∞–∂–∏—Ç–µ, –∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ –Ω–∞—Å–æ—Å.

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: Grundfos –Ω–∞ –≤–æ–¥–æ–ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ

–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç: ‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∂—É—Ä–Ω–∞–ª!

‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –¢–µ—á—å —Å–∞–ª—å–Ω–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç —Å–∫–æ—Ä–µ–π—à–µ–≥–æ —Ä–µ–º–æ–Ω—Ç–∞.
–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—ã –ø–æ –∑–∞–º–µ–Ω–µ?
```

---

## –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã
2. **–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ Supabase
3. **–ö–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ç–µ–∫—É—â–µ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
4. **–†–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è** ‚Äî –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
5. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
6. **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
