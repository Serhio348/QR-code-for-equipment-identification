# Как посмотреть данные по определенному счетчику за определенный период

## Пошаговая инструкция

### Шаг 1: Найдите device_id счетчика

#### Вариант A: Через клиентское приложение (самый простой способ)

1. Откройте приложение и перейдите в раздел **"Счетчики Beliot"**
2. Найдите нужный счетчик в таблице
3. **Наведите курсор** на строку со счетчиком (или кликните на него)
4. В правой панели откроется детальная информация
5. Найдите поле **"device_id"** или **"ID устройства"**
6. Скопируйте значение (например: `12345`)

**Пример:**
```
Счетчик: Водомер №1
device_id: 12345  ← это значение вам нужно
Серийный номер: SN-123456
Объект: Офис
```

#### Вариант B: Через Supabase Dashboard

1. Откройте [Supabase Dashboard](https://app.supabase.com) → ваш проект
2. Перейдите в **SQL Editor** → **New query**
3. Выполните запрос:

```sql
SELECT DISTINCT device_id
FROM beliot_device_readings
ORDER BY device_id;
```

Это покажет все уникальные `device_id` в базе данных.

---

### Шаг 2: Выберите период

Определите, за какой период вы хотите посмотреть данные:

- **За сегодня:** `2026-01-08 00:00:00+00` до `2026-01-09 00:00:00+00`
- **За вчера:** `2026-01-07 00:00:00+00` до `2026-01-08 00:00:00+00`
- **За последние 7 дней:** используйте динамический запрос (см. ниже)
- **За конкретный месяц:** `2026-01-01 00:00:00+00` до `2026-02-01 00:00:00+00`
- **За произвольный период:** укажите начальную и конечную дату

---

### Шаг 3: Выполните SQL запрос

#### Вариант 1: Данные за конкретный день

1. Откройте **Supabase Dashboard** → **SQL Editor** → **New query**
2. Вставьте запрос:

```sql
SELECT 
  device_id,
  reading_date,
  reading_value,
  unit,
  updated_at
FROM beliot_device_readings
WHERE device_id = '12345'  -- ⬅️ ЗАМЕНИТЕ на ваш device_id
  AND reading_date >= '2026-01-08 00:00:00+00'  -- ⬅️ Начало дня
  AND reading_date < '2026-01-09 00:00:00+00'   -- ⬅️ Конец дня (не включительно)
ORDER BY reading_date DESC;
```

3. Замените:
   - `'12345'` на ваш `device_id`
   - `'2026-01-08 00:00:00+00'` на нужную дату начала
   - `'2026-01-09 00:00:00+00'` на дату окончания (следующий день)

4. Нажмите **Run** (или `Ctrl+Enter`)

#### Вариант 2: Данные за последние 7 дней (динамически)

```sql
SELECT 
  device_id,
  reading_date,
  reading_value,
  unit,
  updated_at
FROM beliot_device_readings
WHERE device_id = '12345'  -- ⬅️ ЗАМЕНИТЕ на ваш device_id
  AND reading_date >= date_trunc('day', NOW() - INTERVAL '7 days')
ORDER BY reading_date DESC;
```

#### Вариант 3: Данные за конкретный месяц

```sql
SELECT 
  device_id,
  reading_date,
  reading_value,
  unit,
  updated_at
FROM beliot_device_readings
WHERE device_id = '12345'  -- ⬅️ ЗАМЕНИТЕ на ваш device_id
  AND reading_date >= '2026-01-01 00:00:00+00'  -- Начало месяца
  AND reading_date < '2026-02-01 00:00:00+00'   -- Начало следующего месяца
ORDER BY reading_date DESC;
```

#### Вариант 4: Данные за произвольный период

```sql
SELECT 
  device_id,
  reading_date,
  reading_value,
  unit,
  updated_at
FROM beliot_device_readings
WHERE device_id = '12345'  -- ⬅️ ЗАМЕНИТЕ
  AND reading_date >= '2026-01-01 00:00:00+00'  -- ⬅️ Начало периода
  AND reading_date <= '2026-01-31 23:59:59+00'  -- ⬅️ Конец периода
ORDER BY reading_date DESC;
```

#### Вариант 5: Данные с расчетом потребления (объема)

```sql
WITH ordered_readings AS (
  SELECT 
    device_id,
    reading_date,
    reading_value,
    unit,
    LAG(reading_value) OVER (ORDER BY reading_date) AS previous_value,
    reading_value - LAG(reading_value) OVER (ORDER BY reading_date) AS consumption
  FROM beliot_device_readings
  WHERE device_id = '12345'  -- ⬅️ ЗАМЕНИТЕ на ваш device_id
    AND reading_date >= '2026-01-01 00:00:00+00'  -- ⬅️ Начало периода
    AND reading_date <= '2026-01-31 23:59:59+00'  -- ⬅️ Конец периода
)
SELECT 
  device_id,
  reading_date,
  reading_value,
  previous_value,
  consumption,
  unit
FROM ordered_readings
ORDER BY reading_date DESC;
```

---

### Шаг 4: Сохраните запрос (опционально)

1. После выполнения запроса нажмите **Save** (или **Сохранить**)
2. Введите название (например, "Данные счетчика 12345 за январь")
3. Теперь запрос будет доступен в списке сохраненных запросов

---

## Альтернатива: Использование клиентского приложения

Если вы не хотите использовать SQL, можете использовать встроенный архив:

1. Откройте таблицу со счетчиками
2. Найдите нужный счетчик
3. Нажмите кнопку **"Архив"** (☰) в строке со счетчиком
4. Выберите:
   - **Группировку:** По часам / По дням / По неделям / По месяцам / По годам
   - **Диапазон дат:** Начальная и конечная дата
5. Нажмите **"Загрузить данные"**

---

## Примеры готовых запросов

Все готовые SQL запросы находятся в файле:
- `docs/query-device-by-period.sql`

Скопируйте нужный запрос и замените значения на свои.

---

## Устранение проблем

### Не вижу device_id в клиентском приложении
- Убедитесь, что вы навели курсор на строку со счетчиком
- Попробуйте кликнуть на строку
- Проверьте, что правая панель открыта

### Запрос не возвращает данные
- Проверьте, что `device_id` правильный (используйте кавычки, если это строка)
- Убедитесь, что данные были собраны (cron job работает)
- Проверьте диапазон дат (данные могут быть за другой период)
- Проверьте часовой пояс (Supabase использует UTC)

### Несколько счетчиков с похожими данными
- Используйте дату последнего обновления (`updated_at`) для идентификации
- Или используйте клиентское приложение, где счетчики отображаются с названиями

---

## Полезные ссылки

- [Как найти device_id](./HOW_TO_FIND_DEVICE_ID.md)
- [Готовые SQL запросы](./query-device-by-period.sql)
- [Логика сохранения данных](./BELIOT_DATA_STORAGE_LOGIC.md)

