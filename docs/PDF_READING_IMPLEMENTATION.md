# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (PDF, Word, Excel)

## –û–±–∑–æ—Ä

–≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ—à–∞–≥–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —á—Ç–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–æ–≤ –∏–∑ Google Drive –≤ MCP-—Å–µ—Ä–≤–µ—Ä. –ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç —Å–º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –ø–∞—Å–ø–æ—Ä—Ç–∞ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
| –§–æ—Ä–º–∞—Ç | –†–∞—Å—à–∏—Ä–µ–Ω–∏—è | –ú–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
|--------|------------|-----------------|
| PDF | .pdf | –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Google Docs —Å OCR |
| Word | .doc, .docx | –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Google Docs |
| Excel | .xls, .xlsx | –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Google Sheets |
| Google Docs | ‚Äî | –ß—Ç–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é |
| Google Sheets | ‚Äî | –ß—Ç–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é |
| –¢–µ–∫—Å—Ç–æ–≤—ã–µ | .txt, .md, .csv, .json, .xml | –ß—Ç–µ–Ω–∏–µ –∫–∞–∫ UTF-8 |

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     HTTP      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     Drive API    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MCP Server    ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂  ‚îÇ  Google Apps    ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ ‚îÇ Google Drive ‚îÇ
‚îÇ   (Node.js)     ‚îÇ              ‚îÇ  Script (GAS)   ‚îÇ                  ‚îÇ   (PDF)      ‚îÇ
‚îÇ                 ‚îÇ ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ                 ‚îÇ ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ              ‚îÇ
‚îÇ drive_read_file ‚îÇ    JSON      ‚îÇ getFileContent  ‚îÇ    Blob/Text     ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–í–∞–∂–Ω–æ:** Google Apps Script –Ω–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ PDF-–ø–∞—Ä—Å–µ—Ä–∞. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–¥—Ö–æ–¥ —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π PDF –≤ Google Docs, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Ç–µ–∫—Å—Ç (–≤–∫–ª—é—á–∞—è OCR –¥–ª—è —Å–∫–∞–Ω–æ–≤).

---

## –ß–∞—Å—Ç—å 1: Google Apps Script (–±—ç–∫–µ–Ω–¥)

### –®–∞–≥ 1.1: –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç GAS

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ Google Sheets —Å –±–∞–∑–æ–π –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
2. –ú–µ–Ω—é: **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è** ‚Üí **Apps Script**
3. –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `DriveOperations.gs`

### –®–∞–≥ 1.2: –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞

–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ `DriveOperations.gs`:

```javascript
// ============================================================================
// –§–£–ù–ö–¶–ò–ò –ß–¢–ï–ù–ò–Ø –°–û–î–ï–†–ñ–ò–ú–û–ì–û –§–ê–ô–õ–û–í
// ============================================================================

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∏–∑ Google Drive
 *
 * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
 * - PDF: –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ Google Docs, –∑–∞—Ç–µ–º –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç (—Å OCR)
 * - Word (.doc, .docx): –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ Google Docs
 * - Excel (.xls, .xlsx): –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ Google Sheets
 * - Google Docs: –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç –Ω–∞–ø—Ä—è–º—É—é
 * - Google Sheets: –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ —Ç–µ–∫—Å—Ç
 * - –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã (.txt, .md, .csv, .json, .xml): —á–∏—Ç–∞—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å
 *
 * @param {string} fileUrlOrId - URL —Ñ–∞–π–ª–∞ –∏–ª–∏ –µ–≥–æ ID
 * @param {Object} options - –û–ø—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
 * @param {boolean} options.keepTempFile - –ù–µ —É–¥–∞–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
 * @param {number} options.maxLength - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50000)
 * @returns {Object} {success, content, fileName, mimeType, charCount, error}
 */
function getFileContent(fileUrlOrId, options) {
  options = options || {};
  const maxLength = options.maxLength || 50000;
  const keepTempFile = options.keepTempFile || false;

  try {
    Logger.log('üìÑ getFileContent: –Ω–∞—á–∞–ª–æ');
    Logger.log('  - fileUrlOrId: ' + fileUrlOrId);

    if (!fileUrlOrId || !fileUrlOrId.trim()) {
      return {
        success: false,
        error: 'URL –∏–ª–∏ ID —Ñ–∞–π–ª–∞ –Ω–µ —É–∫–∞–∑–∞–Ω'
      };
    }

    // –ò–∑–≤–ª–µ–∫–∞–µ–º ID —Ñ–∞–π–ª–∞
    const fileId = extractFileIdFromUrl(fileUrlOrId);

    if (!fileId) {
      return {
        success: false,
        error: '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å ID —Ñ–∞–π–ª–∞ –∏–∑ URL: ' + fileUrlOrId
      };
    }

    Logger.log('  - fileId: ' + fileId);

    // –ü–æ–ª—É—á–∞–µ–º —Ñ–∞–π–ª
    const file = DriveApp.getFileById(fileId);
    const fileName = file.getName();
    const mimeType = file.getMimeType();

    Logger.log('  - fileName: ' + fileName);
    Logger.log('  - mimeType: ' + mimeType);

    let content = '';

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
    if (mimeType === 'application/pdf') {
      // PDF: –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ Google Docs –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
      content = extractTextFromPdf(file, keepTempFile);

    } else if (mimeType === 'application/vnd.google-apps.document') {
      // Google Docs: –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞–ø—Ä—è–º—É—é
      content = extractTextFromGoogleDoc(fileId);

    } else if (mimeType === 'application/msword' ||
               mimeType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
      // Word (.doc, .docx): –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ Google Docs
      content = extractTextFromWordFile(file, keepTempFile);

    } else if (mimeType.startsWith('text/') ||
               mimeType === 'application/json' ||
               mimeType === 'application/xml') {
      // –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã: —á–∏—Ç–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
      content = file.getBlob().getDataAsString('UTF-8');

    } else if (mimeType === 'application/vnd.google-apps.spreadsheet') {
      // Google Sheets: –∏–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ —Ç–µ–∫—Å—Ç
      content = extractTextFromGoogleSheet(fileId);

    } else if (mimeType === 'application/vnd.ms-excel' ||
               mimeType === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet') {
      // Excel (.xls, .xlsx): –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ Google Sheets
      content = extractTextFromExcelFile(file, keepTempFile);

    } else {
      return {
        success: false,
        error: '–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞: ' + mimeType + '. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: PDF, Word (.doc, .docx), Excel (.xls, .xlsx), Google Docs, Google Sheets, —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã.'
      };
    }

    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É —Ç–µ–∫—Å—Ç–∞
    const originalLength = content.length;
    if (content.length > maxLength) {
      content = content.substring(0, maxLength) + '\n\n... [—Ç–µ–∫—Å—Ç –æ–±—Ä–µ–∑–∞–Ω, –ø–æ–∫–∞–∑–∞–Ω–æ ' + maxLength + ' –∏–∑ ' + originalLength + ' —Å–∏–º–≤–æ–ª–æ–≤]';
    }

    Logger.log('‚úÖ getFileContent: —É—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–æ ' + content.length + ' —Å–∏–º–≤–æ–ª–æ–≤');

    return {
      success: true,
      content: content,
      fileName: fileName,
      mimeType: mimeType,
      charCount: originalLength,
      truncated: originalLength > maxLength
    };

  } catch (error) {
    Logger.log('‚ùå getFileContent –æ—à–∏–±–∫–∞: ' + error.toString());
    Logger.log('  - Stack: ' + (error.stack || '–Ω–µ—Ç —Å—Ç–µ–∫–∞'));

    return {
      success: false,
      error: '–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: ' + error.toString()
    };
  }
}

/**
 * –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ PDF —Ñ–∞–π–ª–∞
 *
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –≤ Google Docs —Å OCR
 *
 * @param {File} file - –û–±—ä–µ–∫—Ç —Ñ–∞–π–ª–∞ DriveApp
 * @param {boolean} keepTempFile - –ù–µ —É–¥–∞–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
 * @returns {string} –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
 */
function extractTextFromPdf(file, keepTempFile) {
  Logger.log('üìÑ extractTextFromPdf: –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PDF –≤ Google Docs');

  let tempDoc = null;

  try {
    // –ü–æ–ª—É—á–∞–µ–º blob —Ñ–∞–π–ª–∞
    const blob = file.getBlob();

    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π Google Doc —Å OCR
    // –†–µ—Å—É—Ä—Å –¥–ª—è Drive API v2
    const resource = {
      title: '[TEMP] ' + file.getName() + ' - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞',
      mimeType: 'application/vnd.google-apps.document'
    };

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º Drive API –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Å OCR
    // ocr: true –≤–∫–ª—é—á–∞–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö
    tempDoc = Drive.Files.insert(resource, blob, {
      ocr: true,
      ocrLanguage: 'ru' // –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ - —Ä—É—Å—Å–∫–∏–π
    });

    Logger.log('  - –°–æ–∑–¥–∞–Ω –≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç: ' + tempDoc.id);

    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
    const doc = DocumentApp.openById(tempDoc.id);
    const text = doc.getBody().getText();

    Logger.log('  - –ò–∑–≤–ª–µ—á–µ–Ω–æ —Å–∏–º–≤–æ–ª–æ–≤: ' + text.length);

    return text;

  } finally {
    // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ keepTempFile)
    if (tempDoc && !keepTempFile) {
      try {
        Drive.Files.remove(tempDoc.id);
        Logger.log('  - –í—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —É–¥–∞–ª–µ–Ω');
      } catch (deleteError) {
        Logger.log('  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç: ' + deleteError);
      }
    }
  }
}

/**
 * –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ Google Docs
 *
 * @param {string} docId - ID –¥–æ–∫—É–º–µ–Ω—Ç–∞
 * @returns {string} –¢–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞
 */
function extractTextFromGoogleDoc(docId) {
  Logger.log('üìÑ extractTextFromGoogleDoc: ' + docId);

  const doc = DocumentApp.openById(docId);
  const text = doc.getBody().getText();

  Logger.log('  - –ò–∑–≤–ª–µ—á–µ–Ω–æ —Å–∏–º–≤–æ–ª–æ–≤: ' + text.length);

  return text;
}

/**
 * –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets –∫–∞–∫ —Ç–µ–∫—Å—Ç
 *
 * @param {string} sheetId - ID —Ç–∞–±–ª–∏—Ü—ã
 * @returns {string} –î–∞–Ω–Ω—ã–µ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
 */
function extractTextFromGoogleSheet(sheetId) {
  Logger.log('üìÑ extractTextFromGoogleSheet: ' + sheetId);

  const spreadsheet = SpreadsheetApp.openById(sheetId);
  const sheets = spreadsheet.getSheets();

  let result = [];

  for (let i = 0; i < sheets.length; i++) {
    const sheet = sheets[i];
    const sheetName = sheet.getName();
    const data = sheet.getDataRange().getValues();

    result.push('=== –õ–∏—Å—Ç: ' + sheetName + ' ===\n');

    for (let row = 0; row < data.length; row++) {
      const rowText = data[row].map(function(cell) {
        return cell !== null && cell !== undefined ? String(cell) : '';
      }).join(' | ');
      result.push(rowText);
    }

    result.push('\n');
  }

  const text = result.join('\n');
  Logger.log('  - –ò–∑–≤–ª–µ—á–µ–Ω–æ —Å–∏–º–≤–æ–ª–æ–≤: ' + text.length);

  return text;
}

/**
 * –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ Word —Ñ–∞–π–ª–∞ (.doc, .docx)
 *
 * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ–∞–π–ª –≤ Google Docs, –∑–∞—Ç–µ–º –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç
 *
 * @param {File} file - –û–±—ä–µ–∫—Ç —Ñ–∞–π–ª–∞ DriveApp
 * @param {boolean} keepTempFile - –ù–µ —É–¥–∞–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
 * @returns {string} –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
 */
function extractTextFromWordFile(file, keepTempFile) {
  Logger.log('üìÑ extractTextFromWordFile: –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Word –≤ Google Docs');
  Logger.log('  - fileName: ' + file.getName());

  var tempDoc = null;

  try {
    var blob = file.getBlob();

    var resource = {
      title: '[TEMP] ' + file.getName() + ' - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞',
      mimeType: 'application/vnd.google-apps.document'
    };

    // convert: true –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ Google —Ñ–æ—Ä–º–∞—Ç
    tempDoc = Drive.Files.insert(resource, blob, {
      convert: true
    });

    Logger.log('  - –°–æ–∑–¥–∞–Ω –≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç: ' + tempDoc.id);

    var doc = DocumentApp.openById(tempDoc.id);
    var text = doc.getBody().getText();

    Logger.log('  - –ò–∑–≤–ª–µ—á–µ–Ω–æ —Å–∏–º–≤–æ–ª–æ–≤: ' + text.length);

    return text;

  } finally {
    if (tempDoc && !keepTempFile) {
      try {
        Drive.Files.remove(tempDoc.id);
        Logger.log('  - –í—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —É–¥–∞–ª–µ–Ω');
      } catch (deleteError) {
        Logger.log('  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç: ' + deleteError);
      }
    }
  }
}

/**
 * –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Excel —Ñ–∞–π–ª–∞ (.xls, .xlsx)
 *
 * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ–∞–π–ª –≤ Google Sheets, –∑–∞—Ç–µ–º –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
 *
 * @param {File} file - –û–±—ä–µ–∫—Ç —Ñ–∞–π–ª–∞ DriveApp
 * @param {boolean} keepTempFile - –ù–µ —É–¥–∞–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
 * @returns {string} –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
 */
function extractTextFromExcelFile(file, keepTempFile) {
  Logger.log('üìÑ extractTextFromExcelFile: –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Excel –≤ Google Sheets');
  Logger.log('  - fileName: ' + file.getName());

  var tempSheet = null;

  try {
    var blob = file.getBlob();

    var resource = {
      title: '[TEMP] ' + file.getName() + ' - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö',
      mimeType: 'application/vnd.google-apps.spreadsheet'
    };

    tempSheet = Drive.Files.insert(resource, blob, {
      convert: true
    });

    Logger.log('  - –°–æ–∑–¥–∞–Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞: ' + tempSheet.id);

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é
    var text = extractTextFromGoogleSheet(tempSheet.id);

    return text;

  } finally {
    if (tempSheet && !keepTempFile) {
      try {
        Drive.Files.remove(tempSheet.id);
        Logger.log('  - –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —É–¥–∞–ª–µ–Ω–∞');
      } catch (deleteError) {
        Logger.log('  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É: ' + deleteError);
      }
    }
  }
}

/**
 * –ò–∑–≤–ª–µ—á—å ID —Ñ–∞–π–ª–∞ –∏–∑ URL Google Drive
 *
 * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç—ã:
 * - https://drive.google.com/file/d/FILE_ID/view
 * - https://drive.google.com/open?id=FILE_ID
 * - FILE_ID (–ø—Ä—è–º–æ–π ID)
 *
 * @param {string} urlOrId - URL –∏–ª–∏ ID —Ñ–∞–π–ª–∞
 * @returns {string|null} ID —Ñ–∞–π–ª–∞ –∏–ª–∏ null
 */
function extractFileIdFromUrl(urlOrId) {
  if (!urlOrId) {
    return null;
  }

  const trimmed = String(urlOrId).trim();
  if (!trimmed) {
    return null;
  }

  // –§–æ—Ä–º–∞—Ç: https://drive.google.com/file/d/FILE_ID/view
  const fileMatch = trimmed.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
  if (fileMatch && fileMatch[1]) {
    return fileMatch[1];
  }

  // –§–æ—Ä–º–∞—Ç: https://drive.google.com/open?id=FILE_ID
  const idMatch = trimmed.match(/[?&]id=([a-zA-Z0-9_-]+)/);
  if (idMatch && idMatch[1]) {
    return idMatch[1];
  }

  // –ü—Ä—è–º–æ–π ID
  const idPattern = /^[a-zA-Z0-9_-]{20,}$/;
  if (idPattern.test(trimmed) && !trimmed.includes('/') && !trimmed.includes('?')) {
    return trimmed;
  }

  return null;
}
```

### –®–∞–≥ 1.3: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ Code.gs

–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `Code.gs` –∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π case –≤ —Ñ—É–Ω–∫—Ü–∏—é `doGet` (–≤ –±–ª–æ–∫ switch, –ø–µ—Ä–µ–¥ `default:`):

```javascript
      case 'getFileContent':
        // –ü–æ–ª—É—á–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ (PDF, Google Docs –∏ —Ç.–¥.)
        Logger.log('üìÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ getFileContent');
        const contentFileUrl = e.parameter.fileId || e.parameter.fileUrl;
        if (!contentFileUrl) {
          return createErrorResponse('–ù–µ —É–∫–∞–∑–∞–Ω fileId –∏–ª–∏ fileUrl');
        }
        return handleGetFileContent({
          fileId: contentFileUrl,
          maxLength: e.parameter.maxLength,
          keepTempFile: e.parameter.keepTempFile
        });
```

**–ú–µ—Å—Ç–æ –≤—Å—Ç–∞–≤–∫–∏:** –ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É `case 'getBeliotDeviceOverride':` –∏ –≤—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π case –ü–ï–†–ï–î –±–ª–æ–∫–æ–º `default:`.

### –®–∞–≥ 1.4: –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ DriveOperations.gs

–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `DriveOperations.gs` –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞:

```javascript
/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞
 *
 * @param {Object} params - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
 * @param {string} params.fileId - ID –∏–ª–∏ URL —Ñ–∞–π–ª–∞
 * @param {number} params.maxLength - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞
 * @param {boolean} params.keepTempFile - –ù–µ —É–¥–∞–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
 * @returns {TextOutput} JSON –æ—Ç–≤–µ—Ç —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º —Ñ–∞–π–ª–∞
 */
function handleGetFileContent(params) {
  try {
    Logger.log('üìÑ handleGetFileContent');
    Logger.log('  - params: ' + JSON.stringify(params));

    if (!params.fileId && !params.fileUrl) {
      return createErrorResponse('–ù–µ —É–∫–∞–∑–∞–Ω fileId –∏–ª–∏ fileUrl');
    }

    const fileUrlOrId = params.fileId || params.fileUrl;

    const options = {
      maxLength: params.maxLength ? parseInt(params.maxLength, 10) : 50000,
      keepTempFile: params.keepTempFile === 'true' || params.keepTempFile === true
    };

    const result = getFileContent(fileUrlOrId, options);

    if (result.success) {
      return createJsonResponse({
        success: true,
        data: result
      });
    } else {
      return createErrorResponse(result.error);
    }

  } catch (error) {
    Logger.log('‚ùå handleGetFileContent –æ—à–∏–±–∫–∞: ' + error.toString());
    return createErrorResponse('–û—à–∏–±–∫–∞: ' + error.toString());
  }
}
```

### –®–∞–≥ 1.5: –í–∫–ª—é—á–∏—Ç—å Drive API –≤ –ø—Ä–æ–µ–∫—Ç–µ GAS

1. –í —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ Apps Script –æ—Ç–∫—Ä—ã—Ç—å **–°–µ—Ä–≤–∏—Å—ã** (–∑–Ω–∞—á–æ–∫ +)
2. –ù–∞–π—Ç–∏ **Drive API** (–Ω–µ –ø—É—Ç–∞—Ç—å —Å DriveApp!)
3. –ù–∞–∂–∞—Ç—å **–î–æ–±–∞–≤–∏—Ç—å**
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤–µ—Ä—Å–∏—è API = v2

### –®–∞–≥ 1.6: –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç

1. –ú–µ–Ω—é: **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ** ‚Üí **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è–º–∏**
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–æ–Ω –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è –ø—Ä–µ–∂–Ω–∏–º)

---

## –ß–∞—Å—Ç—å 2: MCP-—Å–µ—Ä–≤–µ—Ä (Node.js)

### –®–∞–≥ 2.1: –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞

–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `mcp-google-drive-sheets/src/types/drive.ts` –∏ –¥–æ–±–∞–≤–∏—Ç—å:

```typescript
/**
 * –†–µ–∑—É–ª—å—Ç–∞—Ç —á—Ç–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞.
 */
export interface ReadFileResult {
  /** –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ */
  success: boolean;

  /** –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ */
  content?: string;

  /** –ò–º—è —Ñ–∞–π–ª–∞ */
  fileName?: string;

  /** MIME —Ç–∏–ø —Ñ–∞–π–ª–∞ */
  mimeType?: string;

  /** –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ */
  charCount?: number;

  /** –ë—ã–ª –ª–∏ —Ç–µ–∫—Å—Ç –æ–±—Ä–µ–∑–∞–Ω */
  truncated?: boolean;

  /** –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ */
  error?: string;
}
```

### –®–∞–≥ 2.2: –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞

–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `mcp-google-drive-sheets/src/tools/driveTools.ts`.

**2.2.1. –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç —Ç–∏–ø–∞:**

```typescript
import type { DriveFile, DriveFolder, CreateFolderResult, ReadFileResult } from '../types/drive.js';
```

**2.2.2. –î–æ–±–∞–≤–∏—Ç—å Zod —Å—Ö–µ–º—É (–ø–æ—Å–ª–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ö–µ–º):**

```typescript
/**
 * –°—Ö–µ–º–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞.
 */
const readFileSchema = z.object({
  // URL –∏–ª–∏ ID —Ñ–∞–π–ª–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  fileUrl: z.string().min(1, 'URL –∏–ª–∏ ID —Ñ–∞–π–ª–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω'),

  // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 50000 —Å–∏–º–≤–æ–ª–æ–≤
  maxLength: z.number().min(100).max(100000).optional(),
});
```

**2.2.3. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (–≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `registerDriveTools`, –ø–æ—Å–ª–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤):**

```typescript
  // ==========================================
  // –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç 5: –ß—Ç–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞
  // ==========================================

  server.tool(
    'drive_read_file',

    '–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∏–∑ Google Drive. ' +
    '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç: PDF (—Å OCR), Google Docs, Google Sheets, —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã. ' +
    '–î–ª—è PDF —Ñ–∞–π–ª–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç, –≤–∫–ª—é—á–∞—è –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã. ' +
    '–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç —Ñ–∞–π–ª–∞ (–¥–æ 50000 —Å–∏–º–≤–æ–ª–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).',

    readFileSchema.shape,

    async (params) => {
      try {
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        const parsed = readFileSchema.safeParse(params);

        if (!parsed.success) {
          return {
            content: [{
              type: 'text' as const,
              text: `–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: ${parsed.error.message}`,
            }],
            isError: true,
          };
        }

        // –ò–∑–≤–ª–µ–∫–∞–µ–º ID —Ñ–∞–π–ª–∞ –∏–∑ URL
        const fileId = extractDriveId(parsed.data.fileUrl);

        if (!fileId) {
          return {
            content: [{
              type: 'text' as const,
              text: '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å ID —Ñ–∞–π–ª–∞ –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ URL',
            }],
            isError: true,
          };
        }

        // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
        const queryParams: Record<string, string> = {
          fileId: fileId,
        };

        if (parsed.data.maxLength) {
          queryParams.maxLength = String(parsed.data.maxLength);
        }

        // –í—ã–∑—ã–≤–∞–µ–º GAS API
        const result = await gasClient.get<ReadFileResult>('getFileContent', queryParams);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        if (!result.success) {
          return {
            content: [{
              type: 'text' as const,
              text: `–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: ${result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`,
            }],
            isError: true,
          };
        }

        // –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
        let responseText = `üìÑ –§–∞–π–ª: ${result.fileName}\n`;
        responseText += `üìã –¢–∏–ø: ${result.mimeType}\n`;
        responseText += `üìä –°–∏–º–≤–æ–ª–æ–≤: ${result.charCount}`;

        if (result.truncated) {
          responseText += ` (—Ç–µ–∫—Å—Ç –æ–±—Ä–µ–∑–∞–Ω –¥–æ ${parsed.data.maxLength || 50000} —Å–∏–º–≤–æ–ª–æ–≤)`;
        }

        responseText += `\n\n--- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ ---\n\n${result.content}`;

        return {
          content: [{
            type: 'text' as const,
            text: responseText,
          }],
        };

      } catch (error) {
        return {
          content: [{
            type: 'text' as const,
            text: `–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: ${getErrorMessage(error)}`,
          }],
          isError: true,
        };
      }
    }
  );
```

### –®–∞–≥ 2.3: –û–±–Ω–æ–≤–∏—Ç—å —É—Ç–∏–ª–∏—Ç—É –ø–∞—Ä—Å–∏–Ω–≥–∞ URL (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª `mcp-google-drive-sheets/src/utils/urlParser.ts`. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `extractDriveId` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤:

```typescript
// –î–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å:
// - https://drive.google.com/file/d/FILE_ID/view
// - https://drive.google.com/file/d/FILE_ID
```

–ï—Å–ª–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç, –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω:

```typescript
// –§–æ—Ä–º–∞—Ç: https://drive.google.com/file/d/FILE_ID/view
const fileMatch = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
if (fileMatch && fileMatch[1]) {
  return fileMatch[1];
}
```

### –®–∞–≥ 2.4: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å MCP-—Å–µ—Ä–≤–µ—Ä

```bash
cd mcp-google-drive-sheets
npm run build
```

### –®–∞–≥ 2.5: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Claude Code

–ó–∞–∫—Ä—ã—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–Ω–æ–≤–æ Claude Code, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π MCP-—Å–µ—Ä–≤–µ—Ä –∑–∞–≥—Ä—É–∑–∏–ª—Å—è.

---

## –ß–∞—Å—Ç—å 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ GAS —Ñ—É–Ω–∫—Ü–∏–∏

–í —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ Apps Script —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é:

```javascript
function testGetFileContent() {
  // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID PDF —Ñ–∞–π–ª–∞ –∏–∑ –≤–∞—à–µ–≥–æ Drive
  const testFileId = '1-44iVaJjfZDbcqenE-js4vPYHfZhx1tt';

  const result = getFileContent(testFileId);

  Logger.log('=== –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ ===');
  Logger.log('Success: ' + result.success);
  Logger.log('FileName: ' + result.fileName);
  Logger.log('MimeType: ' + result.mimeType);
  Logger.log('CharCount: ' + result.charCount);
  Logger.log('Truncated: ' + result.truncated);

  if (result.success) {
    Logger.log('Content (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤):');
    Logger.log(result.content.substring(0, 500));
  } else {
    Logger.log('Error: ' + result.error);
  }
}
```

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏.

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ MCP

–í Claude Code –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

```
–ü—Ä–æ—á–∏—Ç–∞–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ https://drive.google.com/file/d/1-44iVaJjfZDbcqenE-js4vPYHfZhx1tt/view
```

---

## –ß–∞—Å—Ç—å 4: –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "Drive API not enabled"

**–†–µ—à–µ–Ω–∏–µ:** –í–∫–ª—é—á–∏—Ç—å Drive API –≤ –ø—Ä–æ–µ–∫—Ç–µ GAS (–®–∞–≥ 1.4)

### –ü—Ä–æ–±–ª–µ–º–∞: "Insufficient permissions"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ "–æ—Ç –∏–º–µ–Ω–∏" –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —É —ç—Ç–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª—É

### –ü—Ä–æ–±–ª–µ–º–∞: OCR –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Ç–µ–∫—Å—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —Å–∫–∞–Ω–∞ (–º–∏–Ω–∏–º—É–º 150 DPI)
2. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —É–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥–æ–π —è–∑—ã–∫ OCR: `ocrLanguage: 'en'`

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–æ–≥–æ PDF

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –≤ `gasClient.ts`
2. –†–∞–∑–±–∏—Ç—å PDF –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

### –ü—Ä–æ–±–ª–µ–º–∞: "Quota exceeded"

**–†–µ—à–µ–Ω–∏–µ:**
1. Google Drive API –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç—ã –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
2. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Utilities.sleep(1000)` –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–î–æ–±–∞–≤–∏—Ç—å –≤ GAS:

```javascript
function getFileContentCached(fileUrlOrId, options) {
  const cache = CacheService.getScriptCache();
  const cacheKey = 'file_' + extractFileIdFromUrl(fileUrlOrId);

  const cached = cache.get(cacheKey);
  if (cached) {
    return JSON.parse(cached);
  }

  const result = getFileContent(fileUrlOrId, options);

  if (result.success) {
    // –ö—ç—à–∏—Ä—É–µ–º –Ω–∞ 1 —á–∞—Å
    cache.put(cacheKey, JSON.stringify(result), 3600);
  }

  return result;
}
```

### 2. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

–î–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (JPG, PNG) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ –ø–æ–¥—Ö–æ–¥ —Å OCR:

```javascript
function extractTextFromImage(file) {
  const blob = file.getBlob();

  const resource = {
    title: '[TEMP] OCR ' + file.getName(),
    mimeType: 'application/vnd.google-apps.document'
  };

  const tempDoc = Drive.Files.insert(resource, blob, {
    ocr: true,
    ocrLanguage: 'ru'
  });

  // ... –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ PDF
}
```

### 3. –ß—Ç–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü PDF

–î–ª—è –±–æ–ª—å—à–∏—Ö PDF –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏—é —á—Ç–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (—Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ PDF-—Å–µ—Ä–≤–∏—Å–∞ –∏–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏).

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```
mcp-google-drive-sheets/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ tools/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ driveTools.ts      # + –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç drive_read_file
‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ drive.ts           # + —Ç–∏–ø ReadFileResult
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îî‚îÄ‚îÄ urlParser.ts       # –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É /file/d/ URL

backend/equipment-db/
‚îú‚îÄ‚îÄ DriveOperations.gs         # + —Ñ—É–Ω–∫—Ü–∏–∏ getFileContent, extractTextFromPdf –∏ –¥—Ä.
‚îî‚îÄ‚îÄ Code.gs                    # + –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ handleGetFileContent
```

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ Google Apps Script (–í—ã–ø–æ–ª–Ω–µ–Ω–∏—è ‚Üí –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å Claude Code –¥–ª—è –æ—à–∏–±–æ–∫ MCP
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (`npm install` –≤ –ø–∞–ø–∫–µ mcp-google-drive-sheets)
