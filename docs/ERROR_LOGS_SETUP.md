# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [–î–æ—Å—Ç—É–ø](#–¥–æ—Å—Ç—É–ø)
- [API](#api)

---

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö Supabase –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∏—Ö –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞.

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- ‚úÖ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫ –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫ –ø–æ –ª–æ–≥–∞–º
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–º–µ—á–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –∫–∞–∫ —Ä–µ—à–µ–Ω–Ω—ã—Ö
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö (stack trace, –∫–æ–Ω—Ç–µ–∫—Å—Ç, URL, user agent)

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. SQL –º–∏–≥—Ä–∞—Ü–∏—è

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –ª–æ–≥–æ–≤:

```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ñ–∞–π–ª docs/migrations/create-error-logs-table.sql
-- –≤ Supabase SQL Editor
```

–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç:
- –¢–∞–±–ª–∏—Ü—É `error_logs`
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å)
- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
SELECT * FROM error_logs LIMIT 1;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π
SELECT proname FROM pg_proc WHERE proname LIKE '%error%';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–∏—Ç–∏–∫
SELECT * FROM pg_policies WHERE tablename = 'error_logs';
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã

```sql
CREATE TABLE public.error_logs (
  id UUID PRIMARY KEY,
  error_code TEXT,
  error_message TEXT NOT NULL,
  user_message TEXT,
  error_type TEXT,
  user_id UUID,
  user_email TEXT,
  url TEXT,
  user_agent TEXT,
  stack_trace TEXT,
  context JSONB,
  severity TEXT DEFAULT 'medium',
  resolved BOOLEAN DEFAULT false,
  resolved_at TIMESTAMPTZ,
  resolved_by UUID,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### RLS –ø–æ–ª–∏—Ç–∏–∫–∏

- **SELECT**: –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ª–æ–≥–∏
- **INSERT**: –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ª–æ–≥–∏ (–¥–ª—è –∑–∞–ø–∏—Å–∏ –æ—à–∏–±–æ–∫)
- **UPDATE**: –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å –ª–æ–≥–∏ (–ø–æ–º–µ—á–∞—Ç—å –∫–∞–∫ —Ä–µ—à–µ–Ω–Ω—ã–µ)
- **DELETE**: –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ (–ª–æ–≥–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞)

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–û—à–∏–±–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `logError()`:

```typescript
import { logError } from '../utils/errorHandler';

try {
  await operation();
} catch (error) {
  logError(error, { function: 'operation', params: { id: 123 } });
  // –û—à–∏–±–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –ë–î
}
```

### –†—É—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ä—É—á–Ω–æ–π –∑–∞–ø–∏—Å–∏ –æ—à–∏–±–æ–∫:

```typescript
import { logErrorToDatabase } from '../services/api/errorLogsApi';

await logErrorToDatabase(
  error,
  { context: 'additional info' },
  'high' // severity: 'low' | 'medium' | 'high' | 'critical'
);
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

1. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
3. –ù–∞–∂–º–∏—Ç–µ "–õ–æ–≥–∏ –æ—à–∏–±–æ–∫" (üìä)
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω—É–∂–Ω—ã—Ö –æ—à–∏–±–æ–∫

---

## –î–æ—Å—Ç—É–ø

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –†–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ —Å–∏—Å—Ç–µ–º–µ
- –î–æ—Å—Ç—É–ø –∫ Supabase –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞

–¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é `admin` –≤ —Ç–∞–±–ª–∏—Ü–µ `profiles` –º–æ–≥—É—Ç:
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ª–æ–≥–∏
- –ü–æ–º–µ—á–∞—Ç—å –æ—à–∏–±–∫–∏ –∫–∞–∫ —Ä–µ—à–µ–Ω–Ω—ã–µ
- –í–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

---

## API

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–≥–æ–≤

```typescript
import { getErrorLogs } from '../services/api/errorLogsApi';

const { data, count } = await getErrorLogs(
  {
    severity: 'high',
    resolved: false,
    search: 'network',
  },
  50, // limit
  0   // offset
);
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```typescript
import { getErrorStatistics } from '../services/api/errorLogsApi';

const stats = await getErrorStatistics(7); // –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
// {
//   total_errors: 150,
//   critical_errors: 5,
//   high_errors: 20,
//   medium_errors: 100,
//   low_errors: 25,
//   unresolved_errors: 10
// }
```

### –ü–æ–º–µ—Ç–∏—Ç—å –æ—à–∏–±–∫—É –∫–∞–∫ —Ä–µ—à–µ–Ω–Ω—É—é

```typescript
import { markErrorAsResolved } from '../services/api/errorLogsApi';

await markErrorAsResolved(logId);
```

---

## –§–∏–ª—å—Ç—Ä—ã

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã

- **–°—Ç–∞—Ç—É—Å**: –í—Å–µ / –ù–µ—Ä–µ—à–µ–Ω–Ω—ã–µ / –†–µ—à–µ–Ω–Ω—ã–µ
- **–£—Ä–æ–≤–µ–Ω—å —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏**: –í—Å–µ / –ö—Ä–∏—Ç–∏—á–Ω—ã–µ / –í—ã—Å–æ–∫–∏–µ / –°—Ä–µ–¥–Ω–∏–µ / –ù–∏–∑–∫–∏–µ
- **–ü–æ–∏—Å–∫**: –ü–æ —Å–æ–æ–±—â–µ–Ω–∏—é, –∫–æ–¥—É –æ—à–∏–±–∫–∏ –∏–ª–∏ email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–ü–µ—Ä–∏–æ–¥**: 1 –¥–µ–Ω—å / 7 –¥–Ω–µ–π / 30 –¥–Ω–µ–π / 90 –¥–Ω–µ–π

---

## –£—Ä–æ–≤–Ω–∏ —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏

- **critical** - –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ (—Å–µ—Ç–µ–≤—ã–µ, —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ)
- **high** - –í—ã—Å–æ–∫–∏–µ (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –¥–æ—Å—Ç—É–ø)
- **medium** - –°—Ä–µ–¥–Ω–∏–µ (–≤–∞–ª–∏–¥–∞—Ü–∏—è, –æ–±—â–∏–µ –æ—à–∏–±–∫–∏)
- **low** - –ù–∏–∑–∫–∏–µ (–Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã)

---

## Troubleshooting

### –õ–æ–≥–∏ –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `error_logs` —Å–æ–∑–¥–∞–Ω–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### –ù–µ –º–æ–≥—É –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ–ª—å –≤ —Ç–∞–±–ª–∏—Ü–µ `profiles`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `get_error_statistics` —Å–æ–∑–¥–∞–Ω–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏–∏

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

```typescript
try {
  await saveData(data);
} catch (error) {
  logError(error, {
    function: 'saveData',
    dataId: data.id,
    userId: user.id,
  });
}
```

### –ü—Ä–∏–º–µ—Ä 2: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω–æ–π –æ—à–∏–±–∫–∏

```typescript
try {
  await criticalOperation();
} catch (error) {
  await logErrorToDatabase(error, {}, 'critical');
}
```

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2024  
**–í–µ—Ä—Å–∏—è:** 1.0.0
