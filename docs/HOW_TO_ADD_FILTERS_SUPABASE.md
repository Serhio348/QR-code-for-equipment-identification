# Как добавить фильтр в Supabase Table Editor

## Пошаговая инструкция

### Шаг 1: Откройте Table Editor

1. Войдите в [Supabase Dashboard](https://app.supabase.com)
2. Выберите ваш проект
3. В левом меню нажмите **"Table Editor"** (или **"Редактор таблиц"**)

### Шаг 2: Выберите таблицу

1. В списке таблиц найдите и откройте **`beliot_device_readings`**
2. Вы увидите все записи в таблице

### Шаг 3: Добавьте фильтр

#### Вариант A: Фильтр для данных за прошлый час (динамический)

1. Нажмите кнопку **"Filter"** (или **"Фильтр"**) в верхней части таблицы
2. Нажмите **"Add filter"** (или **"Добавить фильтр"**)
3. Выберите:
   - **Column:** `reading_date`
   - **Operator:** `gte` (greater than or equal - больше или равно)
   - **Value:** Введите формулу: `date_trunc('hour', NOW() - INTERVAL '1 hour')`
   - Нажмите **"Apply"** (или **"Применить"**)

4. Добавьте второй фильтр (для ограничения сверху):
   - Нажмите **"Add filter"** еще раз
   - **Column:** `reading_date`
   - **Operator:** `lt` (less than - меньше)
   - **Value:** Введите формулу: `date_trunc('hour', NOW()')`
   - Нажмите **"Apply"**

**Результат:** Вы увидите все показания за прошлый час.

#### Вариант B: Фильтр для конкретного часа (статический)

1. Нажмите кнопку **"Filter"** (или **"Фильтр"**)
2. Нажмите **"Add filter"** (или **"Добавить фильтр"**)
3. Выберите:
   - **Column:** `reading_date`
   - **Operator:** `gte` (больше или равно)
   - **Value:** `2026-01-08 13:00:00+00` (замените на нужную дату и час)
   - Нажмите **"Apply"**

4. Добавьте второй фильтр:
   - **Column:** `reading_date`
   - **Operator:** `lt` (меньше)
   - **Value:** `2026-01-08 14:00:00+00` (следующий час)
   - Нажмите **"Apply"**

**Результат:** Вы увидите все показания за выбранный час.

#### Вариант C: Фильтр для конкретного устройства

1. Нажмите кнопку **"Filter"**
2. Нажмите **"Add filter"**
3. Выберите:
   - **Column:** `device_id`
   - **Operator:** `eq` (equals - равно)
   - **Value:** Введите ID устройства (например, `12345`)
   - Нажмите **"Apply"**

**Результат:** Вы увидите все показания для выбранного устройства.

### Шаг 4: Комбинирование фильтров

Вы можете добавить несколько фильтров одновременно:

**Пример: Показания конкретного устройства за прошлый час**

1. Фильтр 1:
   - `device_id` = `eq` = `12345`
2. Фильтр 2:
   - `reading_date` >= `gte` = `date_trunc('hour', NOW() - INTERVAL '1 hour')`
3. Фильтр 3:
   - `reading_date` < `lt` = `date_trunc('hour', NOW()')`

### Шаг 5: Сохранение фильтров (опционально)

Supabase Table Editor не сохраняет фильтры автоматически, но вы можете:
- Скопировать URL с фильтрами (если они поддерживаются)
- Использовать SQL Editor для сохранения запросов (см. ниже)

## Альтернатива: Использование SQL Editor

Если фильтры в Table Editor не работают с формулами, используйте SQL Editor:

### Шаг 1: Откройте SQL Editor

1. В левом меню нажмите **"SQL Editor"** (или **"Редактор SQL"**)
2. Нажмите **"New query"** (или **"Новый запрос"**)

### Шаг 2: Вставьте SQL запрос

```sql
-- Данные за прошлый час
SELECT 
  device_id,
  reading_date,
  reading_value,
  unit,
  updated_at
FROM beliot_device_readings
WHERE reading_date >= date_trunc('hour', NOW() - INTERVAL '1 hour')
  AND reading_date < date_trunc('hour', NOW())
ORDER BY reading_date DESC, device_id;
```

### Шаг 3: Выполните запрос

1. Нажмите кнопку **"Run"** (или **"Выполнить"**) или нажмите `Ctrl+Enter`
2. Результаты появятся внизу

### Шаг 4: Сохраните запрос (опционально)

1. Нажмите кнопку **"Save"** (или **"Сохранить"**)
2. Введите название (например, "Данные за прошлый час")
3. Теперь запрос будет доступен в списке сохраненных запросов

## Доступные операторы фильтров

| Оператор | Описание | Пример |
|----------|----------|--------|
| `eq` | Равно | `device_id = '12345'` |
| `neq` | Не равно | `device_id != '12345'` |
| `gt` | Больше | `reading_value > 100` |
| `gte` | Больше или равно | `reading_date >= '2026-01-08'` |
| `lt` | Меньше | `reading_value < 1000` |
| `lte` | Меньше или равно | `reading_date <= '2026-01-08'` |
| `like` | Содержит (для текста) | `device_id LIKE '%123%'` |
| `ilike` | Содержит (без учета регистра) | `unit ILIKE '%м³%'` |
| `is` | IS NULL / IS NOT NULL | `reading_value IS NOT NULL` |
| `in` | В списке | `device_id IN ('123', '456')` |

## Примеры готовых фильтров

### 1. Последние 24 часа

**Фильтр:**
- `reading_date` >= `gte` = `date_trunc('hour', NOW() - INTERVAL '24 hours')`

### 2. Конкретное устройство за сегодня

**Фильтры:**
- `device_id` = `eq` = `12345`
- `reading_date` >= `gte` = `date_trunc('day', NOW())`

### 3. Показания больше определенного значения

**Фильтр:**
- `reading_value` > `gt` = `1000`

### 4. Показания за конкретную дату

**Фильтры:**
- `reading_date` >= `gte` = `2026-01-08 00:00:00+00`
- `reading_date` < `lt` = `2026-01-09 00:00:00+00`

## Советы

1. **Используйте SQL Editor для сложных запросов** - он более гибкий
2. **Сохраняйте часто используемые запросы** - это сэкономит время
3. **Проверяйте часовой пояс** - Supabase использует UTC, убедитесь, что учитываете разницу
4. **Используйте сортировку** - в Table Editor можно сортировать по столбцам, кликая на заголовки

## Устранение проблем

### Фильтр не работает с формулой

Если Table Editor не поддерживает формулы типа `date_trunc()`, используйте SQL Editor.

### Не видно данных

- Проверьте, что cron job работает (данные должны обновляться каждый час)
- Проверьте часовой пояс (Supabase использует UTC)
- Убедитесь, что фильтры применены правильно (нет конфликтующих условий)

### Медленная загрузка

- Используйте индексы (они уже созданы для `device_id` и `reading_date`)
- Ограничьте диапазон дат
- Используйте `LIMIT` в SQL запросах

