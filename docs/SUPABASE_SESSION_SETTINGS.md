# Настройка длительности сессии в Supabase

## Проблема
Сессия истекает слишком быстро (менее минуты), несмотря на изменения в коде.

## Решение

### 1. Настройки в Supabase Dashboard

**ВАЖНО:** Длительность сессии контролируется настройками на стороне Supabase сервера, а не только клиентским кодом.

#### Шаги для настройки:

1. **Откройте Supabase Dashboard:**
   - Перейдите на https://supabase.com/dashboard
   - Выберите ваш проект

2. **Перейдите в настройки аутентификации:**
   - В левом меню выберите **Authentication**
   - Затем перейдите в раздел **Settings** (или **Configuration**)

3. **Настройте параметры сессии:**

   **JWT Expiry (Время жизни JWT токена):**
   - По умолчанию: `3600` секунд (1 час)
   - **Рекомендуемое значение:** `28800` секунд (8 часов)
   - Или больше, если нужно еще дольше
   - Это определяет, как долго действителен access token

   **Session Timeout (Таймаут сессии):**
   - По умолчанию: может быть установлено ограничение
   - **Рекомендуемое значение:** `0` (без ограничения) или большое значение (например, `604800` = 7 дней)
   - Это определяет максимальное время жизни сессии

   **Inactivity Timeout (Таймаут бездействия):**
   - По умолчанию: может быть установлено ограничение
   - **Рекомендуемое значение:** `0` (без ограничения) или большое значение
   - Это определяет время бездействия, после которого сессия завершается

   **Single Session Per User (Одна сессия на пользователя):**
   - Если включено, при входе на новом устройстве предыдущие сессии завершаются
   - **Рекомендация:** Оставить выключенным, если нужно несколько активных сессий

### 2. Проверка настроек в коде

Убедитесь, что в коде установлены правильные значения:

- `src/utils/sessionStorage.ts` - таймаут бездействия: 8 часов
- `src/utils/sessionTimeout.ts` - таймаут бездействия: 8 часов
- `src/services/api/supabaseAuthApi.ts` - fallback для expires_at: 8 часов
- `src/config/supabase.ts` - `autoRefreshToken: true` включен

### 3. Проверка работы

После изменения настроек в Supabase Dashboard:

1. Выйдите из приложения
2. Войдите снова
3. Проверьте, что сессия не истекает слишком быстро

### 4. Дополнительная информация

- **Access Token:** Живет согласно JWT Expiry (по умолчанию 1 час)
- **Refresh Token:** Живет дольше (обычно несколько дней или недель)
- **Auto Refresh:** С `autoRefreshToken: true` Supabase автоматически обновляет access token до истечения refresh token

### 5. Если проблема сохраняется

1. Проверьте консоль браузера на наличие ошибок
2. Проверьте, что `autoRefreshToken: true` работает правильно
3. Убедитесь, что настройки в Supabase Dashboard сохранены
4. Попробуйте очистить localStorage и войти заново

## Ссылки

- [Supabase Auth Sessions Documentation](https://supabase.com/docs/guides/auth/sessions)
- [Supabase JWT Settings](https://supabase.com/docs/guides/auth/jwts)

