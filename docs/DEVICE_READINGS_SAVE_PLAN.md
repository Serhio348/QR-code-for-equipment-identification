# –ü–ª–∞–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π —Å—á—ë—Ç—á–∏–∫–æ–≤

## üìã –û–±–∑–æ—Ä

–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π —Å—á—ë—Ç—á–∏–∫–æ–≤ –∏–∑ Beliot API –≤ Google Sheets –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–∞ –¥–∞–Ω–Ω—ã—Ö.

---

## üéØ –¶–µ–ª–∏

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä** —Ç–µ–∫—É—â–∏—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π –∏–∑ Beliot API
2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Google Sheets** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–∞
3. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** - –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏—è –∑–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏
   - ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –ù–ï –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é!
   - –î–∞–∂–µ –µ—Å–ª–∏ —Ä–∞—Å—Ö–æ–¥ = 0 (–ø–æ–∫–∞–∑–∞–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å), —ç—Ç–æ –Ω–æ–≤–æ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
   - –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥—ã –±–µ–∑ —Ä–∞—Å—Ö–æ–¥–∞
4. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä —á–µ—Ä–µ–∑ Google Apps Script —Ç—Ä–∏–≥–≥–µ—Ä
5. **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

#### Google Sheets - –õ–∏—Å—Ç "–ü–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤"

| –ö–æ–ª–æ–Ω–∫–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|-----|----------|
| A | deviceId | String | ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–∑ Beliot API (–Ω–∞–ø—Ä–∏–º–µ—Ä, "11018") |
| B | readingDate | Number | –î–∞—Ç–∞ —Å–Ω—è—Ç–∏—è –ø–æ–∫–∞–∑–∞–Ω–∏—è (Unix timestamp –≤ —Å–µ–∫—É–Ω–¥–∞—Ö) |
| C | readingValue | Number | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5401.37) |
| D | unit | String | –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è (–º¬≥, –∫–í—Ç –∏ —Ç.–¥.) |
| E | readingType | String | –¢–∏–ø –ø–æ–∫–∞–∑–∞–Ω–∏—è: `hourly` (–ø–æ—á–∞—Å–æ–≤–æ–π) –∏–ª–∏ `daily` (–µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π) |
| F | createdAt | Number | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ –∞—Ä—Ö–∏–≤–µ (Unix timestamp) |
| G | source | String | –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: –≤—Å–µ–≥–¥–∞ `api` (–∏–∑ Beliot API) |
| H | period | String | –ü–µ—Ä–∏–æ–¥ –ø–æ–∫–∞–∑–∞–Ω–∏—è: `current` (—Ç–µ–∫—É—â–µ–µ) –∏–ª–∏ `previous` (–ø—Ä–µ–¥—ã–¥—É—â–µ–µ) |

**–ó–∞–≥–æ–ª–æ–≤–∫–∏ (—Å—Ç—Ä–æ–∫–∞ 1):**
```
deviceId | readingDate | readingValue | unit | readingType | createdAt | source | period
```

---

### 2. Backend (Google Apps Script)

#### –ù–æ–≤—ã–π –º–æ–¥—É–ª—å: `DeviceReadings.gs`

**–§—É–Ω–∫—Ü–∏–∏:**

1. **`getDeviceReadingsSheet()`**
   - –ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ª–∏—Å—Ç "–ü–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤"
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏, –µ—Å–ª–∏ –ª–∏—Å—Ç –Ω–æ–≤—ã–π
   - –í–µ—Ä–Ω—É—Ç—å –æ–±—ä–µ–∫—Ç Sheet

2. **`addDeviceReading(readingData)`**
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏–µ –≤ –ª–∏—Å—Ç
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã (–ø–æ deviceId + readingDate + readingType)
   - –í–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞)

3. **`getDeviceReadings(deviceId, startDate, endDate, readingType)`**
   - –ü–æ–ª—É—á–∏—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ —Ç–∏–ø—É –ø–æ–∫–∞–∑–∞–Ω–∏—è (hourly/daily/all)
   - –í–µ—Ä–Ω—É—Ç—å –º–∞—Å—Å–∏–≤ –ø–æ–∫–∞–∑–∞–Ω–∏–π

4. **`getLastDeviceReading(deviceId)`**
   - –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
   - –í–µ—Ä–Ω—É—Ç—å –æ–±—ä–µ–∫—Ç –ø–æ–∫–∞–∑–∞–Ω–∏—è –∏–ª–∏ null

5. **`checkReadingExists(deviceId, readingDate, readingType)`**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–µ –∑–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ç–∏–ø—É, –ù–ï –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
   - **–í–∞–∂–Ω–æ:** –î–∞–∂–µ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å, –Ω–æ –≤—Ä–µ–º—è –¥—Ä—É–≥–æ–µ - —ç—Ç–æ –ù–ï –¥—É–±–ª–∏–∫–∞—Ç!

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `readingData`:**
```javascript
{
  deviceId: string,        // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
  readingValue: number,    // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
  unit: string,           // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é "–º¬≥"
  readingType: string,     // "hourly" –∏–ª–∏ "daily", –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "hourly"
  readingDate: number,     // Unix timestamp, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
  source: string,          // –í—Å–µ–≥–¥–∞ "api" (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä)
  period: string           // "current" –∏–ª–∏ "previous", –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "current"
}
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `Code.gs`

**–î–æ–±–∞–≤–∏—Ç—å –≤ `doPost`:**
```javascript
case 'addDeviceReading':
  // –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞
  Logger.log('üìä –û–±—Ä–∞–±–æ—Ç–∫–∞ addDeviceReading');
  if (!data.deviceId) {
    return createErrorResponse('deviceId –Ω–µ —É–∫–∞–∑–∞–Ω');
  }
  if (data.readingValue === undefined || data.readingValue === null) {
    return createErrorResponse('readingValue –Ω–µ —É–∫–∞–∑–∞–Ω');
  }
  const readingData = {
    deviceId: String(data.deviceId),
    readingValue: parseFloat(data.readingValue),
    unit: data.unit || '–º¬≥',
    readingType: data.readingType || 'hourly',
    readingDate: data.readingDate ? parseInt(data.readingDate) : Math.floor(Date.now() / 1000),
    source: data.source || 'api',
    period: data.period || 'current'
  };
  const result = addDeviceReading(readingData);
  return createJsonResponse(result);
```

**–î–æ–±–∞–≤–∏—Ç—å –≤ `doGet`:**
```javascript
case 'getDeviceReadings':
  // –ü–æ–ª—É—á–∏—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
  Logger.log('üìä –û–±—Ä–∞–±–æ—Ç–∫–∞ getDeviceReadings (GET)');
  const getDeviceId = e.parameter.deviceId;
  if (!getDeviceId) {
    return createErrorResponse('ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ —É–∫–∞–∑–∞–Ω');
  }
  const getStartDate = e.parameter.startDate ? parseInt(e.parameter.startDate) : null;
  const getEndDate = e.parameter.endDate ? parseInt(e.parameter.endDate) : null;
  const getReadingType = e.parameter.readingType || 'all';
  const readings = getDeviceReadings(getDeviceId, getStartDate, getEndDate, getReadingType);
  return createJsonResponse(readings);

case 'getLastDeviceReading':
  // –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
  Logger.log('üìä –û–±—Ä–∞–±–æ—Ç–∫–∞ getLastDeviceReading (GET)');
  const lastDeviceId = e.parameter.deviceId;
  if (!lastDeviceId) {
    return createErrorResponse('ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ —É–∫–∞–∑–∞–Ω');
  }
  const lastReading = getLastDeviceReading(lastDeviceId);
  return createJsonResponse(lastReading);
```

---

### 3. Frontend (React/TypeScript)

#### –ù–æ–≤—ã–π —Ñ–∞–π–ª: `src/services/api/deviceReadingsApi.ts`

**–§—É–Ω–∫—Ü–∏–∏:**

1. **`saveDeviceReading(readingData)`**
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Google Apps Script API
   - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫–∏

2. **`getDeviceReadings(options)`**
   - –ü–æ–ª—É—á–∏—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: deviceId, startDate, endDate, readingType

3. **`getLastDeviceReading(deviceId)`**
   - –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:**
```typescript
interface DeviceReading {
  id?: number;              // ID —Å—Ç—Ä–æ–∫–∏ –≤ Google Sheets
  deviceId: string;
  readingDate: number;      // Unix timestamp
  readingValue: number;
  unit: string;
  readingType: 'hourly' | 'daily';
  createdAt: number;        // Unix timestamp
  source: 'api';          // –í—Å–µ–≥–¥–∞ "api" (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä)
  period: 'current' | 'previous';
}

interface SaveReadingData {
  deviceId: string;
  readingValue: number;
  unit?: string;
  readingType?: 'hourly' | 'daily';
  readingDate?: number;
  source?: 'api';         // –í—Å–µ–≥–¥–∞ "api" (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä)
  period?: 'current' | 'previous';
}
```

#### –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ Collector

**–í–∞–∂–Ω–æ:** –°–±–æ—Ä –ø–æ–∫–∞–∑–∞–Ω–∏–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ Google Apps Script —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä. –§–∞–π–ª `deviceReadingsCollector.ts` –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –æ—Ç–ª–∞–¥–∫–∏, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —É–ø—Ä–æ—â—ë–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é, –Ω–æ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±—É–¥–µ—Ç –≤ Google Apps Script.

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π

```typescript
// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é getDeviceReadings –∏–∑ beliotDeviceApi.ts
const readings = await getDeviceReadings(deviceId);
// readings.current —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—É—â–µ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã

**–í–∞–∂–Ω–æ:** –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ç–∏–ø—É, –ù–ï –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é! –î–∞–∂–µ –µ—Å–ª–∏ —Ä–∞—Å—Ö–æ–¥ = 0 (–ø–æ–∫–∞–∑–∞–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å), —ç—Ç–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–æ–≤–æ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.

```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ –∑–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥
const lastReading = await getLastDeviceReading(deviceId);
if (lastReading && !force) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏
  // –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ–º readingValue - –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è, –Ω–æ —ç—Ç–æ –Ω–æ–≤–æ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ!
  
  if (readingType === 'hourly') {
    // –î–ª—è –ø–æ—á–∞—Å–æ–≤—ã—Ö: –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–µ –∑–∞ —Ç–æ—Ç –∂–µ —á–∞—Å
    const currentHour = Math.floor(currentReading.readingDate / 3600) * 3600;
    const lastHour = Math.floor(lastReading.readingDate / 3600) * 3600;
    
    if (currentHour === lastHour) {
      // –ü–æ–∫–∞–∑–∞–Ω–∏–µ –∑–∞ —ç—Ç–æ—Ç —á–∞—Å —É–∂–µ –µ—Å—Ç—å
      return { success: false, reason: 'duplicate', message: '–ü–æ–∫–∞–∑–∞–Ω–∏–µ –∑–∞ —ç—Ç–æ—Ç —á–∞—Å —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ' };
    }
  } else if (readingType === 'daily') {
    // –î–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö: –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–µ –∑–∞ —Ç–æ—Ç –∂–µ –¥–µ–Ω—å
    const currentDay = Math.floor(currentReading.readingDate / 86400) * 86400;
    const lastDay = Math.floor(lastReading.readingDate / 86400) * 86400;
    
    if (currentDay === lastDay) {
      // –ü–æ–∫–∞–∑–∞–Ω–∏–µ –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å —É–∂–µ –µ—Å—Ç—å
      return { success: false, reason: 'duplicate', message: '–ü–æ–∫–∞–∑–∞–Ω–∏–µ –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ' };
    }
  }
}

// –ï—Å–ª–∏ –Ω–µ –¥—É–±–ª–∏–∫–∞—Ç - —Å–æ—Ö—Ä–∞–Ω—è–µ–º, –¥–∞–∂–µ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
// –≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥–æ–≤ –±–µ–∑ —Ä–∞—Å—Ö–æ–¥–∞!
```

### –®–∞–≥ 3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Google Sheets

```typescript
const result = await saveDeviceReading({
  deviceId: deviceId,
  readingValue: readings.current.value,
  unit: readings.current.unit || '–º¬≥',
  readingType: 'hourly',
  readingDate: Math.floor(new Date(readings.current.date).getTime() / 1000),
  source: 'api',
  period: 'current'
});
```

---

## ‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∞

### Google Apps Script —Ç—Ä–∏–≥–≥–µ—Ä (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
- –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –ù–∞–¥—ë–∂–Ω–æ
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

1. –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤ Google Apps Script:
```javascript
function collectReadingsHourly() {
  Logger.log('üîÑ –ù–∞—á–∞–ª–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π...');
  
  try {
    // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏–∑ Beliot API
    // –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:
    //   1. –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Beliot API
    //   2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
    //   3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Google Sheets —á–µ—Ä–µ–∑ addDeviceReading
    
    const devices = getBeliotDevices(); // –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    let successCount = 0;
    let errorCount = 0;
    
    for (let i = 0; i < devices.length; i++) {
      const device = devices[i];
      try {
        // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∫–∞–∑–∞–Ω–∏–µ –∏–∑ Beliot API
        const reading = getBeliotDeviceReading(device.device_id);
        
        if (reading && reading.current) {
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Google Sheets
          const result = addDeviceReading({
            deviceId: device.device_id,
            readingValue: reading.current.value,
            unit: reading.current.unit || '–º¬≥',
            readingType: 'hourly',
            readingDate: Math.floor(new Date(reading.current.date).getTime() / 1000),
            source: 'api',
            period: 'current'
          });
          
          if (result.success) {
            successCount++;
          } else if (result.reason === 'duplicate') {
            // –î—É–±–ª–∏–∫–∞—Ç - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–µ —Å—á–∏—Ç–∞–µ–º –æ—à–∏–±–∫–æ–π
            Logger.log(`‚ö†Ô∏è –ü–æ–∫–∞–∑–∞–Ω–∏–µ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ ${device.device_id} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–¥—É–±–ª–∏–∫–∞—Ç)`);
          } else {
            errorCount++;
            Logger.log(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ ${device.device_id}: ${result.message}`);
          }
        }
      } catch (error) {
        errorCount++;
        Logger.log(`‚ùå –û—à–∏–±–∫–∞ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ ${device.device_id}: ${error.toString()}`);
      }
    }
    
    Logger.log(`‚úÖ –°–±–æ—Ä –∑–∞–≤–µ—Ä—à—ë–Ω. –£—Å–ø–µ—à–Ω–æ: ${successCount}, –û—à–∏–±–æ–∫: ${errorCount}`);
  } catch (error) {
    Logger.log(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–µ –ø–æ–∫–∞–∑–∞–Ω–∏–π: ${error.toString()}`);
  }
}
```

2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä:
   - **–¢—Ä–∏–≥–≥–µ—Ä—ã ‚Üí –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä**
   - –§—É–Ω–∫—Ü–∏—è: `collectReadingsHourly`
   - –ò—Å—Ç–æ—á–Ω–∏–∫ —Å–æ–±—ã—Ç–∏—è: **–ü–æ –≤—Ä–µ–º–µ–Ω–∏**
   - –¢–∏–ø —Ç—Ä–∏–≥–≥–µ—Ä–∞: **–ö–∞–∂–¥—ã–π —á–∞—Å**
   - –í—Ä–µ–º—è: `00:00` (–Ω–∞—á–∞–ª–æ —á–∞—Å–∞)

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- Google Apps Script –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (6 –º–∏–Ω—É—Ç)
- –ú–∞–∫—Å–∏–º—É–º 20,000 –≤—ã–∑–æ–≤–æ–≤ API –≤ –¥–µ–Ω—å
- –î–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–±–∞—Ç—á–∏–Ω–≥, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –í–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä (Cron Job)**

–ï—Å–ª–∏ Google Apps Script –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π:

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π Google Apps Script
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –º–æ—â–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

1. –°–æ–∑–¥–∞—Ç—å API endpoint –¥–ª—è —Å–±–æ—Ä–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron job:
```bash
# –ö–∞–∂–¥—ã–π —á–∞—Å
0 * * * * curl -X POST https://your-api.com/api/collect-readings
```

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –¢—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã

---

## üìä –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —á–∞—Å—Ç–æ—Ç–∞ —Å–±–æ—Ä–∞

### –ü–æ—á–∞—Å–æ–≤–æ–π —Å–±–æ—Ä (`hourly`)
- **–ö–æ–≥–¥–∞:** –ö–∞–∂–¥—ã–π —á–∞—Å –≤ –Ω–∞—á–∞–ª–µ —á–∞—Å–∞ (00:00, 01:00, ...)
- **–î–ª—è:** –ö—Ä–∏—Ç–∏—á–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, —Ç—Ä–µ–±—É—é—â–∏—Ö –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **–û–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö:** ~24 –∑–∞–ø–∏—Å–∏ –≤ –¥–µ–Ω—å –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–±–æ—Ä (`daily`)
- **–ö–æ–≥–¥–∞:** –û–¥–∏–Ω —Ä–∞–∑ –≤ –¥–µ–Ω—å (–æ–±—ã—á–Ω–æ –≤ 00:00)
- **–î–ª—è:** –ú–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- **–û–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö:** 1 –∑–∞–ø–∏—Å—å –≤ –¥–µ–Ω—å –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã

### ‚ö†Ô∏è –í–∞–∂–Ω–æ: –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:** –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ **–≤—Ä–µ–º–µ–Ω–∏** –∏ **—Ç–∏–ø—É –ø–æ–∫–∞–∑–∞–Ω–∏—è**, **–ù–ï –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é**!

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–¥ = 0 (–ø–æ–∫–∞–∑–∞–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å), —ç—Ç–æ –≤—Å—ë —Ä–∞–≤–Ω–æ **–Ω–æ–≤–æ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ**, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥—ã –±–µ–∑ —Ä–∞—Å—Ö–æ–¥–∞
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–ª–∞, –Ω–æ —Ä–∞—Å—Ö–æ–¥–∞ –Ω–µ –±—ã–ª–æ

### –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **–î–ª—è –ø–æ—á–∞—Å–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π (`hourly`):**
   - –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–µ –∑–∞ —Ç–æ—Ç –∂–µ —á–∞—Å
   - –í—ã—á–∏—Å–ª—è–µ–º –Ω–∞—á–∞–ª–æ —á–∞—Å–∞: `Math.floor(readingDate / 3600) * 3600`
   - –ï—Å–ª–∏ –Ω–∞—á–∞–ª–æ —á–∞—Å–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–æ–∫–∞–∑–∞–Ω–∏–µ–º - —ç—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç
   - **–ü—Ä–∏–º–µ—Ä:**
     - –°—É—â–µ—Å—Ç–≤—É—é—â–µ–µ: `readingDate = 1704067200` (2024-01-01 10:00:00) ‚Üí —á–∞—Å = `1704067200`
     - –ù–æ–≤–æ–µ: `readingDate = 1704067300` (2024-01-01 10:01:40) ‚Üí —á–∞—Å = `1704067200` ‚Üí **–¥—É–±–ª–∏–∫–∞—Ç**
     - –ù–æ–≤–æ–µ: `readingDate = 1704070800` (2024-01-01 11:00:00) ‚Üí —á–∞—Å = `1704070800` ‚Üí **–Ω–µ –¥—É–±–ª–∏–∫–∞—Ç**

2. **–î–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π (`daily`):**
   - –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–µ –∑–∞ —Ç–æ—Ç –∂–µ –¥–µ–Ω—å
   - –í—ã—á–∏—Å–ª—è–µ–º –Ω–∞—á–∞–ª–æ –¥–Ω—è: `Math.floor(readingDate / 86400) * 86400`
   - –ï—Å–ª–∏ –Ω–∞—á–∞–ª–æ –¥–Ω—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–æ–∫–∞–∑–∞–Ω–∏–µ–º - —ç—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç
   - **–ü—Ä–∏–º–µ—Ä:**
     - –°—É—â–µ—Å—Ç–≤—É—é—â–µ–µ: `readingDate = 1704067200` (2024-01-01 00:00:00) ‚Üí –¥–µ–Ω—å = `1704067200`
     - –ù–æ–≤–æ–µ: `readingDate = 1704153600` (2024-01-02 00:00:00) ‚Üí –¥–µ–Ω—å = `1704153600` ‚Üí **–Ω–µ –¥—É–±–ª–∏–∫–∞—Ç**

3. **–ü–∞—Ä–∞–º–µ—Ç—Ä `force`:**
   - –ï—Å–ª–∏ `force: true` - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏

### –ß—Ç–æ –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:

‚ùå **–ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ–º `readingValue`** - –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è, –Ω–æ —ç—Ç–æ –Ω–æ–≤–æ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ!
- –°—Ü–µ–Ω–∞—Ä–∏–π: –°—á—ë—Ç—á–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `5401.37` –≤ 10:00 –∏ `5401.37` –≤ 11:00
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –û–±–∞ –ø–æ–∫–∞–∑–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (—Ä–∞—Å—Ö–æ–¥ = 0, –Ω–æ —ç—Ç–æ –≤–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ:

**Backend (`DeviceReadings.gs`):**
```javascript
function checkReadingExists(deviceId, readingDate, readingType) {
  const sheet = getDeviceReadingsSheet();
  const lastRow = sheet.getLastRow();
  
  if (lastRow < 2) return false;
  
  // –ß–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –∑–∞–ø–∏—Å–µ–π –¥–ª—è —ç—Ç–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
  const data = sheet.getRange(2, 1, lastRow - 1, 5).getValues(); // deviceId, readingDate, readingValue, unit, readingType
  
  // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ deviceId –∏ readingType
  const deviceReadings = data.filter(row => 
    String(row[0]) === String(deviceId) && row[4] === readingType
  );
  
  if (deviceReadings.length === 0) return false;
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞)
  if (readingType === 'hourly') {
    const currentHour = Math.floor(readingDate / 3600) * 3600;
    return deviceReadings.some(row => {
      const rowHour = Math.floor(row[1] / 3600) * 3600;
      return rowHour === currentHour;
    });
  } else if (readingType === 'daily') {
    const currentDay = Math.floor(readingDate / 86400) * 86400;
    return deviceReadings.some(row => {
      const rowDay = Math.floor(row[1] / 86400) * 86400;
      return rowDay === currentDay;
    });
  }
  
  return false;
}
```

**Frontend (`deviceReadingsCollector.ts`):**
```typescript
async function collectDeviceReading(
  deviceId: string,
  readingType: 'hourly' | 'daily',
  force: boolean = false
): Promise<{ success: boolean; reason?: string; message?: string }> {
  try {
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ –∏–∑ Beliot API
    const readings = await getDeviceReadings(deviceId);
    
    if (!readings.current) {
      return { success: false, reason: 'no_reading', message: '–ü–æ–∫–∞–∑–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' };
    }
    
    const readingDate = Math.floor(new Date(readings.current.date).getTime() / 1000);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ force)
    if (!force) {
      const lastReading = await getLastDeviceReading(deviceId);
      
      if (lastReading) {
        if (readingType === 'hourly') {
          const currentHour = Math.floor(readingDate / 3600) * 3600;
          const lastHour = Math.floor(lastReading.readingDate / 3600) * 3600;
          
          if (currentHour === lastHour) {
            return {
              success: false,
              reason: 'duplicate',
              message: '–ü–æ–∫–∞–∑–∞–Ω–∏–µ –∑–∞ —ç—Ç–æ—Ç —á–∞—Å —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ'
            };
          }
        } else if (readingType === 'daily') {
          const currentDay = Math.floor(readingDate / 86400) * 86400;
          const lastDay = Math.floor(lastReading.readingDate / 86400) * 86400;
          
          if (currentDay === lastDay) {
            return {
              success: false,
              reason: 'duplicate',
              message: '–ü–æ–∫–∞–∑–∞–Ω–∏–µ –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ'
            };
          }
        }
      }
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∫–∞–∑–∞–Ω–∏–µ (–¥–∞–∂–µ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å!)
    await saveDeviceReading({
      deviceId: deviceId,
      readingValue: readings.current.value,
      unit: readings.current.unit || '–º¬≥',
      readingType: readingType,
      readingDate: readingDate,
      source: 'api',
      period: 'current'
    });
    
    return { success: true };
  } catch (error: any) {
    return {
      success: false,
      reason: 'error',
      message: error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–∫–∞–∑–∞–Ω–∏—è'
    };
  }
}
```

### –ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –†–∞—Å—Ö–æ–¥ = 0 (–ø–æ–∫–∞–∑–∞–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å)**
- 10:00 - –ø–æ–∫–∞–∑–∞–Ω–∏–µ: `5401.37 –º¬≥`
- 11:00 - –ø–æ–∫–∞–∑–∞–Ω–∏–µ: `5401.37 –º¬≥` (—Ä–∞—Å—Ö–æ–¥ = 0)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–±–∞ –ø–æ–∫–∞–∑–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è ‚úÖ
- **–ü—Ä–∏—á–∏–Ω–∞:** –†–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è = —Ä–∞–∑–Ω—ã–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è, –¥–∞–∂–µ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –î—É–±–ª–∏–∫–∞—Ç (—Ç–æ—Ç –∂–µ —á–∞—Å)**
- 10:00 - –ø–æ–∫–∞–∑–∞–Ω–∏–µ: `5401.37 –º¬≥` (—É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ)
- 10:15 - –ø–æ–∫–∞–∑–∞–Ω–∏–µ: `5402.50 –º¬≥` (–ø–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Ç–æ—Ä–æ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (–¥—É–±–ª–∏–∫–∞—Ç) ‚ùå
- **–ü—Ä–∏—á–∏–Ω–∞:** –û–±–∞ –ø–æ–∫–∞–∑–∞–Ω–∏—è –≤ –æ–¥–Ω–æ–º —á–∞—Å–µ

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –†–∞–∑–Ω—ã–µ —á–∞—Å—ã, –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**
- 10:00 - –ø–æ–∫–∞–∑–∞–Ω–∏–µ: `5401.37 –º¬≥`
- 11:00 - –ø–æ–∫–∞–∑–∞–Ω–∏–µ: `5401.37 –º¬≥`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–±–∞ –ø–æ–∫–∞–∑–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è ‚úÖ
- **–ü—Ä–∏—á–∏–Ω–∞:** –†–∞–∑–Ω—ã–µ —á–∞—Å—ã = —Ä–∞–∑–Ω—ã–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–∫–∞–∑–∞–Ω–∏—è

```typescript
import { getDeviceReadings } from './services/api/beliotDeviceApi';
import { saveDeviceReading } from './services/api/deviceReadingsApi';

// –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ
const readings = await getDeviceReadings('11018');

if (readings.current) {
  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Google Sheets
  await saveDeviceReading({
    deviceId: '11018',
    readingValue: readings.current.value,
    unit: readings.current.unit || '–º¬≥',
    readingType: 'hourly',
    readingDate: Math.floor(new Date(readings.current.date).getTime() / 1000),
    source: 'api',
    period: 'current'
  });
}
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –ø–æ–∫–∞–∑–∞–Ω–∏–π (Google Apps Script)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –°–±–æ—Ä –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Google Apps Script —Ç—Ä–∏–≥–≥–µ—Ä. –≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è —Å–±–æ—Ä–∞ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞:

```javascript
// –í Google Apps Script (collectReadingsHourly)
function collectReadingsHourly() {
  // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  const devices = getBeliotDevices();
  
  // –°–æ–±—Ä–∞—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  for (let i = 0; i < devices.length; i++) {
    const device = devices[i];
    try {
      // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∫–∞–∑–∞–Ω–∏–µ –∏–∑ Beliot API
      const reading = getBeliotDeviceReading(device.device_id);
      
      if (reading && reading.current) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Google Sheets
        const result = addDeviceReading({
          deviceId: device.device_id,
          readingValue: reading.current.value,
          unit: reading.current.unit || '–º¬≥',
          readingType: 'hourly',
          readingDate: Math.floor(new Date(reading.current.date).getTime() / 1000),
          source: 'api',
          period: 'current'
        });
        
        if (result.success) {
          Logger.log(`‚úÖ –ü–æ–∫–∞–∑–∞–Ω–∏–µ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ ${device.device_id} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ`);
        } else if (result.reason === 'duplicate') {
          Logger.log(`‚ö†Ô∏è –ü–æ–∫–∞–∑–∞–Ω–∏–µ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ ${device.device_id} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç`);
        }
      }
    } catch (error) {
      Logger.log(`‚ùå –û—à–∏–±–∫–∞ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ ${device.device_id}: ${error.toString()}`);
    }
  }
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π

```typescript
import { getDeviceReadings } from './services/api/deviceReadingsApi';

// –ü–æ–ª—É—á–∏—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥
const startDate = Math.floor(new Date('2025-01-01').getTime() / 1000);
const endDate = Math.floor(new Date('2025-01-31').getTime() / 1000);

const readings = await getDeviceReadings({
  deviceId: '11018',
  startDate: startDate,
  endDate: endDate,
  readingType: 'hourly'
});

console.log(`–ù–∞–π–¥–µ–Ω–æ –ø–æ–∫–∞–∑–∞–Ω–∏–π: ${readings.length}`);
```

---

## üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: Backend (Google Apps Script)
- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `DeviceReadings.gs`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –ª–∏—Å—Ç–æ–º
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ `Code.gs`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### –≠—Ç–∞–ø 2: Frontend API
- [ ] –°–æ–∑–¥–∞—Ç—å `deviceReadingsApi.ts`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

### –≠—Ç–∞–ø 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä (Google Apps Script)
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `collectReadingsHourly()` –≤ Google Apps Script
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞–Ω–∏–π –∏–∑ Beliot API
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –≠—Ç–∞–ø 4: UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π –≤ `BeliotDevicesTest.tsx`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –ø–µ—Ä–∏–æ–¥—É –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É

### –≠—Ç–∞–ø 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä Google Apps Script –Ω–∞ –∫–∞–∂–¥—ã–π —á–∞—Å
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –≠—Ç–∞–ø 6: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö (limit/offset)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ (–ø–æ readingDate DESC)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞ —Å—Ç—Ä–æ–∫
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—á–µ—Ä–µ–∑ 6 –º–µ—Å—è—Ü–µ–≤)
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å UI —Å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–µ–π —Å–ø–∏—Å–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –±–æ–ª—å—à–∏–º –æ–±—ä—ë–º–æ–º –¥–∞–Ω–Ω—ã—Ö

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Google Sheets:**
   - –ú–∞–∫—Å–∏–º—É–º 5 –º–∏–ª–ª–∏–æ–Ω–æ–≤ —Å—Ç—Ä–æ–∫ –Ω–∞ –ª–∏—Å—Ç
   - –ü—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä—ë–º–µ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –î–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–µ –±–æ–ª–µ–µ 5-10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Beliot API

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –í—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏ API
   - –õ–æ–≥–∏—Ä—É–π—Ç–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   - –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–π—Ç–µ —Å–±–æ—Ä –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ–¥–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - Google Apps Script API –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—â–∏—â—ë–Ω
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö

---

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–ü—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ Google Sheets –Ω–∞ 50% –∏ –±–æ–ª–µ–µ, –≤—ã–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–æ–∂–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞.

### –†–µ—à–µ–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### 1. –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —Å—Ä–∞–∑—É –∑–∞–º–µ–¥–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É.

**–†–µ—à–µ–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ API.

**Backend (`DeviceReadings.gs`):**
```javascript
function getDeviceReadings(deviceId, startDate, endDate, readingType, options) {
  options = options || {};
  const limit = options.limit || 100;        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 100 –∑–∞–ø–∏—Å–µ–π
  const offset = options.offset || 0;        // –°–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
  const sortBy = options.sortBy || 'readingDate'; // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
  const sortOrder = options.sortOrder || 'desc';  // –ü–æ—Ä—è–¥–æ–∫: desc (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞) –∏–ª–∏ asc
  
  const sheet = getDeviceReadingsSheet();
  const lastRow = sheet.getLastRow();
  
  if (lastRow < 2) {
    return {
      data: [],
      total: 0,
      limit: limit,
      offset: offset,
      hasMore: false
    };
  }
  
  // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (—Ñ–∏–ª—å—Ç—Ä—É–µ–º –≤ –ø–∞–º—è—Ç–∏ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏)
  const allData = sheet.getRange(2, 1, lastRow - 1, 8).getValues();
  
  // –§–∏–ª—å—Ç—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
  let filtered = allData.filter((row, index) => {
    const rowDeviceId = String(row[0]);
    const rowDate = row[1];
    const rowType = row[4];
    
    // –§–∏–ª—å—Ç—Ä –ø–æ deviceId
    if (deviceId && rowDeviceId !== String(deviceId)) return false;
    
    // –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ
    if (startDate && rowDate < startDate) return false;
    if (endDate && rowDate > endDate) return false;
    
    // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É
    if (readingType && readingType !== 'all' && rowType !== readingType) return false;
    
    return true;
  });
  
  // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
  filtered.sort((a, b) => {
    const aValue = a[1]; // readingDate
    const bValue = b[1];
    return sortOrder === 'desc' ? bValue - aValue : aValue - bValue;
  });
  
  // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
  const total = filtered.length;
  const paginated = filtered.slice(offset, offset + limit);
  
  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –æ–±—ä–µ–∫—Ç—ã
  const result = paginated.map((row, index) => ({
    id: offset + index + 2, // +2 –ø–æ—Ç–æ–º—É —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ 1 - –∑–∞–≥–æ–ª–æ–≤–∫–∏, –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å 0
    deviceId: String(row[0]),
    readingDate: row[1],
    readingValue: row[2],
    unit: row[3],
    readingType: row[4],
    createdAt: row[5],
    source: row[6],
    period: row[7]
  }));
  
  return {
    data: result,
    total: total,
    limit: limit,
    offset: offset,
    hasMore: (offset + limit) < total
  };
}
```

**Frontend (`deviceReadingsApi.ts`):**
```typescript
interface GetReadingsOptions {
  deviceId?: string;
  startDate?: number;
  endDate?: number;
  readingType?: 'hourly' | 'daily' | 'all';
  limit?: number;        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  offset?: number;       // –°–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
  sortBy?: string;       // –ü–æ–ª–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  sortOrder?: 'asc' | 'desc';
}

interface GetReadingsResponse {
  data: DeviceReading[];
  total: number;
  limit: number;
  offset: number;
  hasMore: boolean;
}

export async function getDeviceReadings(
  options: GetReadingsOptions = {}
): Promise<GetReadingsResponse> {
  const url = new URL(API_CONFIG.EQUIPMENT_API_URL);
  url.searchParams.append('action', 'getDeviceReadings');
  
  if (options.deviceId) {
    url.searchParams.append('deviceId', options.deviceId);
  }
  if (options.startDate) {
    url.searchParams.append('startDate', options.startDate.toString());
  }
  if (options.endDate) {
    url.searchParams.append('endDate', options.endDate.toString());
  }
  if (options.readingType) {
    url.searchParams.append('readingType', options.readingType);
  }
  if (options.limit) {
    url.searchParams.append('limit', options.limit.toString());
  }
  if (options.offset) {
    url.searchParams.append('offset', options.offset.toString());
  }
  if (options.sortBy) {
    url.searchParams.append('sortBy', options.sortBy);
  }
  if (options.sortOrder) {
    url.searchParams.append('sortOrder', options.sortOrder);
  }
  
  const response = await fetch(url.toString());
  if (!response.ok) {
    throw new Error(`HTTP error! status: ${response.status}`);
  }
  
  return await response.json();
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ UI:**
```typescript
const [readings, setReadings] = useState<DeviceReading[]>([]);
const [total, setTotal] = useState(0);
const [page, setPage] = useState(0);
const [loading, setLoading] = useState(false);
const pageSize = 100;

const loadReadings = async (pageNum: number) => {
  setLoading(true);
  try {
    const result = await getDeviceReadings({
      deviceId: selectedDeviceId,
      startDate: startDate,
      endDate: endDate,
      limit: pageSize,
      offset: pageNum * pageSize,
      sortOrder: 'desc'
    });
    
    setReadings(result.data);
    setTotal(result.total);
    setPage(pageNum);
  } finally {
    setLoading(false);
  }
};
```

#### 2. –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∏—Å–∫ –ø–æ –Ω–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º –º–µ–¥–ª–µ–Ω–Ω—ã–π.

**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ (–ø–æ readingDate DESC).

**Backend (`DeviceReadings.gs`):**
```javascript
function addDeviceReading(readingData) {
  const sheet = getDeviceReadingsSheet();
  const lastRow = sheet.getLastRow();
  
  // –ù–∞—Ö–æ–¥–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ readingDate DESC)
  let insertRow = 2; // –ü–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
  
  if (lastRow >= 2) {
    const data = sheet.getRange(2, 1, lastRow - 1, 2).getValues(); // –¢–æ–ª—å–∫–æ deviceId –∏ readingDate
    const newDate = readingData.readingDate;
    
    // –ò—â–µ–º –ø–æ–∑–∏—Ü–∏—é, –≥–¥–µ readingDate –±–æ–ª—å—à–µ –Ω–æ–≤–æ–≥–æ (–¥–ª—è DESC —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏)
    for (let i = 0; i < data.length; i++) {
      if (data[i][1] < newDate) { // readingDate –≤ –∫–æ–ª–æ–Ω–∫–µ B (–∏–Ω–¥–µ–∫—Å 1)
        insertRow = i + 2; // +2 –ø–æ—Ç–æ–º—É —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ 1 - –∑–∞–≥–æ–ª–æ–≤–∫–∏, –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å 0
        break;
      }
    }
    
    if (insertRow === 2 && data.length > 0 && data[0][1] >= newDate) {
      insertRow = lastRow + 1; // –í—Å—Ç–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω–µ—Ü, –µ—Å–ª–∏ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ–Ω—å—à–µ –≤—Å–µ—Ö
    }
  }
  
  // –í—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É
  sheet.insertRowBefore(insertRow);
  
  // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
  const row = [
    readingData.deviceId,
    readingData.readingDate,
    readingData.readingValue,
    readingData.unit || '–º¬≥',
    readingData.readingType || 'hourly',
    readingData.createdAt || Math.floor(Date.now() / 1000),
    readingData.source || 'api',
    readingData.period || 'current'
  ];
  
  sheet.getRange(insertRow, 1, 1, 8).setValues([row]);
  
  return { success: true, row: insertRow };
}
```

#### 3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ß–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π –Ω–∞–≥—Ä—É–∂–∞—é—Ç —Å–∏—Å—Ç–µ–º—É.

**–†–µ—à–µ–Ω–∏–µ:** –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

**Backend (`DeviceReadings.gs`):**
```javascript
// –ö—ç—à –≤ –ø–∞–º—è—Ç–∏ (—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–∞)
var lastReadingsCache = {};

function getLastDeviceReading(deviceId) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à (–µ—Å–ª–∏ –µ—Å—Ç—å)
  const cacheKey = String(deviceId);
  if (lastReadingsCache[cacheKey]) {
    const cached = lastReadingsCache[cacheKey];
    // –ö—ç—à –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 5 –º–∏–Ω—É—Ç
    if (Date.now() - cached.timestamp < 5 * 60 * 1000) {
      return cached.data;
    }
  }
  
  // –ü–æ–ª—É—á–∞–µ–º –∏–∑ –ª–∏—Å—Ç–∞ (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 100 —Å—Ç—Ä–æ–∫, —Ç.–∫. –¥–∞–Ω–Ω—ã–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã)
  const sheet = getDeviceReadingsSheet();
  const lastRow = Math.min(sheet.getLastRow(), 101); // –ó–∞–≥–æ–ª–æ–≤–æ–∫ + 100 —Å—Ç—Ä–æ–∫
  
  if (lastRow < 2) {
    return null;
  }
  
  const data = sheet.getRange(2, 1, lastRow - 1, 8).getValues();
  
  // –ò—â–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–∫–∞–∑–∞–Ω–∏–µ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–¥–∞–Ω–Ω—ã–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã DESC)
  for (let i = 0; i < data.length; i++) {
    if (String(data[i][0]) === String(deviceId)) {
      const result = {
        id: i + 2,
        deviceId: String(data[i][0]),
        readingDate: data[i][1],
        readingValue: data[i][2],
        unit: data[i][3],
        readingType: data[i][4],
        createdAt: data[i][5],
        source: data[i][6],
        period: data[i][7]
      };
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
      lastReadingsCache[cacheKey] = {
        data: result,
        timestamp: Date.now()
      };
      
      return result;
    }
  }
  
  return null;
}
```

#### 4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ß—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–∏—Å—Ç–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–µ.

**–†–µ—à–µ–Ω–∏–µ:** –ß–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω —Å—Ç—Ä–æ–∫.

**Backend (`DeviceReadings.gs`):**
```javascript
function getDeviceReadingsOptimized(deviceId, startDate, endDate, readingType, options) {
  options = options || {};
  const limit = options.limit || 100;
  const offset = options.offset || 0;
  
  const sheet = getDeviceReadingsSheet();
  const lastRow = sheet.getLastRow();
  
  if (lastRow < 2) {
    return { data: [], total: 0, limit: limit, offset: offset, hasMore: false };
  }
  
  // –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –ø–µ—Ä–∏–æ–¥, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –ø—Ä–∏–º–µ—Ä–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω —Å—Ç—Ä–æ–∫
  // –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ readingDate DESC
  let startRow = 2;
  let endRow = lastRow;
  
  if (endDate) {
    // –ò—â–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É —Å readingDate <= endDate (–±–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫)
    // –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è: —á–∏—Ç–∞–µ–º –ø–µ—Ä–≤—ã–µ N —Å—Ç—Ä–æ–∫ –∏ –∏—â–µ–º
    const sampleSize = Math.min(1000, lastRow - 1);
    const sample = sheet.getRange(2, 1, sampleSize, 2).getValues();
    
    for (let i = 0; i < sample.length; i++) {
      if (sample[i][1] <= endDate) {
        startRow = i + 2;
        break;
      }
    }
  }
  
  if (startDate) {
    // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∏—â–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ–∫—É —Å readingDate >= startDate
    // –ß–∏—Ç–∞–µ–º —Å –∫–æ–Ω—Ü–∞
    const sampleSize = Math.min(1000, lastRow - startRow);
    if (sampleSize > 0) {
      const sample = sheet.getRange(Math.max(2, lastRow - sampleSize + 1), 1, sampleSize, 2).getValues();
      
      for (let i = sample.length - 1; i >= 0; i--) {
        if (sample[i][1] >= startDate) {
          endRow = lastRow - sampleSize + i + 1;
          break;
        }
      }
    }
  }
  
  // –ß–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
  const rangeSize = endRow - startRow + 1;
  if (rangeSize <= 0) {
    return { data: [], total: 0, limit: limit, offset: offset, hasMore: false };
  }
  
  const data = sheet.getRange(startRow, 1, rangeSize, 8).getValues();
  
  // –§–∏–ª—å—Ç—Ä—É–µ–º
  let filtered = data.filter((row) => {
    if (deviceId && String(row[0]) !== String(deviceId)) return false;
    if (startDate && row[1] < startDate) return false;
    if (endDate && row[1] > endDate) return false;
    if (readingType && readingType !== 'all' && row[4] !== readingType) return false;
    return true;
  });
  
  // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
  filtered.sort((a, b) => b[1] - a[1]); // DESC –ø–æ readingDate
  
  const total = filtered.length;
  const paginated = filtered.slice(offset, offset + limit);
  
  const result = paginated.map((row, index) => ({
    id: startRow + offset + index,
    deviceId: String(row[0]),
    readingDate: row[1],
    readingValue: row[2],
    unit: row[3],
    readingType: row[4],
    createdAt: row[5],
    source: row[6],
    period: row[7]
  }));
  
  return {
    data: result,
    total: total,
    limit: limit,
    offset: offset,
    hasMore: (offset + limit) < total
  };
}
```

#### 5. –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∑–∞–º–µ–¥–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É.

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–º–µ—â–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å—Ç–∞—Ä—à–µ N –º–µ—Å—è—Ü–µ–≤) –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç "–ê—Ä—Ö–∏–≤ –ø–æ–∫–∞–∑–∞–Ω–∏–π".

**Backend (`DeviceReadings.gs`):**
```javascript
function archiveOldReadings(monthsToKeep = 6) {
  const sheet = getDeviceReadingsSheet();
  const archiveSheet = getArchiveReadingsSheet(); // –û—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç –¥–ª—è –∞—Ä—Ö–∏–≤–∞
  
  const cutoffDate = Math.floor(Date.now() / 1000) - (monthsToKeep * 30 * 24 * 60 * 60);
  const lastRow = sheet.getLastRow();
  
  if (lastRow < 2) return { archived: 0 };
  
  // –ù–∞—Ö–æ–¥–∏–º —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ (–¥–∞–Ω–Ω—ã–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã DESC, —Å—Ç–∞—Ä—ã–µ –≤ –∫–æ–Ω—Ü–µ)
  let archiveStartRow = lastRow + 1;
  
  for (let row = 2; row <= lastRow; row++) {
    const readingDate = sheet.getRange(row, 2).getValue(); // readingDate –≤ –∫–æ–ª–æ–Ω–∫–µ B
    if (readingDate < cutoffDate) {
      archiveStartRow = row;
      break;
    }
  }
  
  if (archiveStartRow > lastRow) {
    return { archived: 0 }; // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
  }
  
  // –ö–æ–ø–∏—Ä—É–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∞—Ä—Ö–∏–≤
  const archiveRange = sheet.getRange(archiveStartRow, 1, lastRow - archiveStartRow + 1, 8);
  const archiveData = archiveRange.getValues();
  
  // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞—Ä—Ö–∏–≤
  const archiveLastRow = archiveSheet.getLastRow();
  if (archiveLastRow === 0) {
    // –°–æ–∑–¥–∞—ë–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
    archiveSheet.getRange(1, 1, 1, 8).setValues([[
      'deviceId', 'readingDate', 'readingValue', 'unit', 'readingType', 'createdAt', 'source', 'period'
    ]]);
  }
  
  archiveSheet.getRange(archiveSheet.getLastRow() + 1, 1, archiveData.length, 8).setValues(archiveData);
  
  // –£–¥–∞–ª—è–µ–º –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ª–∏—Å—Ç–∞
  sheet.deleteRows(archiveStartRow, lastRow - archiveStartRow + 1);
  
  return { archived: lastRow - archiveStartRow + 1 };
}

function getArchiveReadingsSheet() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  let sheet = ss.getSheetByName('–ê—Ä—Ö–∏–≤ –ø–æ–∫–∞–∑–∞–Ω–∏–π');
  
  if (!sheet) {
    sheet = ss.insertSheet('–ê—Ä—Ö–∏–≤ –ø–æ–∫–∞–∑–∞–Ω–∏–π');
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
    sheet.getRange(1, 1, 1, 8).setValues([[
      'deviceId', 'readingDate', 'readingValue', 'unit', 'readingType', 'createdAt', 'source', 'period'
    ]]);
    // –î–µ–ª–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∂–∏—Ä–Ω—ã–º–∏
    sheet.getRange(1, 1, 1, 8).setFontWeight('bold');
  }
  
  return sheet;
}
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç—Ä–∏–≥–≥–µ—Ä):**
```javascript
function archiveOldReadingsMonthly() {
  // –ó–∞–ø—É—Å–∫–∞—Ç—å —Ä–∞–∑ –≤ –º–µ—Å—è—Ü
  const result = archiveOldReadings(6); // –•—Ä–∞–Ω–∏—Ç—å 6 –º–µ—Å—è—Ü–µ–≤ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ª–∏—Å—Ç–µ
  Logger.log(`–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–∫–∞–∑–∞–Ω–∏–π: ${result.archived}`);
}
```

#### 6. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ª–∏—Å—Ç–æ–≤ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –ª–∏—Å—Ç–∞–º (–ø–æ –º–µ—Å—è—Ü–∞–º –∏–ª–∏ –≥–æ–¥–∞–º).

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- "–ü–æ–∫–∞–∑–∞–Ω–∏—è 2025-01"
- "–ü–æ–∫–∞–∑–∞–Ω–∏—è 2025-02"
- –∏ —Ç.–¥.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥
- –ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–∞–∂–¥–æ–º –ª–∏—Å—Ç–µ

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –°–ª–æ–∂–Ω–µ–µ –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–∏–æ–¥–æ–≤
- –ë–æ–ª—å—à–µ –ª–∏—Å—Ç–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 7. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è UI - –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ –º–µ–¥–ª–µ–Ω–Ω—ã–π.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é (–æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ —Å—Ç—Ä–æ–∫–∏).

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** `react-window` –∏–ª–∏ `react-virtualized`

```typescript
import { FixedSizeList } from 'react-window';

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
<FixedSizeList
  height={600}
  itemCount={readings.length}
  itemSize={50}
  width="100%"
>
  {({ index, style }) => (
    <div style={style}>
      {/* –†–µ–Ω–¥–µ—Ä–∏–º —Å—Ç—Ä–æ–∫—É —Ç–∞–±–ª–∏—Ü—ã */}
      <ReadingRow reading={readings[index]} />
    </div>
  )}
</FixedSizeList>
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**
1. ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (limit/offset)
2. ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ (–ø–æ readingDate DESC)
3. ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π

**–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ:**
4. ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞
5. ‚úÖ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—á–µ—Ä–µ–∑ 6 –º–µ—Å—è—Ü–µ–≤)

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:**
6. ‚ö™ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ª–∏—Å—Ç–∞–º (–µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –æ—á–µ–Ω—å –º–Ω–æ–≥–æ)
7. ‚ö™ –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –≤ UI

### –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç

- **–ë–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** –ó–∞–≥—Ä—É–∑–∫–∞ 10,000 –∑–∞–ø–∏—Å–µ–π = 5-10 —Å–µ–∫—É–Ω–¥
- **–° –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π (100 –∑–∞–ø–∏—Å–µ–π):** –ó–∞–≥—Ä—É–∑–∫–∞ = 0.5-1 —Å–µ–∫—É–Ω–¥–∞
- **–° –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏—Ö:** –ó–∞–ø—Ä–æ—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–∫–∞–∑–∞–Ω–∏—è = < 0.1 —Å–µ–∫—É–Ω–¥—ã
- **–° –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ–º:** –û—Å–Ω–æ–≤–Ω–æ–π –ª–∏—Å—Ç –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:

1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π:**
   - –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∑–∞ –ø–µ—Ä–∏–æ–¥
   - –û—à–∏–±–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –í—Ä–µ–º—è —Å–±–æ—Ä–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π)

3. **–ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö:**
   - –ü—Ä–æ–ø—É—Å–∫–∏ –≤ –¥–∞–Ω–Ω—ã—Ö (–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏–π –∑–∞ –ø–µ—Ä–∏–æ–¥)
   - –ê–Ω–æ–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (—Ä–µ–∑–∫–∏–µ —Å–∫–∞—á–∫–∏)

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `docs/DEVICE_READINGS_ARCHIVE.md` - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞—Ä—Ö–∏–≤–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π
- `docs/DATA_COLLECTION_SOURCE.md` - –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–±–æ—Ä–∞
- `src/services/api/beliotDeviceApi.ts` - API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞–Ω–∏–π –∏–∑ Beliot

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

- [ ] –ú–æ–¥—É–ª—å `DeviceReadings.gs` —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `Code.gs`
- [ ] Frontend API —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] Collector —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π –¥–æ–±–∞–≤–ª–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- [ ] **–ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)**
- [ ] **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)**
- [ ] **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)**
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –±–æ–ª—å—à–∏–º –æ–±—ä—ë–º–æ–º –¥–∞–Ω–Ω—ã—Ö

