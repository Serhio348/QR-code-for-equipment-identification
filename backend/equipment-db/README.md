# API для базы данных оборудования

Google Apps Script веб-приложение для работы с базой данных оборудования в Google Sheets.

## Установка

### Шаг 1: Откройте Google Apps Script

1. Откройте вашу Google Sheets таблицу **"База данных оборудования"**
2. В меню выберите: **Расширения → Apps Script**
3. Откроется редактор Google Apps Script

### Шаг 2: Скопируйте код

1. Удалите весь код по умолчанию (функция `myFunction`)
2. Откройте файл `Code.gs` из папки `backend/equipment-db/`
3. Скопируйте весь код
4. Вставьте в редактор Google Apps Script
5. Сохраните проект: **Ctrl+S** или кнопка **Сохранить**
6. Назовите проект: **"API для базы данных оборудования"** (вверху слева)

### Шаг 3: Опубликуйте как веб-приложение

1. Нажмите **Развернуть → Новое развертывание**
2. Нажмите на значок шестеренки ⚙️ рядом с "Тип"
3. Выберите **Веб-приложение**
4. Заполните настройки:
   - **Описание:** API для базы данных оборудования
   - **Выполнять от имени:** Меня
   - **У кого есть доступ:** Все (важно для CORS!)
5. Нажмите **Развернуть**
6. При первом развертывании Google может запросить авторизацию:
   - Нажмите **Разрешить**
   - Выберите ваш аккаунт
   - Нажмите **Продолжить**
   - Нажмите **Разрешить** для доступа к Google Sheets
7. **ВАЖНО:** Скопируйте **URL веб-приложения** (он появится после развертывания)

**Примечание:** Если вы обновили код (добавили doOptions), нужно создать **новое развертывание**:
- **Развернуть → Управление развертываниями**
- Нажмите на карандаш ✏️ рядом с существующим развертыванием
- Нажмите **Развернуть** (версия обновится автоматически)

### Шаг 4: Сохраните URL

Скопированный URL понадобится для настройки frontend приложения.

Пример URL:
```
https://script.google.com/macros/s/AKfycby.../exec
```

## Тестирование API

### Тест 1: Проверка работы

1. Откройте скопированный URL веб-приложения в браузере
2. Добавьте к URL: `?action=getAll`
3. Должен вернуться JSON:
   ```json
   {
     "success": true,
     "data": []
   }
   ```
   (Пустой массив, если в таблице еще нет данных)

### Тест 2: Через консоль браузера

Откройте консоль браузера (F12) и выполните:
```javascript
fetch('ВАШ_URL?action=getAll')
  .then(r => r.json())
  .then(console.log);
```

## API Endpoints

### GET запросы

#### Получить все оборудование
```
GET ?action=getAll
```

#### Получить по ID
```
GET ?action=getById&id=UUID
```

#### Получить по типу
```
GET ?action=getByType&type=filter
```

### POST запросы

#### Добавить оборудование
```
POST
Content-Type: application/json

{
  "action": "add",
  "name": "Фильтр обезжелезивания ФО-0,8-1,5 №1",
  "type": "filter",
  "specs": {
    "height": "1,5 м",
    "diameter": "0,8 м"
  },
  "googleDriveUrl": "https://...",
  "qrCodeUrl": "https://...",
  "status": "active"
}
```

#### Обновить оборудование
```
POST
Content-Type: application/json

{
  "action": "update",
  "id": "UUID",
  "name": "Новое название",
  "lastMaintenanceDate": "2024-01-25"
}
```

#### Удалить оборудование (архивировать)
```
POST
Content-Type: application/json

{
  "action": "delete",
  "id": "UUID"
}
```

## Формат данных

### Типы оборудования
- `filter` - Фильтр
- `pump` - Насос
- `tank` - Резервуар
- `valve` - Клапан
- `other` - Другое

### Статусы
- `active` - Активен
- `inactive` - Неактивен
- `archived` - Архивирован

## Обработка ошибок

Все ответы имеют формат:
```json
{
  "success": true/false,
  "data": {...} или "error": "Сообщение об ошибке"
}
```

## Просмотр логов

Если что-то не работает:
1. В Google Apps Script: **Вид → Логи**
2. Выполните запрос к API
3. Проверьте логи на наличие ошибок

## Следующий шаг

После успешного развертывания и тестирования API:
- Сохраните URL веб-приложения
- Переходите к Шагу 3: Обновление TypeScript типов и создание API клиента

